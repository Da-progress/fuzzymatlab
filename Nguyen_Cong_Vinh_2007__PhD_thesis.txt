AKADEMIA MORSKA W GDYNI 
Wydzia? Elektryczny 
 
 
 
 
 
 
 
 
Rozprawa doktorska 
 
Nguyen Cong Vinh 
 
 
 
 
  Synteza regulatora trajektorii statku  w autopilocie okr?towym  z zastosowaniem teorii zbior?w rozmytych 
 
The synthesis of trajectory regulator  using fuzzy logic theory 
in a marine vessel autopilot 
 
 
 
 
 
 
 
 
 
 
 
 
 
Promotor: dr hab. in?. Leszek Morawski, prof. nadzw. AM 
 
 
 
 
 
 
 
 
Gdynia 2007 
 
Contents 
Definitions........................................................................................................................4 
Chapter 1 Introduction....................................................................................................6 
1.1 Background ..........................................................................................................6 
1.2 Goal and results of the research...........................................................................7 
1.3 Algorithms of control and steering criteria evaluated in the research..................8 
Chapter 2 Mathematic model of control process............................................................12 
2.1 Vessel’s dynamic equations of motion ................................................................12 
2.2 Hydrodynamic forces and moments....................................................................14 
2.3 Propulsion system forces and moments..............................................................15 
2.4 Rudder forces and moments...............................................................................16 
2.5 Environmental disturbances, forces and moments .............................................17 
2.5.1 Wave forces and moments.............................................................................17 
2.5.2 Wind forces and moments.............................................................................18 
2.5.3 Current-induced forces and moments............................................................20 
2.6 Applying the mathematic model of a vessel in research.....................................20 
Chapter 3 Autopilot controllers.....................................................................................22 
3.1 Autopilot fuzzy logic controllers.........................................................................22 
3.2 The characteristics of the controllers’ membership functions.............................22 
3.3 Defuzzification method applied for the controllers.............................................23 
Chapter 4 The autopilot................................................................................................25 
4.1 Algorithm and definitions...................................................................................25 
4.1.1 Algorithm of control......................................................................................25 
4.1.2 Definitions......................................................................................................28 
4.2 Autopilot’s setup................................................................................................30 
4.3 Trajectory segment regulator.............................................................................33 
4.4 Positioning regulator..........................................................................................37 4.5 The Processing block.........................................................................................44 
4.5.1 Controlling a vessel with a pure trajectory set path......................................45 
4.5.2 Controlling a vessel with a pure maneuvering set path.................................46 4.5.3 Controlling a vessel with a complex set path................................................48 
4.6 The Interface.....................................................................................................51 
4.6.1 Working windows..........................................................................................51 
4.6.2 Database files of the Interface......................................................................53 
4.6.3 Managing a vessel using the Interface..........................................................54 
4.6.4 Replaying a recorded track............................................................................56 
4.7 Hardware and software setup.............................................................................56 
4.7.1 Hardware setup..............................................................................................56 
4.7.2 Control command parameters .......................................................................58 
4.7.3 Cross dev. reducing block parameters ...........................................................59 
4.7.4 Braking up control parameters......................................................................59 
4.7.5 Interface parameters and signals..................................................................59 
4.7.6 Input signal scaling to apply the autopilot to different vessels......................61 
Chapter 5 Experiments and results evaluation..............................................................62 
5.1 Facility for the experiments ...............................................................................62 
5.2 Steering criteria..................................................................................................65 
5.3 Results of the experiments and their evaluations...............................................67 
5.3.1 Experiments with straight path segments in trajectory mode.......................67 
5.3.2 Changing the path segment in trajectory mode experiment..........................73 
5.3.3 Reducing drift block effect experiment.........................................................78 
5.3.4 Maneuvering paths experiments....................................................................80 
5.3.5 Braking up vessel experiment........................................................................83 
5.3.6 Complex set paths experiments.....................................................................87 
5.4 Applying the autopilot to other models .............................................................92 
Conclusions....................................................................................................................97 
  6.1 Assessment.........................................................................................................97 6.2 Further research.................................................................................................98 Appendix A The Interface............................................................................................99 
A.1 Introduction........................................................................................................99 
A.2 Functions related to set paths..........................................................................100 
A.3 Functions related to vessel control...................................................................102 
A.4 Functions related to map correcting ................................................................104 
A.4.1 Show on/off the secondary map ..................................................................104 
A.4.2 Adjusting coordinates of the secondary map...............................................105 
A.4.3 Adding/Deleting/Editing buoys..................................................................105 
A.4.4 Other functions............................................................................................106 
Appendix B Autopilot diagram....................................................................................107 
Appendix C Mathematical model of Blue Lady ..........................................................116 
C.1 The mathematic model.....................................................................................116 
C.2 Comparing the Blue Lady simulator to the real model....................................121 
Appendix D Fuzzy logic theory...................................................................................125 
D.1 Background ......................................................................................................125 
D.2 Fuzzy logic theory............................................................................................126 
D.2.1 Linguistic variable .......................................................................................126 
D.2.2 Fuzzy set and membership function............................................................126 
D.2.3 Logical operations........................................................................................128 
D.2.4 If-Then rules................................................................................................129 
D.2.5 Fuzzy inference............................................................................................129 
D.3 Common fuzzy systems....................................................................................132 
D.3.1 Mamdani fuzzy system................................................................................132 
D.3.2 Takagi-Sugeno’s fuzzy system .....................................................................132 
D.3.3 Mendel-Wang’s fuzzy system ......................................................................133 
Appendix E..................................................................................................................134 
E.1 View of I?awa ...................................................................................................134 
E.2 Beaufort scale...................................................................................................135 
E.3 Wind force and moment parameters................................................................136 
References....................................................................................................................141 
 
Definitions 
xnyn : Earth-fixed reference frame , n-frame {n} [m] xsys : path segment reference frame, s-frame {s} [m] xbyb : body reference frame, b-frame {b} [m] y : cross deviation in path segment reference frame [m] dx, dy : coordinates of the reference point R in b-frame [m] u  : surge in b-frame 	[m/s] v : sway in b-frame 	[m/s] 
 	: heave in b-frame 	[m/s]  	: vessel speed  	[m/s] 
	 	: required speed on kth path segment   	[m/s] 
y  : vessel course [o] yk  : direction on kth path segment  [o] Dy  : course error  [o] r : turning rate  [o/s] d : rudder deflection angle [o] m : mass [kg] p : momentum [kg.m/s] L : vessel’s length [m] B : vessel’s width [m] H : vessel’s height [m] T : vessel’s draft [m] F : force [N] X, Y, Z : forces acting on vessel in x, y, z directions of b-frame [N] K, M, N : moments to x, y, z axes of b-frame [Nm] Xhyd, Yhyd : hydrodynamic forces in x, y directions of b-frame [N] Nhyd : hydrodynamic moment in z axis of b-frame [Nm] Xpropl, Ypropl : forces caused by main propeller in x, y directions of b-frame [N] Npropl : moment caused by main propeller to z axis of b-frame [Nm] Xrud, Yrud : forces caused by rudder in x, y directions of b-frame [N] Nrud : moment caused by rudder to z axis of b-frame [Nm] Yb-thruster : force caused by bow thruster in y direction of b-frame [N] Nb-thruster : moment caused by bow thruster to z axis of b-frame [Nm] Ys-thruster : force caused by stern thruster in y direction of b-frame [N] Ns-thruster : moment caused by stern thruster to z axis of b-frame [Nm] 
Xb-a.propl, Yb-a.propl: forces caused by bow azimuth propeller in x, y direction b-frame [N] Nb-a.propl : moment caused by bow azimuth propeller to z axis of b-frame [Nm] 
Xs-a.propl,Ys-a.propl : forces caused by stern azimuth propeller in x, y direction b-frame 	[N] 
Ns-a.propl : moment caused by stern azimuth propeller to z axis of b-frame [Nm] Xext, Yext : forces caused by environmental disturbances in x, y direction [N] Next : moment caused by environmental disturbances to z axis  [Nm] Xwave, Ywave : forces caused by wave in x, y directions of b-frame [N] Nwave : moment caused by wave to z axis of b-frame [Nm] Xwind, Ywind : forces caused by wind in x, y directions of b-frame [N] Nwind : moment caused by wind to z axis of b-frame [Nm] VR : relative wind speed [knot] uR, vR : relative wind speed in x, y directions [knot] uc, vc : current speed in x, y directions [knot] gR : relative wind direction [o] CX, CY : wind force coefficients [-] CN : wind moment coefficient [-] r : density of water [kg/m3] rw : density of air [kg/m3] xG, yG, zG : coordinates of vessel center of gravity [m] AT : transverse projected area in wind [m2] AL : lateral projected area in wind  [m2] Vt : current velocity caused by tidal component [m/s] Vlw : current velocity caused by local wind [m/s] V : current velocity caused by nonlinear waves  [m/s]  	: current velocity caused major ocean circulation  	[m/s] 
Chapter 1 Introduction 
1.1 Background 
Ship autopilot has more than eighty year’s development. Since the first autopilots, Sperry’s Single Gyro Pilot in 1923 [67], to today’s modern autopilots many advances have been made. 
      Until the 1940s, the autopilot was a very simple device in which the heading error produced a corrective signal for steering gear (proportional control P). It is satisfactory for moderate speed, stable vessel but is unsuitable for an unstable vessel. A more advanced control system that includes a derivative of heading error term is required. This algorithm, proportional-derivative (PD) controller, was introduced and applied in 1949 by Schiff and Gimprich [62], soon after Luke and West [45] and the assessment of PD controller was presented in the research of Rydilla [61]. In 1972,  Bech [9] introduced steering with proportional-integral-derivative (PID) controller.  
      The PID controller provides good maneuvering performance at given speed but it requires many adjustments to obtain optimization with respect to the vessel’s dynamics (size, speed and trim) and external disturbances (sea, wind and currents). In order to adjust the controller, the human operator may rely on experience rather than on analytical knowledge of the ship’s behavior and the environmental disturbances.  
      In the 1970s and 1980s the adaptive control algorithm was developed. The first of them is the adaptation included in PID design introduced by Sugimoto and  Kojima [69]. Their method concentrated on the diagnosis of wave condition using the adaptive function. This function selects the optimal parameters based on the wave condition signal, ship speed and loading condition. In 1970, the stochastic adaptive system investigated by Merlo and Tiano [48], [54] was proposed. It contained a parameter that was dependent on the sea wave’s power spectra in their ARMA model. The optimal control system employed contained a cost function, which was a weighted function of the mean square of the heading error and rudder action. 
      The model reference techniques theory applied by Van Amerongen [2], [4], relies on the criteria according to which the process is linear, has a known order and structure and there are no stochastic disturbances present. The main criticism of this method approach is that a ship is, in reality, a non-linear system with noise present. The system would work in calm weather and “perfect” conditions but its performance would deteriorate in rougher conditions and changing loading conditions. 
      The self-tuner based on conditional cost function was developed by Clarke and Gawthrop [15] and employed by Lim and Forsythe [43]. The self-tuning autopilot can be designed using a computation of steady state solution of the Ricatti equation at each sample step. Different performance criteria are used for changing and keeping the course. For a system with unknown parameters, on-line identification techniques have to be employed because of the changing dynamics when waves affect the vessel. Due to the difficulties in modeling wave systems there appears to be some scope for error and further problems occur with computational time taken to solve the Ricatti equation. 
      The Liner Quadratic Gaussian approach of Katebi and Bryne [31] was an attempt to formulate a dynamic cost function optimized in a stochastic framework using a polynomial systems approach. This system relies on measuring and computation of wind and wave elements. The wave model was used as a control function to minimize variations in the output signal. The wind force comprised of two elements - mean wind speed and turbulence. The mean speed was only considered for modeling purposes.  
      The inaccuracy in the system can occur with the measurement and modeling of wind and waves at [5]. Thus adaptive techniques rely either on the estimated value of the cost function or accurate modeling disturbances. Neither can provide fully automated optimal action within the wide range of operating conditions experienced by a ship [77]. 
      For the last twenty years there has been much interest in the field of artificial intelligence and its application to control problems such as: knowledge  based systems or expert systems [13], neural network controllers, fuzzy logic  controllers [70], and Neurofuzzy controller [11], [12].  
      The expert systems approach models the knowledge and procedures of the human expert to solve a problem in a defined domain [5], [6], [8], [16].  
      The neural network controller is a presentation of the human brain simulated in the binary memory of a computer. A network is made up of artificial neurons connected to each other by axions (paths or links). Each neuron can have many inputs but only one output. As a neuron is energized by weighted sum of inputs, it fires, sending energy along axions to the nearby neurons. If another neuron receives enough energy from input axions it will also fire, propagating the excitation to others. There can be many neurons arranged in layers which form a neural network capable to learn from experience [77].  
      The fuzzy logic controller has a main design problem which lies in the formulation of the rule base which forms the algorithm. A rule base may be generated by a control engineer using the knowledge of a human operator, who describes his control strategy [37], [49], [51], [52]; or it can be generated by a controller basing on its closed-loop performance. It is named fuzzy self-organizing controller (SOC). The first SOC was developed by Procyk and Mamdani [59] and then several SOC systems have been proposed by Shoa [63], Mandic, Scharf and Mamdani [47], Tanscheit and  Scharf [72] and Daley and Gill [17]...  
      After a long history of development, the autopilots are more autonomous and more intelligent. They work more efficiently and may satisfy the complex requirements of human operator in difficult weather conditions. This thesis also concerns a research in a filed of automatic control of ship motions. 
1.2 Goal and results of the research 
The goal of the thesis is to build an autopilot for marine vessels which would comply with the following features: 
      - Automatic control of the vessel movement for a complete “quay-to-quay” voyage. It means that the autopilot can control a vessel during departure from berthing quay with very low or zero speed and high accuracy required, sailing at sea with seagoing speed and then approaching to the destination quay for berthing with the requirements as same as departure’s.   
      - Adapting to controlled object and environment. It means that the autopilot can control different kinds of vessel in different environment conditions. 
      - Applicable in practice. The research does not only solve the problem of controlling a vessel’s movement but provides an interface including an electronic map and functions, which are convenient both for researchers and mariners in their works. The interface also has the functions which support the user to control vessel movement directly by click or dragging computer mouse on the screen. These function are useful in the case the user is not able to prepare the set path. 
      - Easy to develop. The autopilot is constructed of several modules. Each module has its own and independent functions, thereby developing the autopilot’s functions is easier. 
      In this thesis, the results of the experiments in real environment of a vessel scale model and the results of simulations of four different vessels (models) with the autopilot are tested. 
      The full functionality of the autopilot is evaluated using the Blue Lady model scale 1:24, which is described in detail in section 5.1 and Appendix C, in real environment and applying computer simulation. The results are presented in  Chapter 5.  
      The experiments on the other three models are to evaluate the adaptability of the autopilot to different control objects. The models introduced in Marine GNC Toolbox by Thor. I. Fossen. They have no thruster so the experiments and the evaluation were limited within trajectory path control, not including the maneuvering control. The experiments were performed using computer simulation and the results are presented in the section 5.4. 
      The interface of the autopilot is designed in the form of electronic map. On it, users can define the set path and/or correct the map themselves. The vessel may be automatically controlled with a set path or controlled directly/instantly through the interface. The outline and the parameters of the vessel are also displayed on the interface. The details of the interface have presented in section 4.6 and Appendix A. 
1.3 Algorithms of control and steering criteria evaluated in the research 
Method of control:  
As we know, the effect of force acting on a body depends on its magnitude and acting time. In this research, a control force acting on a control object (vessel) is processed in pulse form. The amplitude of pulse is defined by several fixed steps; it plays the role of rough control. The fine control is implemented by adjusting the acting time of the pulse force (see 4.1.1). The example below clarifies the idea. 
      Let assume that one wants to move a hutch from point A to point B (Fig. 1.1). ??If we know exactly the mass of the hutch ??m and all the resistant forces Fres. we can calculate the pushing force F (magnitude and acting time) acting on the hutch to move it exactly to point B (Fig. 1.1a). 
?
      Unfortunately, the values of m and Fres?. may not be measured accurately and they can also change with time so determining F is difficult. In fact, a worker can move the hutch properly to point B without any calculation.  
      Which control method is applied by workers? Fig. 1.1b shows the graph of speed vset. If the hutch is moved at such speed as the vset in the graph, it will be located exactly at point B. To obtain it, the worker pushes the hutch with force F1 to start moving the hutch. While the hutch is moving, he pushes force F2, to maintain its movement. The worker does not need to know exactly the magnitude of these forces. If the hutch moves faster than the set speed (vactual>vset), he stops pushing. If the hutch moves slower than the set speed, he pushes F2 to the hutch. To stop the hutch the worker can use force –F2 or –F1. The F graph on Fig. 1.1b shows the acting force of the worker on the hutch. 
m=? 

Fig. 1.1 The idea of controlling by changing the acting time of the force 
      By pushing and not pushing depending on the speed, the worker could move the hutch to point B without any information of the hutch mass or resistance forces.  
      In that case, the worker controlled the hutch by changing the acting time of pulse forces. While he is driving the hutch, the pushing time (acting time) was adjusted to control the hutch speed. The basic theory of this method is presented in  subsection 4.1.1. 
      What happens if the hutch is heavier and/or the resistant forces are stronger? Let assume that the force magnitude F2 of the worker is enough to make the hutch move; in that case the pushing time (the acting time of the force) has to be extended and the not pushing time will be shortened. This change of force acting time can be considered as the adaptation of the controller to the change of the control object and/or environment. In case force F2 is not enough to move the hutch, force F1 can be used instead. 
      Fuzzy logic theory is very close to human intuition [56] and it is suitable for application to the above-mentioned control method. This control method is applied to all controllers of the autopilot. The details of the controllers are presented in the sections 4.3 and 4.4. 
Algorithms of vessel control: 
      To manage a vessel the autopilot divides the complex movement along a set path into basic movements, which can be executed by a single controller. Then it performs these basic movements alternately.  
      The basic movements are: 1) running on a straight path segment and 2) maintain the vessel position at a point. Each of the basic movements is controlled by one regulator: the Trajectory segment regulator keeps the vessel running on the straight path segment and the Positioning regulator keeps the vessel as close as possible to the reference point. 
      The Processing block (detailed in section 4.5) plays a role of a central processor. It sends commands alternately to the regulators in proper time to perform the complex movements of the vessel. For example:  
      1) To control a vessel sailing along a trajectory set path: The Processing block sends the control parameters to the Trajectory segment regulator. The control parameters consist of two waypoints coordinates of the path segment, which the vessel has to run along, and set speed on it. When the vessel approaches to the forward waypoint at a proper distance, the Processing block performs the changing path segment task. It sets new values to the control parameters (data of the next path segment) and, since this moment, the Trajectory segment regulator controls the vessel to move along the new path segment. This process is repeated for other next path segments. The details are presented in subsection 4.5.1. 
      2) To maneuver a vessel following a maneuvering set path: the Processing block sends the coordinates of reference point and sets heading to the Positioning regulator. Then, it moves the reference point on the set path. The Positioning regulator tries to maintain the vessel at the reference point while the reference point is moved by the Processing block so it causes the vessel to move on the set path. The details are presented in subsection 4.5.2. 
      3) To control a vessel with a complex set path: The complex set path consists of both types of path segment: the maneuvering segment and the trajectory segment and the autopilot has to switch between the trajectory mode and the maneuvering mode. Because the controllable speed ranges in the maneuvering mode and trajectory mode are different, the autopilot can not switch immediately from the trajectory mode to the maneuvering mode. In that case, the Processing block has to control the vessel in the transitional mode. It is complex process employing both regulators: Positioning regulator and Segment trajectory regulator. The details are presented in the subsection 4.5.3. 
      In the maneuvering mode the set path must not consist only of a straight path segments but also may be a curve, e.g. a circle or a sin curve in like Fig. 1.2. To add this type of functionality to the autopilot, one simply adds some code to the Processing block, which moves the reference point onto the required curve. This is an example of “easy to develop” characteristic of the autopilot. 
 
Fig. 1.2 Special forms of a set path Evaluated steering criteria: 
      The steering criteria of the autopilot, which are evaluated in this thesis, consist of three main features. They are: 
      1) The speed losing on straight path segment (in trajectory mode). This feature is related to the fuel consumption with respect to steering resistance.  
      2) The ability to stabilize the vessel track on the straight path segment (in trajectory mode).  
      3) The ability to stabilize the vessel course at the set value (in maneuvering and trajectory mode). 
      In addition, some other features of the autopilot are assessed such as the changing path segment in trajectory mode; the controlling course, position and speed in transitional mode; the adaptability of the autopilot in different conditions. See  Chapter 5 for details concerning the results and their assessments. 

Chapter 2 Mathematic model of control process 
2.1 Vessel’s dynamic equations of motion 
The motion of a ship in six degrees of freedom is treated as translational motions of a rigid body (position) in three directions: surge, sway, and heave; and as rotational motions (orientation) about three axes: roll, pitch and yaw. To determine the equations of motion two reference frames are considered: the n-frame On that is a local geographical frame fixed to the Earth and the b-frame (body frame) Ob fixed to the ship hull as shown in Fig. 2.1. For surface ships, the most commonly adopted position for the b-frame is such that it gives hull symmetry about the xbzb-plane and approximate symmetry about the ybzb-plane, while the origin of the zb  axis is defined by the calm water surface [58]. 

 
Fig. 2.1 Notation and sign conventions for ship motion description 
      The magnitudes describing the position and orientation of the ship are usually expressed in the n-frame and the coordinates are noted: [xn yn zn ]T and [? µ ? ]T respectively, whilst the forces , moments [X Y Z ]T, linear velocities [u v w]T, and angular velocities [ p q r]T are usually expressed in the b-frame – see Fig. 2.1. These standard notations are given in [64]. 
The position-orientation vector h with respect to the n-frame is defined as  
 	h= ??h1 h2 ??T ;	h1 = [xn	yn	zn ]T ;	h2 = [fqy]T 	(2.1) 
and the linear-angular velocity vector n with respect to the b-frame as  
 	n=??n1 n2 ,??T ;	n1	;	n2	 	(2.2) 
The forces and moments vector t is defined as 
 	t= ??t1 t2 ??T ;	t1 = [X	Y	Z]T ;	t2 = [K	N	M]T 	(2.3) 
and these magnitudes are generated by different phenomena and can be separated into components according to their originating effects: 
 	? = ?hyd + ?cs + ? prop + ?ext 	(2.4) 
where  thyd  : forces and moments caused by the movement of the hull in the water.  tprop  : forces and moments come from the propulsion system, e.g., propellers and thrusters. 
 tcs  	: forces and moments arise due to the movement of control surfaces (CS) like rudder, fins, etc. . 
text  	: forces and moments acting on the hull due to the environmental disturbances, e.g. wind, currents and waves. 
 According to [21], the 6 DOF nonlinear dynamic equations of motion can be conveniently expressed as: 
 	Mn??+ C (n)n+ D(n)n+ g(h t) =	 	(2.5) 
where 
	M 	: inertia matrix (including added mass). 
 C (n) : matrix of Coriolis and centripetal terms (including added mass).  D(n) : damping matrix. g(h)  : vector of gravitational forces and moments. 
	t 	: vector of control input. 
The position-orientation rate vector ???is related to n via: 
 	h??= J (hn) 	(2.6) 
where J(h) is a transformation matrix that depends on the Euler angles (? µ ?, , ) and is 

of the form [21] 
 
where 

J ?( ) = ??J1 (3 3?2 ) J20(3 3·?2 )??? (2.7) ? 0 ·
 	J1 (h2 ) =C C CzT,y q fyT,	xT, (2.8) ? c(y)
1 (h2 ) = ??-s( )y
 	J
	??	0s(y) 0? ?c(q) 0 -s(q)? ?1 c( )y 0? ?? ? 0 1 0 ? ?? ?0
0	1? ?? ?s( )q 0	c( )q ? ?? ?0	0	0 ?
c( )f fs( )?? 
-s( )f fc( )??(2.9)          ?c(y)c(q) -s(y)c(f) + c(y)s(q)s(f) s(y)s(f) + c(y)c(f q)s( ) ?  J1 (h2 ) = ??s( ) ( )y c q c( ) ( )y c f + s( ) ( ) ( )y s q s f -c( ) ( )y s f + s( ) ( ) ( )y c f qs ?? (2.10) 
??
and -s( )qc( ) ( )q s fc( ) ( )q fc??         ?1	s(f)t(q) J2 (h2 ) = ??0	c( )f
??0 s( )f /c( )qc(q q)t( ) ?
  -s( )f ?? c( )f q/c( )??(2.11) where s(?) = sin(?),c(?) = cos(?),t(?) = tan(?). 
2.2 Hydrodynamic forces and moments 
There are two problems in studying hydrodynamic forces and moments. The first problem is constituted by forces acting on the hull when the hull is forced to oscillate with the wave excitation frequency and there are no incident waves. The second problem is forces acting on the hull when the hull is restrained from oscillating and there are incident regular waves [21]. The second problem involves environmental forces such as waves, wind and currents and is presented in section 2.5. 
      The hydrodynamic forces and moments arising from the first problem are caused by inertia, hydrodynamic damping and restore forces (weight and buoyancy). According to [21], [41], these forces and moments can be expressed mathematically as 
 tH =t tR + D 	(2.12)  tR = -MAn??- CA (n)n- DP (n)n h- g( ) (2.13)  tD = -DS (n)n- DW (n)n- DM (nn) (2.14) 
From (2.13) and (2.14), the forces and moment tH can be written as 
tH = -MAn??- CA (n)n- DP (n)n- DS (n)n- DW (n)n- DM (n)n h- g( )
 	 (2.15) 
= -MAn??- CA ( )nn- D( )nn h- g( )
where 
-MAn??- CA (nn) : forces and moments caused by added mass 
-g(h) : restoring forces -D(nn) : forces and moments caused by hydrodynamic damping  D(n) = DP (n) + DS (n) + DW (n) + DM (n) 	 -DP (n) : radiation induced potential damping due to forced body oscillations -Ds (n) : linear skin friction due to laminar boundary layers and quadratic skin friction due to turbulent boundary layer -DW (n) : wave drift damping -DM (n) : damping due to vortex shedding (Morison’s equation)       For surface vessels like tankers, cargo ships etc. it is common to decouple the surge mode from the steering dynamic. The heave, pitch and roll modes are neglected under the assumption that these motion variables are small. Therefore, the hydrodynamic forces and moments can be expressed as: 
- Forces and moments due to added mass:  
	?XA ?	?Xu?
 	?YA ?? = ?? 0
?0
Yv?0 ? ? ?u??? ? ? ? ?
Yr??? ? ?v??+ ?0
00
0-Y vv?	- Yr??+2Nv??r? ? ?u ? ? ?v 
	X uu?	? ? ?(2.16) 	??	??	? ?? ?		? ?? ?
- Forces and moments due to hydrodynamic damping: 
	?XD ?	?Xu
 	?YD ?? = - ?? 0
?
	??ND ??	?? 00
Yv
Nv0 ? ?
Yr ?n 
Nr ??(2.17) - Forces and moments due to restoring forces: 
?Xg ?	?	0	?  	?Y ?
	?	g ? = ??	0	?? 	(2.18) 

	??Ng ??	??-BG Wx	cos sinq q- BG Wy	sinq??

where BGx = xG - xB ;BGy = yG - yB , B and G are the center of gravity and the center of buoyancy respectively. 
      To determine the hydrodynamic derivatives, there are two theoretical methods, i.e. the strip theory and the experimental methods based on system identification and captive models. In the latter, a model is forced to move by a device called planar motion mechanism (PMM) [25]. The PMM forces the body to move while the loads exerted on the model, positions, velocities and accelerations are measured. Analysis of the acquired data yields the values of the coefficients, see example [29].  
2.3 Propulsion system forces and moments 
There are two main types of propellers used on merchant vessels: fixed blade propellers and controllable pitch propellers. In this section, the discussion is limited to the fixed blade propeller type. 
      The performance of a propeller is a function of the speed of the water in the wake of the hull (advance speed) Va (m/s), propeller revolutions per second n (rps) and propeller diameter D (m). In the term of the open water advance, the non-dimensional open water characteristics coefficient is defined as: 
 	 	(2.19) 
      The advance speed at the propeller (speed of the water going into the propeller) is defined as: 
 	Va = (1 - w u) 	(2.20) where 
 	u 	: surge of the vessel 
w : wake faction number [41] (typically w = 0.1-0.4). It is the difference between the vessel speed and the average flow velocity over the propeller disc.  
      The coefficients of propeller thrust KT, propeller torque KQ and the thruster open water efficiency h0 are defined as: 
	Tp	Qp	J0 KT
 	KT =	4	KQ =	5 h0 =	 	(2.21) 
	rn nD	rn nD	2pKQ
where 
 	r 	: water density [kg/m3]  	Tp 	: propeller thrust [N] 
 	Qp 	: propeller torque [Nm] 
      Another effect should be considered here and that is the thrust deduction effect. Because of an increase in the flow velocity in the boundary layer behind the ship, the pressure between the bow and the stern is unbalanced. It causes extra resistance on the hull of the vessel. This resistance can be described by the thrust deduction number t (typically 0.05-0.2) [21]. The value of t strongly depends on the shape of the stern. Hence, the influence of the hull can be described as: 
 	 	(2.22) 
      In practice, the effect of the propeller thrust and torque in open water and behind the stern is different. It can be defined by the ratio: 
 	 	(2.23) 
where KQB is the torque coefficient measured for a propeller behind the stern. Hence, the total propeller thrust efficiency can be defined as the product: 
 	hTOT =h0 ·hM ·h hH · B 	(2.24) 
where hM is mechanical efficiency (typically 0.8-0.9). 
2.4 Rudder forces and moments 

Fig. 2.2 Rudder angles definitions 
      The resultant hydrodynamic force acting on the rudder in real fluid acts on a single point of the rudder called the center of pressure CP with coordinates CP = [xcp ycp zcp ]T expressed in the fixed b-frame. In contrast to the resultant force described by the two-dimensional wing theory, in which the force would be normal with respect to the direction of the flow, the total resultant force in a real fluid is nearly normal with respect to the center plane of the rudder [41]. The magnitude of the resultant force considered normal with respect to the rudder can be expressed as 
 	 	(2.25) 
where CF  is the lift coefficient, Ar is the rudder area, Vav is the average flow passing the rudder. The angle of attack dattack is the relative angle between the rudder and the flow. This angle is calculated by using the rudder angle d, the sway velocity v, the surge velocity u  and the sway velocity at stern produced by the turn rate of the ship (xcp-xG)r  as dattack = d d- flow
 	v + (xcp - xG )r 	(2.26) 
= d- arctan
	?	u	?
where the magnitudes are in accordance with the adopted convention [64] (Fig. 2.2). The forces occurring due to the rudder acting on the hull are then given 
Xrud = -F u V( , av, , ,v r d d)sin( )
 	Yrud = F u V( , av, , ,v r d d)cos( ) 
Zrud = 0(2.27) and the moments are 
 	 	(2.28) 

where CG = [xG	yG	zG ]T are the coordinates of the vessel’s center of gravity. 
      Since the rudder is located behind the propeller, the flow passing the rudder Vav is very much influenced by the propeller. In [74], one of a series of models tested and expressed the average flow is proposed 
 	Vav2 = Va2 + C TT	 	(2.29) 
where 
 	CT »	6.4	 	(2.30) prhDp
in which h is the rudder span and Dp is the propeller diameter. Using the static condition between effective thrust and resistance together with (2.20) and (2.29), average flow Vav can be expressed as 
 	Vav2 = (1 - w)2 - CT 2 ( Xuu ) V 2 	(2.31) 
	?	1 - tt ?
2.5 Environmental disturbances, forces and moments 
2.5.1 Wave forces and moments 
To simulate the motion of a vessel in presence of irregular waves, the effect of 1st and 2nd order wave disturbances will be considered. 
      The 2nd order is treated as wave drift forces in x, y and z directions. It can be modeled by three slowly-varying parameters: d = [d1  d2  d3]T. It is a vector of zero mean Gaussian white noise processes. 
      The 1st order wave disturbances formulae for a ship where the wetted part is a rectangular parallelepiped with length L, breadth B and draft T [30] are: 
N
 	Xwave ( )t = rgBLT cosbs ti ( ) 	(2.32) 
i=1
N
 	Ywave ( )t =	-rgBLT sinbs ti ( ) 	(2.33) 
i=1
 	 	(2.34) 
where b is defined in Fig. 2.3 and si is the wave slope. 
o 
 
Fig. 2.3 Definition of ship’s heading (encounter) angles [60] 
      These equations will only hold if the ship is small compared to the wavelength and the water surface crossing the hull can be approximated as a plane surface. An alternative approach, removing the assumption of plane water surface, can be derived by assuming that (ki, L), (ki, B), (ki, T) are small. This results in the same expressions for Xwave and Ywave while Nwave is modified to: 
 	 	(2.35) 
where Vis wave height. 
2.5.2  Wind forces and moments 
The resultant wind forces and moments acting on a vessel are usually defined in terms of relative wind speed VR (knot) and gR(deg) according to: 
 	VR =	uR2 + vR2	gR = tan-1 (vR /uR ) 
where the components of VR in the x and y directions are: (2.36)  	uR = Vw cos(gR ) - u + uc (2.37)  	vR = Vw sin(gR ) - v + vc (2.38)       Here (u, v) and (uc, vc) are the ship and current velocity components while gR =y yw - is the angle of relative wind to the ship bow Fig. 2.4. 
      According to Isherwood [28], [57] the formulae of wind forces (surge and sway) and moment (yaw) can be expressed as 
 	 	(2.39) 
 	 	(2.40) 
 	 	(2.41) 
where  
CX, CY : force coefficients 
CN  : moment coefficient rw : air density [kg/m3] AT : transverse projected area [m2] AL : lateral projected area [m2] L : overall length of the vessel [m] 
 
Fig. 2.4 Definitions of wind speed and wind direction 
The coefficients CX, CY and CN are defined by the following formulae: 
 	 	(2.42) 
  	(2.43) 
 	 	(2.44) 
where 
	ASS 	: lateral projected area of a superstructure 
S 	: perimeter length of the lateral projection of the model excluding waterline and slender bodies such as masts and ventilators. 
	C 	: distance from the bow of centroid of lateral project area 
M 	: number of distinct groups of masts or kingposts seen in a lateral projection; kingposts close against the bridge front are not included 
and Ai, Bi (i=1..6) and Cj (j=1..5) are tabulated in Appendix E.3. 
2.5.3  Current-induced forces and moments 
According to 10th ISSC [1] the surface current velocity Vc is the sum of the following velocity components: 
 	Vc = Vt + Vlw + Vs + Vm + Vset up-	+ Vd (2.45) Vt : tidal component Vlw : component generated by local wind Vs : component generated by nonlinear waves (Stokes drift) Vm : component of major ocean circulation (e.g. Gulf Stream) Vset-up : component due to set-up phenomena and storm surge 
Vd 	: local density driven current components governed by strong density jumps in the upper ocean. 
      The method of defining the current-induced forces and moments is based on the assumption that the equation of motion can be represented in terms of the relative velocity: 
 	nr =n n-	c 	(2.46) 
where nc = [uc vc wc 0 0 0]T is a vector of irrotational body-fixed current velocities. The earth-fixed linear velocity could be transformed to body-fixed linear velocities by applying the principal rotation matrices. Let the earth-fixed current velocity vector be denoted by ?? E E E ??. Hence, the body-fixed components can be computed as: 
	?	?	?	?
where  	??wc ??	??wcE ???c(y)c(q)
 	J1 ( )h2 = ??s( ) ( )y c q
?? -s( )q-s(y)c(f) +c(y)s(q)s(f) s(y)s(f) +c(y)c(f q)s( ) ? c( ) ( )y c f +s( ) ( ) ( )y s q s f -c( ) ( )y s f +s( ) ( ) ( )y c f qs ?? (2.48) c( ) ( )q s f c( ) ( )q fc ??	?	?
 	?v ? = J (h) ??v ?? 	(2.47) 
      Let us assume that body-fixed current velocity is constant or at least slowlyvarying such that the following holds: 
 	n?c = 0	n n?r = ? 	(2.49) 
Hence, the nonlinear relative equations of motion (2.5) take the form: 
 	Mn??+ C (nr )nr + D(nr )nr + g(h t) =	 	(2.50) 
 	h??= J (hn) 	(2.51) 
 Notice that this model representation is based on the state variables (n, ,nhc ) with nr =n n- c . 
2.6 Applying the mathematic model of a vessel in research 
Nowadays, using computer simulation in researches is a must because it is very cheap and effective. The formulae from (2.4) to (2.51) describe the motion of a vessel together with the effects of the environment. They are essential for simulating a vessel on the computer. However, many parameters in these formulae are difficult to define so simulating the movement of a vessel exactly is very difficult. 
      During the time of the research, all experiments were carried out using computer simulation and then using the scaled model on the lake. Appendix C presents the mathematical model of Blue Lady and the experiments’ results, which compare the simulation model and the scale model. Besides using the simulation model of  Blue Lady, some experiments were conducted with other simulation models, which were introduced by Thor I. Fossen (see section 5.4). 

Chapter 3 Autopilot controllers  
3.1 Autopilot fuzzy logic controllers  
Four fuzzy logic controllers are used in this autopilot: Two course keeping controllers (one for the Trajectory segment regulator and one for the Positioning regulator) and two position keeping controllers to control the vessel’s position in xb and yb direction. All of them are Mamdani type with the implication method min and aggregation method max (Appendix D).  

 
Fig. 3.1 Fuzzy logic controller of the autopilot 
     Each controller has two inputs and one output. Two inputs are a deviation and rate of deviation (Fig. 3.1). The inputs of the course keeping controller are: error course (Dy) and turning rate (r). The inputs of the x position keeping and y position keeping controllers are dx, u and dy, v (section 4.4) where dx, dy are position deviations in the xb, yb directions in b-frame and u, v are surge and sway (Fig. 4.3).  
3.2 The characteristics of the controllers’ membership functions  
The membership functions of the controllers were built basing on the experience of expert navigators and adjusted according to the results of the experiments which were carried out using computer simulation and the scale model Blue Lady on the lake. 
      The controller were built for the Blue Lady, a model scaled 1:24. When applying the autopilot to other vessels, the input signals should be scaled to match the working ranges of the controllers. See subsection 4.7.6 and Fig. B.10 for the scaling signal when applying the autopilot to different vessels. 
      To apply the algorithm control mentioned in subsection 4.1.1, the controllers have to create the control signals in a form of pulse. The pulse amplitude (force magnitude) is changed by steps and the pulse length (force acting time) is changed continuously. To create this kind of control signal, the output membership functions are of the shape shown in Fig. 3.3a: very narrow and not intersectional. Each membership function assigns one level of control force. Apart from that, the defuzzification method of the controller is bisector which is presented in detail in the next section.  
3.3 Defuzzification method applied for the controllers 
The defuzzification method applied for all the controllers is the bisector method which defines the output value with the formula: 
	yBoA	+?
 	mB ( )y dy = mB ( )y dy 	(3.1) 
	-?	yBoA
      In the formula (3.1), yBoA is the output value of the controller and mB(y) is the fuzzy set in output space (Appendix D).  
       Geometrically, the value of yBoA defines the position at which the output space mB(y) is divided into two parts with the same square measure. Let assume that the output space mB(y) is a polygon ABCDEF. The value of yBoA is defined by the position of line segment ab that the area on the left of ab (polygon ABCEab) equals to the area on the right of ab (polygon baEF), see Fig. 3.2a. 

	yBoA [AF] 	yBoA [AD]or [EH] 
	a) 	b) 	 
Fig. 3.2 Geometrical meaning of the bisector defuzzification method 
      If the output space mB(y) is a connected area (Fig. 3.2a), the output value of the controller can take the values in a continuous range, e.g. section [AF] in Fig. 3.2a. In contrary, if the output space mB(y) forms separate polygons, e.g. ABCD and EFGH in Fig. 3.2b, the output value of the controller will not be continuous. Its value is in the ranges of output space parts, e.g. section [AD] or [EH] in Fig. 3.2b.    
      It should note that, the bisector and centroid defuzzification methods give the same output value when the output space mB(y) is a connected area. When the output space is not connected area, the output of the centroid defuzzification method varies in continuous range while the output of the bisector defuzzification method is not. This deference is shown in Fig. 3.3c. 
      This feature of bisector defuzzification method is used to create the control signal pulse in the controllers of the autopilot. The details of the properties of these controllers can be seen in section 4.3 and 4.4. 
      Fig. 3.3 presents the shape of the input and the output membership functions of the controllers and describes the inference of a fuzzy variable.   
 

	Input 1 	Input 2 	Output 
Membership functions 
 
 
Fig. 3.3 Fuzzy inference of the controllers in the proposed autopilot 
a) Describes of membership functions 
b) Inference in the fuzzy variable 
c) Difference between bisector and centroid defuzzification 
Chapter 4 The autopilot 
4.1 Algorithm and definitions 
4.1.1 Algorithm of control  
According to the conservation of the momentum, an object will always continue its motion with the same velocity unless acted on by an outside force. Hence, to change the moving state (direction, magnitude of translation velocity or angular velocity) of an object, it needs an outside force applied. In this section, the movement control method by controlling magnitude and acting time of a force is discussed. ?? The amount of momentum p of an object depends on two physical quantities: 
?
the mass m and the velocity v of the moving object. It can be calculated by using the following formula: 
 	 	p = mv 
 For the rotating object, the momentum can be calculated by using: pr = (mv?i )
?(4.1) 	?	?
 	 	 	(4.2) 
= Iw?
 	According to Newton’s Second Law and writing in terms of momentum: ?
	?	DV
F = m
 	 	Dt 
	?	?
F tD = m VD
 	It is the same for a rotating object: (4.3)  	?	?
M tD = IDw
 	 	???	? 
FR tD = IDw
 	From (4.3) and (4.4): (4.4)  ?
 	 	[DV,Dw?] = f F( ?,Dt) (4.5)  In this work the problem of controlling a vessel’s motion is limited within the translational motions of a vessel on the Ox, Oy axes and rotational motion around the Oz axis. Therefore, the formula (4.5) can be rewritten for each motion as follows: 
 	 	Du??= f X( ,Dt) 	(4.6) 
 	 	Dv??= f Y( ,Dt) 	(4.7) 
 	 	Dr??= f X Y( , ,Dt) 	(4.8) 
 According to the formulae (4.6), (4.7) and (4.8), it is available to control the motions of a vessel by changing the magnitude of the acting forces or changing the acting time of forces or both of them.  
 The research will focus on the method of controlling a vessel’s movement, in which the force magnitude is changed by steps to play the role of rough control while its acting time is tuned and play the role of fine control. This control method is described in (4.9). In these equations, fDt and fF are defined by the fuzzy variables of a controller whilefdynamic is a dynamic equation of vessel. It presents the behaving of a vessel impressed by forces. This function fdynamic is not necessary to define in the research because the values of ehand e?h, which are inputs of a autopilot, can be measured by the equipment.   
	D =t	fDt (eeh h, ??)

 	F = fF (eeh h, ??)	F = {0; small; medium; big–	–	–	} 	(4.9) 
e?h = fdynamic (m, , ,t eF h)
where 
 Dt 	: acting time of control force 

 F : magnitude of control force  eh : errors, h= [x yn, n,zn, ,fn qyn, n ]T  m : mass of controlled object  t : forces acting on the controlled object 
 There are two phases in control: stabilizing phase and changing phase. The levels of the control force magnitude are assigned to satisfy with the control phases. The  – small levels are assigned for stabilizing phase. The force magnitudes in these levels are set at the values that can control the vessel when errors ehand e?h are small. The – medium levels are assigned for changing phase. The force magnitudes in these levels are set at the values that can maintain the changing rate. Finally, the – big levels are set at the maximal value of the control force given by equipment. They are mostly used to accelerate at the beginning of changing phase.   
 To demonstrate how the algorithm works in practice, one may observe the result of the simulation experiment (Fig. 4.1), which was performed by a course keeping controller, which applied this algorithm to control the Blue Lady model. In this experiment, the Blue Lady model was running at a stable course and then, altered the course 30o to the port side. The experiment was also carried out using different engine modes from dead slow ahead to full ahead to assess the adaptability of the controller to the vessel speed.   

 Applying equations (4.9) to the course control problem,  F is treated as a rudder deflecting angle d; ehis treated as error course Dy and e?his treated as turning rate r. Rudder deflecting angle d is controlled in discrete values basing on error course Dy and turning rate r by the equation 2 of (4.9); while the rudder deflecting time Dt is controlled in continuous value basing on the turning rate r by the equation 1 of (4.9). The quantities eh, e?h and d have relation in the equation 3 of (4.9). 
     In the course controller, the set values for d are 0o, –5o, –10o and –35o. The values –5o are used for maintaining the course when vessel runs stably at the set course. The values –10o and –30o are used when vessel changes the course but –30o are used to accelerate the turning motion while –10o is used to maintain the turning rate at proper range during vessel changes the course.  
 On the graph in Fig. 4.1, the values of d were 0o, -5o, -10o and -35. At each value of d, Dt was adjusted to control the turning rate of the model. Adjusting of Dt is most clearly seen when the model is running on a stable course. In such a situation, the rudder was controlled to maintain the turning rate at 0o/s (stabilizing course). The rudder deflecting angle was d = –5o and the rudder deflecting time Dt was adjusted to minimize turning rate r. The value of Dt depends mostly on the vessel speed. In the experiment result, the rudder deflecting time Dt was changed from 8 s to 20 s respectively to the engine mode changing from full ahead to dead slow ahead when the model was running on a stable course (see Fig. 4.1). 
 The Blue Lady model is of an unstable type with the dead zone [-5o..+5o] so the minimum of rudder deflecting angle is set at the value d = –5o. Because of that, stabilizing the Blue Lady model with exact course and turning rate 0o/s is impossible. In the result shown in Fig. 4.1, the course error is controlled within the range  [-0.5o..+0.5o] and the turning rate was [-0.1o/s..+0.1o/s]. 

	a) Dead slow ahead 	b) Slow 

 
Fig. 4.1 The rudder action while changing and stabilizing the course at different speeds.  
 The result of the experiment also shows that the controller was adapted to the wide range of vessel speeds. Selecting step values of the rudder deflecting angle (levels of control force) is important for the quality of control. It will be presented while discussing each particular controller in the subsequent sections.  
4.1.2  Definitions 
Earth-fixed reference frame (xnyn): The coordinate system xnyn is defined in relation to the Earth reference ellipsoid. According to this coordinate system while the x-axis points towards true North, the y-axis points towards East. 
Path segment reference frame (xsys): The coordinate system xsys is defined in relation to the path segment which the vessel follows up. It is a Cartesian coordinate system with the origin Os fixed on the first waypoint of the path segment and x-axis along the segment Fig. 4.2[49]. 

Fig. 4.2 Coordinate systems and parameters y - vessel course; u - surge speed; v - sway speed; V - vessel speed; xn, yn 
vessel coordinates in Earth-fixed reference frame xnyn; xs, ys  - vessel coordinates in path segment reference frame xsys 
Body reference frame (xbyb): This is moving coordinate system which is fixed to the vessel. The origin Ob of the coordinate system is chosen to coincide with the center of gravity (CG) of the vessel where CG is in the principal plane of symmetry. The axes are defined as (see Fig. 4.3) 
 	x - longitudinal axis (directed from aft to fore)  	y - transversal axis (directed to starboard) 
Reference point: It is a point at which the vessel position has to be maintained (in maneuvering mode or transitional mode). 
Set path (Reference path): The path, which the vessel is steered along, is defined by a set of waypoints. Two the adjacent waypoints assign a path segment and the path is a broken line created by one or more path segments. 
  Each waypoint is defined in Earth-fixed reference frame (xk, yk) for k=1..m.  The way-point database consists of: 
	wpt pos.	= {(x y0, 0 ),(x y1, 1 ),...,(xm,ym )}
                     wpt radius.	= {R R1, 2,...,Rm}  	 	 
  wpt speed. = {V V1, 2,...,Vm} wpt heading. = {y1,y y2,..., m} Property wpt.radius defines the radius of the vessel track when it changes the path segment at a particular waypoint. 
 Property wpt.speed defines the set speed of the vessel on a path segment. The set speed of the vessel does not change in each path segment, but may be different in different path segments [49], [44].  

 
Fig. 4.3 Coordinate systems and parameters ys - set heading; dy - error course; R - reference point; xR, yR - reference 
point coordinates in Earth-fixed reference frame xnyn; dx, dy - reference point coordinates in body reference frame xbyb 
 In the trajectory mode, property wpt.heading is set to -1 and the set course of each path segment is calculated by using positions of the waypoints. In the maneuvering mode the set heading of a vessel is independent from the path segment direction and property wpt.heading stores the set heading for each path segment. Hence, the type of path segment can be recognized by the value of wpt.heading. If the value of wpt.heading is -1, the segment is trajectory segment; it means in this path segment the autopilot will control the vessel using a trajectory mode. If value of wpt.heading is greater than or equals 0, the path segment is a maneuvering segment and the autopilot will control the vessel using maneuvering mode. These control modes are mentioned in section 4.2. 
Trajectory problem: According to [22] a trajectory problem involves solving two tasks:  1) Geometric Task: force the y(t) state to converge to a desired path yd(q(t)): 
 	 	limtfi? ??y(t) - yd (q(t))?? = 0  	(4.10) 
 for any continuous function q(t). Where yis the vector state of the vessel position-orientation in s-frame; yd ( )t = ??xd ( )t yd ( )t yd ( )t ??T is the vector state of the set point on the trajectory. 
 	2) Dynamic Task: force the speed q?(t) = ??u t( ) v t( ) r t( )?? to converge to the 
desired speed vs:  	 limtfi? ??q?( )t - vs (q( )t )?? = 0 (4.11)       The above definition implies that the dynamic q q= (t) along the path can be specified independently from the error dynamics. A special case of a maneuvering problem is: 
 	 	q?(t) = 1,	q(0) = 0 	 (4.12) 
which may be recognized as a tracking problem since the solution of (4.12) is q = t. 
Maneuvering problem: According to [22], [7], [20], [26], [55] an objective will be referred to as a tracking problem when it is to force the system output y(t)?Rm to track a desired output yd(t)?Rm. A maneuvering problem is treated as a kind of tracking problem here. 
 Tracking of a time-varying reference trajectory hd(t)=[xd(t) yd(t) yd(t)]T is achieved by minimizing the tracking error, h(t) - hd(t), where h(t)=[x(t) y(t) y(t)]T. A tracking error can be decomposed in a vessel parallel (VP) reference frame according to: 
?e1 ?
 	 	e = ??e2 ?? = RT ( )y (hh-	d ) 	(4.13) 
??e3 ??
 	where R(y)?SO(3) is the rotation matrix in yaw. Expanding (4.13) yields 
	?e1 ?	? cosy(x - xd ) + siny(y - yd ) ?
  ?e2 ? = ??- siny(x - xd ) + cosy(y - yd )?? (4.14) ?	?
	??e3 ??	??	y y-	d	??
 	The physical interpretations of ei (i=1,...,3) are:  	 	e1 = path tangential tracking error  	 	e2 = cross-tracking (normal to path)  	 	e3 = heading error 
 A system with three or more controls is named a fully actuated dynamic positioning (DP) system and its applications are the crab-wise motion (low speed maneuvering) and the station-keeping. 
4.2 Autopilot’s setup 
For a complete voyage, the autopilot has to control the vessel using different control modes such as the trajectory mode when the vessel sails at sea; the maneuvering mode when the vessel leaves/approaches the quay and the transitional mode when the vessel changes from the trajectory mode to maneuvering mode. 
 In the trajectory mode, vessel is controlled to move along the set path with the set speed. The set speed must not be less than the minimum speed at which the rudder is effective enough to control. In this mode vessel is managed by the main engine and rudder only.  
 In the maneuvering mode, vessel is controlled at very low speed, moving on the set path with high accuracy of position and heading control; vessel may move in any direction and/or turning without changing the position. Therefore, it needs substantial support from different propulsion sources such as thrusters, the main engine and the rudder. 
      There are big differences in controllable speed ranges between control modes so when a vessel changes from the trajectory mode to maneuvering mode, the autopilot has to control the vessel in the transitional mode. In this mode the speed of the vessel reduced from the lowest speed of the trajectory mode into the speed range of the maneuvering mode. While reducing the speed, the track and the course of the vessel also have to satisfy the required set path.  
 	Fig. 4.4 shows the diagram of the autopilot. 
 
Fig. 4.4 Autopilot’s setup 
Interface block: This block works as an electronic map and the operators’ panel of the autopilot. It displays the navigation chart and the vessel state on the screen. On the interface, the user may create, save or edit a set path of a voyage. The details of the Interface are presented in section 4.6 and in Appendix A. 
Processing block: The requests of a user often are variegated and therefore complicated for regulators. In almost every case, the regulator cannot fulfill user requests directly. This autopilot uses Processing block to translate user requests into single commands, which match the functionality of each regulator and send them one by one to regulators in appropriate time until the user’s requests are completed.  
Speed calculation: The speed of vessel is calculated by using the following formula: 
 	V =	u2 + v2 	(4.15) 
u and v is the surge and sway of the vessel, which are calculated by using the coordinates xn, yn given by DGPS and course y from a gyrocompass processed by a Kalman filter (see section 4.4) 
Trajectory segment regulator: The task of the Trajectory segment regulator block is to control the vessel by rudder and the main engine to move along a straight path segment at a set speed. The path segment is defined by five parameters, which are sent from the Processing block to the regulator. Four of the parameters are the coordinates of two waypoints that define the path segment. The fifth parameter defines the set speed in the path segment (Table 4.8). The algorithm of the block is presented in detail in section 4.3. 
Positioning regulator: The task of the Positioning regulator is to keep the vessel position stable at the reference point R with the heading as set. Contrary to the Trajectory segment regulator; the Positioning regulator receives only three parameters: coordinates of the reference point R and set value of heading in the path segment (Table 4.8).  
 To move a vessel along the set path in the maneuvering mode, the Processing block is programmed to move the reference point R along the path. The Positioning regulator tries to maintain the vessel position at the reference point R while R is moving so it causes the vessel to move on the set path. The algorithms are demonstrated in detail in sections 4.4 and 4.5.2. 
Signals selector: The Processing block sends commands to two regulators at the same time. Each regulator processes signals by its own algorithm and sends out the control signals. The task of Signals selector block is to select signals which are suitable for the current situation. The situations are described as follows: 
- A vessel is controlled in a trajectory mode: The Signals selector block transfers signals from the Trajectory segment regulator to the main engine and the rudder. The vessel is controlled only by Trajectory segment regulator. 
- A vessel is controlled in a maneuvering mode: The Signals selector block transfers control signals from the Positioning regulator to the main engine, the bow and stern thrusters. The vessel is controlled only by the Positioning regulator. This mode is active only when the vessel speed is within the maneuvering speed range; otherwise, the transitional mode is active. 
- A vessel is controlled in a transitional mode: In this mode a vessel is controlled by both regulators. The Positioning regulator controls the bow and stern thrusters while the Trajectory segment regulator controls the rudder. In this mode, the main engine is controlled directly by the Processing block, see subsection 4.5.3 for detail. Table 4.1 Propulsion control in each controlling mode 
 In trajectory mode In maneuvering mode In transitional mode Main engine Controlled by SR(*) Controlled by PR(**) Controlled by P(***) Rudder Controlled by SR(*) Set to 0 Controlled by SR(*) Thrusters Set to 0 Controlled by PR(**) Controlled by PR(**) (*) 
      : SR - Trajectory segment regulator (**)
   	: PR - Positioning regulator (***)
	 	: P   - Processing block 
4.3 Trajectory segment regulator 
This regulator is of the cascade type. It controls a vessel moving along a path segment by setting the leading course to the Course keeping controller. In this algorithm, the leading course is calculated by using the direction of the path segment yk, cross deviation y and weather conditions. Each component of the leading course is calculated in a block. The blocks are: yk calculation block, Cross dev. reducing block and Drift reducing block (Fig. 4.5). See formula (4.22) for details of the leading course calculation. 
 
Fig. 4.5 The Trajectory segment regulator y - actual course; yk - direction of the path segment kth; Dyk - course 
deviation in the current path segment; Dyd – correction angle for reducing drift; Dyc – correction angle for reducing cross deviation y; r - turning rate;  Vk - set speed in the path segment kth; V - actual speed; d - rudder angle;  n - r.p.m; x, y – coordinates of vessel position in xnyn.  
Speed calculation: The speed of vessel is calculated by using the following formula: 
 	V =	u2 + v2 	(4.16) 
u and v are the surge and sway of the vessel, which are calculated by using the coordinates xn, yn given by DGPS and course y from gyrocompass processed by a Kalman filter (see section 4.4) yk calculation: This block enables one to calculate the direction of the current path 
segment using coordinates of waypoints. The formula used in this block runs as follows: 
 	yk =p
90?
270?	k	k+1
if (xk = xk+1)AND(yk+1 > yk) if (xk = xk+1)AND(yk+1 < yk)(4.17) 		if x <> x
Cross dev. reducing: This block enables one to calculate the correction angle Dyc to reduce the cross deviation y (Fig. 4.6). The correction angle Dyc is calculated by using cross deviation y by an empirical function (4.18).  
 	The experiment of building up function Dyc = f y( )was carried out as follows: 
A vessel runs with stable course. At a particular moment the set course is changed by 
Dyc [o]. In this situation, the controller alters and then stabilizes the vessel at the new set course.  The distance y from the position where the vessel starts changing the course to the new stable vessel track is the drift y (Fig. 4.6). The experiments are carried out using different values of Dyc such as 90o, 60o, 45o, 30o, 15o and 6o to get the respective drifts values y90, y60, y45, y30, y15 and y6. Using the recorded data of y vs. Dyc and using Horner’s method [18] to define the coefficients of polynomial, function Dyc = f y( ) is built up in the following form: 
 	Dyc = a y1	5 + b y1	4 + c y1	3 + d y1	2 + e y1	+ f1 	(4.18) 
      In operation, when vessel has a cross deviation y, the Cross dev. reducing block provides Dyc (calculated by using (4.18)), which corrects the leading course to direct the vessel towards the set path. 

Fig. 4.6 The relation between correction angle Dyc and cross deviation y 
Drift reducing: In many cases, the stabilization is achieved but a vessel does not run on the set path. It runs in parallel to the set path with small steady drift. The function of the Drift reducing block is to reduce this kind of drift. The formula used in the block is  
	0	if Dy y> D	limit
 	Dyd = 	(4.19) k ydt	if Dy y? D	limit
      The output signal of this block is the correction angle Dyd, one part of the leading course. The value of Dyd is integrated from value of drift y (cross deviation) so if a vessel runs on one side of the path segment, the value of Dyd increases with time. The increase of Dyd causes the leading course change to the path segment side and the vessel is directed to the path segment.  
      This block should only be used when a vessel is sailing steadily. It should be turned OFF when the vessel is changing its path segment and turned ON when the vessel is sailing steadily along the path segment. The course error Dy is used to recognize the status of the vessel. If Dy is within the range of the limited value Dylimit, the vessel is considered to be sailing in a stable way on the path segment and the Integrator function of the block is turned ON. Otherwise, the output of the block is set to 0.    
Course keeping: It is a Fuzzy logic controller block whose task is to keep the vessel course stable at the leading course. Its properties are shown in the Table 4.2 
Table 4.2 	Course keeping - Fuzzy logic controller properties: 
FIS type Mamdani # Inputs 2 # Outputs 1 AND method min OR method max Implication min Aggregation max Defuzzification bisector  To fulfill its task, the controller has to maintain the course error and turning rate at the value of 0. Due to this, the input membership functions are established symmetrically around 0 (Fig. 4.7). The first input is the course error Dy. Its range is  [-180o +180o]. When the course error ranges from [-60o +60o], the controller controls the course according to different rules depending on the situation. When the error course is greater than +60o, the controller controls the course according to the rules for course error +60o. It is similar in the case when the course error is less than -60o. The second input is the turning rate. Its input range is set to cover the turning rate range of common vessels. In practice, this range is [-3o/s +3o/s]. If the rate of turn is out of that range, the controller controls by the rules for turning rate of -3o/s or +3o/s.  

-60 -40 -20 0 20 40 60	-3 -2 -1 0 1 2 3 Dy [o] 	r  [o/s] 
 
  	a) Course error  	b) Rate of turn 
Fig. 4.7 Membership functions of inputs 

	d  [o] 	 
Fig. 4.8 Output membership functions 
 The output membership functions are shown in Fig. 4.8. The output signals, the rudder deflecting angle set, are fixed at 3 levels: –s, –m, –b. Level –s is set at –5o because the Blue Lady model is of an unstable type and its dead zone is –5o (see  Fig. 5.4). This level is used when a vessel is running steadily at the set course. Other levels –m and –b are mostly used when vessel changes course or path segment. Their values are set basing on the experience of experts. In practice, the rudder is often deflected to –10o when a vessel changes course from 30o to 60o; when a vessel changes its course at a larger angle, the rudder often becomes deflected to –35o at the beginning to accelerate and then returns to –10o to maintain the turning rate. 
 
      The connection between input and output variables of the controller is defined by its rules. There are 63 control rules in this controller. These rules are defined base on the knowledge of expert navigator and shown in Fig. 4.9. 
 Error Course -vb -b -m -s z +s +m +b +vb-b -b -s +s +m +m +m +b +b +b -m -b -m z +s +s +s +m +b +b -t -b -m -s +s +s +s +m +m +b z -b -m -s -s z +s +s +m +b +t -b -m -m -s -s -s +s +m +b +m -b -b -m -s -s -s z +m +b +b -b -b -b -m -m -m -s +s +b  
Fig. 4.9 Rules and output surface of the Course keeping controller 
Leading course: It is calculated by using the direction of the path segment yk, cross deviation y and weather conditions by 3 blocks: the yk calculation block, the Cross dev. reducing block and the Drift reducing block (Fig. 4.5). According to the diagram in Fig. 4.5: 
 
Rewrite (4.20) Dy = (yk -y) + ((yk -y) + Dy yc ) + D	d (4.20)  	Dy y+ D	- D
	y y=	k +	c	d	y (4.21) 2
When a vessel runs steadily, the mean course of a vessel reaches a stable value. 
This stable value is the leading course yleading. Therefore, the formula to calculate yleading is as follows: 
 
where 	Dy y+ D	- D
	yleading =yk +	c	d	y 	(4.22) 
2 Dyc : the correction angle to reduce cross deviation y (Fig. 4.6)  Dyd : the correction angle to reduce drift position Dy : the input value of the Course keeping controller (Fig. 4.5). Its value is stable when the vessel runs with a stable course.       The role of Dyc and Dyd is to reduce the cross deviation y but they work differently. Dyc is a proportional function of y so it acts immediately when cross deviation appears. On the other hand, Dyd is an integral function of y with a small ratio so its effect increases slowly with time. 
      The variation of yleading depends on the values of Dyc and Dyd and can be described as follows:   
	No 	Disturbance 	Disturbance 
c) 
Fig. 4.10  The relation between vessel track and leading course  
    • In the case of no disturbance: If the cross deviation exists (y „ 0), the Cross dev. reduce block will provide the correction angle Dyc calculated by using the value of y by formula (4.18). The correcting angle makes the vessel to turn its heading to the path segment side. Hence, cross deviation y is reduced quickly to 0. In that case, the effect of the Drift reducing block is very small (Dyd » 0) and the leading course is the same as the path segment direction (yleading = yk) and the vessel runs steadily on the set path (Fig. 4.10a). • In the presence of disturbance: the vessel is drifted out from the path segment. While drifting out, the value of Dyc increases with the increasing of y (Fig. 4.6) and causes the leading course to change. The value of y will stop increasing when leading course reaches a value at which the disturbance becomes balanced by the engine power of the vessel. Since this moment, stabilization is achieved and the vessel runs in parallel with the path segment (Fig. 4.10b).  
	Dy yc + D	d	(	d	)
 	yleading =yk +	Dy » 0 	(4.23) 
2
      While the vessel is running on the one side of the path segment, the value of Dyd increases with the time. The increase of Dyd makes leading course change to path segment side and the vessel moves closer to the path segment. When the vessel reaches the path segment, y = 0 fi Dyc = 0 and Dyd reach stable values.   
	Dy yc + D	d	(	c	)
 	yleading =yk +	Dy = 0 	(4.24) 
2
      In this case of gaining stabilization, the leading course yleading is different from direction of the path segment yk (Fig. 4.10c). The difference depends on the magnitude of disturbance. 
      Summing up, when disturbance acts on the vessel, the Cross dev. reducing acts immediately and assigns the value of Dyc against the disturbance. Then, the value of Dyd is adjusted by Drift reducing block to gradually replace the value of Dyc until it reaches Dyc = 0. For more details see the results of an experiment in Fig. 5.27b from second 0th to 300th. 
4.4 Positioning regulator 
The main task of the Positioning regulator is to keep the position of the vessel stable at the reference point with the set heading. It has three fuzzy logic controllers: One controls yawing, one - side moving, and one - the longitudinal movement of the vessel. Three controllers work together to perform the regulator task (Fig. 4.11). 

	a) 	b) 	c) 	 
Fig. 4.11 Forces diagram in maneuvering control 
a) Control heading 
b) Control side-moving 
c) Control longitudinal moving 
 The Fig. 4.12 shows the regulator schema. The function and the algorithm of each block are presented below: 
 
 
Fig. 4.12 Schema of the Positioning regulator 
Deviation calculating: This block enables one to calculate the position deviation of a vessel in the body reference frame xbyb. Two components of deviation may be calculated: longitudinal deviation dx and transverse deviation dy.   
 	 	dx = yR tany+ xR - x - y tany 	(4.25) 
1 + tan2y
 	 	dy = yR - xR tany+ xtany- y 	(4.26) 
1 + tan2y
 
Speed calculation: This block makes it possible to calculate the surge (u) and sway (v) of a vessel using the values of x???, y?? and course y? which are the outputs of the Kalman filter. The values u and v are calculated by using formulae (4.27) and (4.28). 
 	 	y	y? 	(4.27) 
 	 	v = y??n cosy??- x??n siny? (4.28)  The stationary Kalman filter used in the autopilot has three inputs: xn, yn coordinates and course y. They are provided by DGPS and the gyrocompass. The matrix coefficient and vectors of the filter are as following [24]: 
 	The vector state: 
 
The model:  ?q??? q	?qww ??
?qw = {x yn, n,y} (4.29) 	q	A	q	G
 	 
     = Cq *qfw k( ) + vq k( ) qwp k( )(4.30) E w( q k( ),wq k( ) ) = Qq
 	E v( q k( ),vq k( ) ) = Rq (4.31) E w( q k( ),vq k( ) ) = 0
The estimated values of the coordinates and the course: 
 	q?fw k( +1 )k= Aq *q?fw k k(-1) + KFq *(qwp k( ) - Cq *q?fw k k(-1)) 	(4.32) 
      The gain matrices KFq are derived by solving a discrete Riccati equation. It can be found in the dlqe procedure in the library of “Control System Toolbox” of Matlab. 
The state matrix and covariance matrix: 
?1 0?
 	Ax = Ay = Ay = ?1 1?? 
?(4.33) 	?0.1	0 ?	?0.04
 	Gx = Gy = ? 0	0.02??;	Gy = ?? 0
?0 ?
0.08?? (4.34) 	?0.04	0 ?	?0.02
 	Qx = Qy = ? 0	0.04??;	Qy = ?? 0
?0 ?
0.04?? (4.35)  	Cx = Cy = Cy = [0 1] (4.36)  	 	(4.37) 
 
Signals saturation: Input signal of thrusters is summed from outputs of two controllers Course keeping and y position keeping. Therefore, the signal may be out of input range of the thrusters. The task of the Signals saturation block is to process signals that its outputs satisfy: 
• signals are in the input range of thrusters, and  • the difference of input signals and difference of output signals are the same (to maintain the moment for course keeping task). 
      The algorithm of this block is shown in the Fig. 4.13. Variable H has value of the highest amplitude of input signals. If value H is in the input range of thrusters, both signals are sent out directly without any change.  In the contrary, both signals are subtracted by overbalancing of subtracting H by the maximum level of input range. By subtracting, the maximum of the outputs is equal to the maximal level; and the difference of input signals are same as difference of output signals, see the proof in equation (4.38). 
	output2 output1-	= (input2 - (H maxlevel-	)) - (input1 - (H maxl-	evel))
 	 	 (4.38) 
= input2 input1-
 In this algorithm the course control is given higher priority than side-moving control. When the control signals are truncated, moment for course keeping task is maintained but the magnitudes of side controlling forces are cut down.    

 
Fig. 4.13 Signals saturation block algorithm 
Course keeping: It is a fuzzy logic controller block with the task of keeping the vessel course. Its properties are shown in Table 4.3. 
Table 4.3 	Course keeping - Fuzzy logic controller properties: 
FIS type Mamdani # Inputs 2 # Outputs 1 AND method min OR method max Implication min Aggregation max Defuzzification bisector  This controller has the same task as the Course keeping controller mentioned in section 4.3 but the thrusts equipment are different. It controls the thrusters (bow and stern) to maintain the vessel course. Due to controlling by thrusters the ranges of two inputs course error (o) and turning rate (o/s) are also different to the ranges of the Course keeping controller mentioned in 4.3. The ranges and the membership functions of the inputs are shown in the Fig. 4.14. 

	-30 -20 -10 0 10 20 30	-1 -0.5	0	0.5	1
	Dy [o] 	r [o/s] 	 
 	a) Course error  	b) Rate of turn 
Fig. 4.14 Input membership functions of the Course keeping controller  
 The output membership functions are shown in Fig. 4.15. The levels are –s, –m and –b respective to 1/3, 2/3 and full power of the thruster. The level –s is used to stabilize the vessel course. The level –m is used to turn the vessel when the error course is less than –15o. The level –b is used to accelerate and keep the turn rate of the vessel when the error course is greater than –15o. 

PowerOfThruster 
 
Fig. 4.15 Output membership functions of the Course keeping controller  
 This controller manages two thrusters (bow and stern). Both control signals to these thrusters have the same amplitude but opposite sign (see Fig. 4.12). 
This controller has 49 rules. They are shown in Fig. 4.16.  
 Error Course -b -m -s z +s +m +b -b +b +b +b +b +m +s -m -m +b +b +b +m +s z -m -s +b +b +m +s z -s -b z +b +m +s z -s -m -b +s +b +s z -s -m -b -b +m +m z -s -m -b -b -b +b +m -s -m -b -b -b -b 		 
Fig. 4.16 Rules and output surface of the Course keeping controller  
y position keeping controller: It is a fuzzy logic controller block. It controls the side movement of a vessel. The task of the block is to keep the vessel position closest to the reference point in y direction of the b-frame. Its properties are shown in Table 4.4 Table 4.4 y position keeping - Fuzzy logic controller properties: 
FIS type Mamdani # Inputs 2 # Outputs 1 AND method min OR method max Implication min Aggregation max Defuzzification bisector  The two inputs are dy deviation (m) and sway v (m/s) with membership functions are shown in Fig. 4.17. The input ranges are established with the consideration of a vessel width. The Blue Lady model is 2.38 m wide so the range of deviation y is set in [-5 m +5 m]. In addition, the main task of the controller is to keep the vessel close to the reference point. It means the y deviation should be maintained around the value of 0. Because of that, the membership functions are symmetrical as shown in Fig. 4.17 and the range [-5 m +5 m] is appropriate for the Blue Lady model.  This range is 4 times as big as the beam of Blue Lady. 

	-5 -4 -3 -2 -1 0 1 2 3 4 5	-0.2	-0.1	0	0.1	0.2
	dy [m] 	v [m/s] 	 
 	a) y deviation 	b) sway 
Fig. 4.17 Input membership functions of y position keeping controller 
 

	PowerOfThruster 	 
Fig. 4.18 Output membership functions of the y position keeping controller 
 The output membership functions are shown in Fig. 4.18. The effect of bow and stern thrusters are different for side movement control so the signals sent to the thrusters are set to ratio k in the gain block (Fig. 4.12). Ratio k is calculated to minimize the course changes when a vessel is moved to the side by thrusters. 
This controller has 49 rules. These are shown in Fig. 4.19. 
 Deviation -b -m -s z +s +m +b -b +b +b +b +b +m +s -s -m +b +b +b +b +m z -m -s +b +b +m +m z -s -b z +b +m +s z -s -m -b +s +b +s z -m -m -b -b +m +m z -m -b -b -b -b +b +s -s -m -b -b -b -b  
Fig. 4.19 Rules and output surface of the y position keeping controller 
x position keeping controller: It is a fuzzy logic controller block. It controls the longitudinal movement of a vessel. The task of the block is to keep the vessel position closest to the reference point in x direction of the b-frame. Its properties are shown in Table 4.5. The membership functions of the controller have nine zones. Five of them (from -b to +b) are proportional to the membership functions of y position keeping controller. Two others (-vb and +vb) are used in the case of braking up a vessel  (Fig. 4.20, Fig. 4.21 and Fig. 4.22) 
Table 4.5 x position keeping - Fuzzy logic controller properties: 
FIS type Mamdani # Inputs 2 # Outputs 1 AND method min OR method max Implication min Aggregation max Defuzzification bisector  The two inputs are dx deviation (m), surge u (m/s) with membership functions as shown in Fig. 4.20: 

-5 -4 -3 -2 -1 0 1 2 3 4 5	-0.2	-0.1	0	0.1	0.2 dx [m] 	u [m/s] 
 	a) x deviation 	b) surge 
Fig. 4.20 Input membership functions of the x position keeping controller 
 In the maneuvering mode, the movements in every directions have same priority therefore the output signals of the controller x position keeping in levels –b, –m and –s must correspond respectively to the levels of y position keeping. Apart from that, the hull of the vessel is designed with priority in longitudinal moving so the resistance in this direction is small and to brake up vessel needs high power. Levels +vb/-vb with full engine ahead/astern are reserved for this purpose (Fig. 4.21).  

r.p.m 
 
Fig. 4.21 Output membership functions of the x position keeping controller 

 Deviation -vb -b -m -s z +s +m +b +vb-vb +vb+vb+vb+vb+vb+vb+m +s z -b +vb+vb+vb+vb+vb+vb+s +s -s -m +vb+vb+vb+vb+m +b z z -m -s +vb+vb+vb+b +m z -s -m -b z +vb+b +m +s z -s -m -b -vb +s +b +m +s z -m -b -vb -vb -vb +m +m z z -b -m -vb -vb -vb -vb +b +s -s -s -vb -vb -vb -vb -vb -vb +vb z -s -m -vb -vb -vb -vb -vb -vb  Fig. 4.22 Rules and output surface of the x position keeping controller 
      The controller has 81 rules as shown in Fig. 4.22. The 49 rules of them control the vessel in the longitudinal direction similarly to the y position keeping controller which controls the vessel in the transverse direction. The 32 other rules are active when the value of surge and/or x-deviation is too large in the control range. By these rules, a vessel is driven with maximum power of the main engine.  
4.5 The Processing block  
The autopilot has two regulators: the Trajectory segment regulator and the Positioning regulator (section 4.2). Each regulator controls a vessel only during a simple movement. The Trajectory segment regulator can control a vessel moving along a straight trajectory segment and the Positioning regulator can keep the vessel position at a reference point. 
      These regulators are managed by the Processing block. The Processing block plays a role as a center processor. It determines which regulator(s) is (are) suitable for the current movement and sends commands alternately to the regulator(s) in proper time to perform the complex movement of the vessel. 
      By programming in the Processing block, many different vessel movements can be performed. This section shows the methods used in the Processing block to control a vessel during a certain typical movements. These are: 
• Controlling a vessel along a pure trajectory set path. In that case, the set path consists of the trajectory segments only and just the Trajectory segment regulator is operated. 
• Controlling a vessel with a pure maneuvering set path. In that case, the set path consists solely of maneuvering segments and only the Positioning regulator is operated. 
• Controlling a vessel with a complex set path. In that case, the set path consists of both path segment types: trajectory segments and maneuvering segments. Both regulators are operated. 
   To perform these forms of movement control one needs some additional algorithms to support the regulators such as “changing path segment in trajectory control mode”, “moving the reference point” and “braking up a vessel”. Changing the path segment algorithm is presented in subsection 4.5.1; the moving the reference point algorithm is presented in subsection 4.5.2 and the last – braking up a vessel algorithm is presented in subsection 4.5.3.    
4.5.1 Controlling a vessel with a pure trajectory set path  
A pure trajectory set path is a path which consists of trajectory segments only. The Trajectory segment regulator can control a vessel running along a straight path segment (section 4.3) by itself. Hence, the task of the Processing block is very simple; it just sends data concerning the path segments one by one to the Trajectory segment regulator at an appropriate moment.  
 
 
Fig. 4.23 Passing distance dpass in changing path segment 
      What is the proper moment to change a path segment? It is defined by passing distance dpass (Fig. 4.23). Passing distance dpass is the distance to the forward waypoint at which the vessel should start changing the course to approach the next path segment with minimal deviation. According to the results of the experiment presented in section 4.3 (Fig. 4.6) and formula (4.18), which shows the relation between the drift y and course change angle Dyk, from value of y and Dyk (Fig. 4.23), the passing distance dpass can be calculated by using formula below:  
 	dpass =	y	 	(4.39)  
sin Dy
      In practice, formula (4.39) is not suitable when the course change Dyk is less than 30o or greater than 90o. When the course change Dyk < 30o, there is a lot of time for acceleration in comparison with the total time needed to complete the course change actions. Hence, passing distances for every course change Dyk < 30o are almost the same. Therefore, they are set to the same value as the passing distance for  Dyk = 30o. When changing course Dyk is greater than 90o, the passing distance dpass should be set as equal to the passing distance for Dyk = 90o, because while a changing path segment at this passing distance, the vessel neither runs over the waypoint nor turns too far before reaching the waypoint. Therefore, the formula used in the Processing block is: 
	y30	= 2.y30	if Dyk ? 30?
  	(4.40) 
	y90	= y90	if Dyk > 90?
?
sin90
 
       The Processing block calculates the distance from a vessel position to the forward waypoint in real time. When this distance is less than or equal to dpass, it sends data of the next path segment to the Trajectory segment regulator. Since this moment, the Trajectory segment regulator starts controlling the vessel along the new path segment and so on. Because the dpass is calculated by using drift y, the vessel approaches the next path segment naturally without any major course error or cross deviation. Next, course error and cross deviation are also damped quickly by the Trajectory segment regulator. See the result of the experiment in subsection 5.3.1. 
4.5.2  Controlling a vessel with a pure maneuvering set path  
A pure maneuvering set path is a path which consists of maneuvering segments only. In maneuvering mode, the movement of a vessel is controlled indirectly through the reference point R (section 4.4). Hence, the algorithm of vessel control with a pure maneuvering set path certainly is the algorithm of control the reference point R moving along a set path. The algorithm is shown in Fig. 4.25. 
          Accepted range of position 
range of course error 
 	 
Fig. 4.24 Moving reference point R along the set path 
 Let us assume that the accepted range of course error is Dymax and the accepted range of position deviation is lmax (Fig. 4.24). The reference point R can only be moved forward when all the above deviations are within the accepted range. If course error and/or position deviation are greater than the accepted range, The Processing block stops the reference point R and waits for the Positioning regulator to manage the vessel. When all deviations are within the accepted range, the Processing block continues moving the reference point R a long the set path.  

Fig. 4.25 Algorithm of moving the reference point R;  
	k+1, yk+1 	k+1, yk+1 
b) 
 Fig. 4.26 The reference point R relative position and vessel O actual position  
      In the flowchart, (xk, yk) and (xk+1, yk+1) are coordinates of two waypoints of the path segment. The variable vR is the set speed on the set path segment; it is also the set speed for referent point R. The angle a is used to determine the relative position of vessel to reference point R (see Fig. 4.26).  
      When vessel moves stable with l < lmax, it means the vessel has speed as same as reference point speed. When l is equal or a bit greater than lmax: 1) if a < 90o, it means vessel speed is lower than speed of the reference point (V  <  vR). In this case, the moving forward of reference point is restrained by the vessel movement. It can be imaged as the reference point R pulls the vessel by a rope, which has the length lmax  (Fig. 4.26a). 2) If a > 90o, it means the vessel speed V is faster than speed of reference point R (V  >  vR). In this situation, the reference point R can move with its set speed vR. The controller tries to curb the moving forward of vessel to keep the deviation position less than lmax. It can be imaged as the reference point R pulls the vessel back to reduce the vessel speed to set speed vR (Fig. 4.26b) 
4.5.3  Controlling a vessel with a complex set path 
In this case, the set path consists of both types of path segment: trajectory segments and maneuvering segments. The Processing block has the task of changing the control mode of the autopilot at the appropriate moment. The change of the control mode from maneuvering to trajectory mode can be carried out immediately when the vessel is at the starting waypoint of the trajectory segment. In opposite situation, to change the control mode from a trajectory to a maneuvering mode needs a transitional phase. During this phase the vessel is controlled in a special mode, named a transitional mode, to reduce the vessel speed from the trajectory speed range down to the maneuvering speed range.  

segment 
 
Fig. 4.27 The braking distance dbraking while changing control modes 
 In the transitional mode, the autopilot has to 1) keep the vessel course stable in the path segment direction and the vessel movement stable on the path segment; 2) control the braking force to obtain the speed that is within the maneuvering speed range when the vessel is exactly at the waypoint. The braking up of a vessel is carried out in 2 steps: 
Step 1: Starting braking up at the braking distance dbraking.  
 The braking distance dbraking is the distance to the first waypoint of the maneuvering segment, at this distance the autopilot should change from the trajectory mode to the transitional mode to access the waypoint correctly (Fig. 4.27).   
 	In this autopilot, the braking distance dbraking is calculated by using the following formula 
 	dbraking = a u2	4 + b u2	3 + c u2	2 + (d2 + f 2 )u + e2 	(4.41) 
 The coefficients of equation (4.41) are defined from the results of the experiment. The coefficient f2 is the time taken to change the engine mode of a vessel. Other coefficients a2, b2, c2, d2, e2 are defined by the experiment as following: “Vessel is full loading, runs ahead at maximum speed in the wind on a straight path. At a moment, change engine to dead slow astern then record the vessel speed and the passing distance of vessel until vessel completely stops.”   The graph in Fig. 4.28 is an example of the experiment result. On the basis of the recorded data, the coefficients of formula (4.41) are defined by using Horner’s method [18]. 

Fig. 4.28  The relation between the braking distance dbraking and speed of the Blue Lady model when the engine mode is set to dead slow astern 
 The dead slow astern engine mode was used for transitional mode after many experiments on the lake with the Blue Lady model. During braking up vessel, the engine runs astern while vessel moves forward, the chaotic water flow increases and causes abnormal movement of the vessel. If a higher engine mode is used, the chaotic flow will be stronger and the thrusters and the rudder will not be strong enough to manage the vessel. Therefore, the dead slow astern engine mode is proper for braking up a vessel.  
 While the vessel is running along the trajectory segment, the Processing block calculates the braking distance dbraking by using the actual vessel speed in real time and compares it to the current distance to the waypoint. If the distance to the waypoint is less than the braking distance dbraking, the Processing block starts the transitional mode to control the vessel. 
 In the transitional mode, the Processing block sets and controls the reference point R moving along the path segment; and sets the heading as same as direction of the path segment (Fig. 4.29). Both the Trajectory and the Positioning regulators are used and the roles of each controller are as follows: 
- Course keeping controller of the Trajectory regulator controls the rudder to stabilize the course until the rudder has no effect due to low speed. 
- Course keeping controller of the Positioning regulator controls two thrusters to keep the vessel heading as same as the path segment direction. 
- y position keeping controller of the Positioning regulator controls two thrusters to keep the vessel moving exactly along the path segment with the support of the reference point R.  
- The Speed controller of the Trajectory segment regulator and the  x position keeping controller of the Positioning regulator are not used. The main engine is controlled directly by the Processing block to adjust vessel speed (see detail in Step 2) 
Step 2: Adjusting the braking up force 
 After starting the transitional mode, the Processing block has to adjust the braking force to obtain vessel speed within the maneuvering speed range when a vessel reaches the waypoint. The algorithm of adjusting the force is presented below. 
 In this case, the Processing block controls only the main engine. It takes effect on the longitudinal vessel movement only, so in the formula, speed V is replaced with surge u. Hence, the movement equation of a vessel is 
 	 	(4.42) 
  	Rewrite (4.42): 
 	 	(4.43) 
 	where 
 	u1 	: actual vessel surge 
u2 : the required speed (surge) at the waypoint, it should be within the maneuvering speed range. In this autopilot, the value of u2 is set to 0 
 	a 	: average acceleration of a vessel while speed changes from u1 to u2 
 	S 	: the distance passed by a vessel while speed changes from u1 to u2 

x , 
y
 	 
 
 
 
Fig. 4.29 Braking up a vessel 
 The main force needed to brake up a vessel is created by the main engine. As mentioned above, the engine mode for braking is fixed at dead slow astern so the braking force may be treated as a constant force. Hence, the average acceleration a can be treated as constant and it can be calculated as:  
 	 	(4.44) 
      The Processing block reads vessel surge every sampling period and calculates acceleration a as formula (4.44). From values of a, u1 (actual surge), u2 (required surge), the Processing block calculates the distance S called expected passing distance. It is the distance passed by vessel until it gets the speed u2 (Fig. 4.29b). 
      Comparing the expected passing distance S to the actual distance from the current position to waypoint dto waypoint can enable one to predict if the vessel stops before the waypoint or not (Fig. 4.29b). 
 Formula (4.41) is built based on the data obtained during the experiment. This experiment was carried out in the following conditions: a fully loaded vessel, wind blowing to the stern of the vessel. In such conditions, a vessel has the longest passing distance. Therefore, in other conditions such as ballast running, wind ahead, etc., the passing distance is always shorter and the vessel will stop before reaching the waypoint (S is always less than or equal dto waypoint). If S < dto waypoint, the Processing block changes the engine mode to stop engine or dead slow ahead to reduce the braking force or accelerate the vessel. Otherwise, the Processing block keeps engine mode at dead slow astern to the end of movement. The expected passing distance S and dto waypoint are compared in every system sample time during braking up the vessel. The Processing block bases on this comparison to control the braking force. 
 When a vessel is within the control range of the Positioning regulator  (Fig. 4.29c), the Processing block automatically sets the reference point R to the waypoint position and starts the maneuvering mode to control the vessel. At that time, the vessel is controlled by the rules of the Positioning regulator.   
 Using this method, the Processing block reduces vessel speed from the trajectory speed to the maneuvering speed and moves the vessel exactly to the waypoint, ready for a change to the maneuvering mode. See the result of the experiment in subsection 5.3.5. 
 In a complex path, when a vessel is moving along the trajectory path segments, it is controlled by the algorithm presented in 4.5.1; when the vessel is moving along the maneuvering path segment, it is controlled by the algorithm presented in 4.5.2; when the vessel is moving from the trajectory path segment to a maneuvering path segment, the transitional mode is used; when the vessel is moving from the maneuvering path segment to a trajectory path segment, the autopilot can change immediately from the maneuvering mode to the trajectory mode to control the vessel. Consequently, the autopilot can control a vessel following a complex path. 
4.6 The Interface 
The Interface of the autopilot plays two roles: 1) An electronic map and 2) A control panel of the autopilot. As an electronic map, it displays and allows correcting all elements on the map such as constructions of the ports, systems of signal buoys and lights. As a control panel, it displays on the map the instant parameters of a vessel, its actual position and track; it allows creating and storing set paths, selecting a set path for controlling and controlling the vessel instantly through the handle on the screen. 
      There are two versions of the Interface developed for the research. One was coded in m-file format and the other was done in S-function format of the Matlab. The first version requires the connection to the xPC and performs all activities in real time mode. It is often used for real model control on the lake. The second version can be added into simulink diagram as a block (block v-display in Fig. B.8 and Fig. B.9). Its functions are limited within displaying the vessel status and the vessel track on the map only (including the control panel) and it is used in computer simulation experiments. 
4.6.1  Working windows 
There are three working windows in the Interface. These are the main window, the 
Display motion window and the Wind indicator window (Fig. 4.30) 

 
Fig. 4.30 Working windows of the Interface 
      The main window contains a map, a parameters panel and a menu. The map may be zoomed in/out or moved within the main window. On the map, the actual vessel track and the set path are drawn. The coordinates of the mouse cursor in Earthfixed reference frame are also displayed next to the cursor.  
		 
Fig. 4.31 The Display motion window and the Wind indicator window 
      The vessel instant parameters are shown on the panel on the right side of the window. These are: coordinates, speed, rpm, thrusters’ status, rudder angle of the vessel together with the course error, cross deviation, deviations rate, distance to the next waypoint, etc.  
      The Display motion window displays an area of 20·20 m with the vessel figure in the center (Fig. 4.31). In the window, the user can see the actions of the rudder, the main propeller, the bow and the stern thrusters. The user can also see the vessel’s position in relation to the set path to assess the situation visually. In the maneuvering mode and transitional mode, the reference point is shown by “*” mark in this window. 
      The Wind indicator window shows the relative and true directions of the wind. Wind speed is indicated by the length of the arrows in Beaufort scale and by a graph  in m/s (Fig. 4.31). 
4.6.2  Database files of the Interface 
There are three groups of database file: maps, set paths and experiments’ recorded data. The maps group consists of map data files and additional files containing information about the coordinates correction of the map. The set paths are files containing the information about the set paths, which are created by users. The experiments’ recorded data are files which contains the histories of parameters of a vessel and control signals of the autopilot for the whole time of the experiment. 
Database file of a map: There are two kinds of maps to be used in the autopilot. The Interface can display one (primary map) or both of them (primary and secondary map) in the main window. 
      The primary map uses its own structure of a data map file. It may be corrected easily using the map correcting functions of the Interface. 
      In the structure of a primary map file, each element of the map is treated as one object with five properties: 
	 	Obj.name 
	 	.comment 
	 	.x 
	 	.y 
	 	.type 
      The name property contains the name of the object such as the name of a buoy, the name of a lighthouse, etc. This name may be displayed on the map. The comment property contains some notes on the object. It is not displayed on the map. The x and y properties are the coordinates of the object. If the object is a line, a broken line or a polygon, the values of x and y will be vectors of the same length (length ‡ 2). The type property stores all other features of the object such as the object type, (e.g. buoy, light, line, etc.), the color of the object, etc. (see 4.7.5). 
      The map file (map database) is an array of objects. To add/delete an element on the map, it is enough to add/delete the respective object into/from the database file. To correct an element on the map, such as the object name, position, color, light, etc. one must only correct the values of the respective properties. 
      The secondary map can be any type of a Microsoft Windows standard image file. It is only displayed in the window and not correctable. To display the image map in correct position and scale in the main window, it needs to have the original coordinates of image map and scale on x and y axis set correctly. These parameters can be adjusted using the menu of the Interface. Each group of the parameters of one image map is stored in one file in the working folder of the Interface.   
Database file of the set path: the set path is defined by waypoints and stored in a text file. Each line contains the data of one waypoint. From left to right on the line, the properties are consecutively x, y coordinates, radius, speed and heading (for maneuvering mode) of the waypoint (subsection 4.1.2). 
      The set path file can be created or edited by the Interface or by any other text editor. See the example below: 
 
Fig. 4.32 Set path database file 
Database file of experiment: While the autopilot is running, all selected vessel parameters and control signals (see Fig. B.2) are stored in the OutputLog variable on the xPC. They are stored throughout every sampling period and may be saved on the hard disk in a .mat file of the Matlab for further research or other purposes.   
4.6.3  Managing a vessel using the Interface 
The autopilot can control a vessel with a complex set path or an instant path segment. In control with a complex set path, the user can defined a complete voyage “quay-toquay” before starting control. It is useful for a regular route with same outside conditions. In control with instant path segment, the user can control vessel directly by cursor mouse. It is often used for shifting a vessel or moving it within a confined area when the complicated outside conditions. 
      When a user loads a set path from hard disk or creates a new one, all data of the set path is stored in the Host PC memory in a two-dimension matrix variable with the same structure as the structure of a set path database file (mentioned in 4.6.2). In the Interface program this variable is named route. Every change of the set path, such as waypoint position or adding/deleting a waypoint, is updated immediately to the route variable. The reasonableness of data in the route variable is always checked to avoid a running error while controlling the vessel. Invalid data of the set path and the solutions are shown in Table 4.6. 
Table 4.6 The invalid data, error and solution for set path data 
Invalid data Error Solution Two consecutive waypoints are in the same position Error in calculating direction of the segment Delete 	one 	of 	two 
waypoints Two or more consecutive waypoints of trajectory segments are too close (segment shorter than 
vessel length) Vessel cannot perform this request correctly; it may cause a fault in the system.  Replace them with the last waypoint of the too close waypoint group. Data value is out of range Unknown Stop and warn       When a user starts to control a vessel with the set path function, the Interface sends the route variable to the Processing block. The Processing block starts controlling the vessel by its algorithm (Fig. 4.33).   

Fig. 4.33 Control with a set path. A screen snapshot with the main window and the Display motion window 
      When a user starts to control a vessel with the instant path segment functions, the Interface creates a route variable with an instant path segment, the path with one segment, and sends it to the Processing block.   

Fig. 4.34 Instant path segment (trajectory mode) control. A screen snapshot with the main window and the Display motion window. 
      If a user selects the trajectory mode, one end of the instant path segment is the current vessel position and the other is defined by clicking a mouse on the map. Each time the user clicks the mouse on the map, the Interface assigns a new instant path segment which connects the current vessel position to the position where the mouse was clicked. In this way, the user can move the vessel freely just by clicking the mouse. The Fig. 4.34 shows the vessel track when the vessel was controlled by this mode. See Appendix A.3 for more details. 
      If a user selects the maneuvering mode, one end of the instant path segment is the current vessel position and the other is the position of the “handle” (Fig. 4.35). The user can move or turn the handle on the main window by dragging the cursor. The autopilot will control the vessel translational moving on the instant path segment towards the handle.  


The handle appears in maneuvering mode. The vessel position is kept at the reference point 

The vessel heading can be set by dragging cursor mouse to turn the handle  

Drag mouse to move handle to a new position. The instant path segment is created; one end is the initial vessel position and other end is the handle position. 

When the maneuvering action is completed, the instant path segment is deleted and the vessel position is kept at the reference point.  
 

Fig. 4.35 The “handle” in maneuvering control with the instant path segment. The screen snapshot with the Main window and the Display motion window 
4.6.4  Replaying a recorded track 
All vessel parameters and control signals are recorded every sampling period and stored on the hard disk. The Interface can read the data and displays it on the screen, so researchers can observe the action of the vessel and the autopilot. In the re-play mode, time may be scaled to make the action faster or slower. This function is very useful for analyzing the actions of the vessel and autopilot when adjusting the parameters of the autopilot. 
4.7 Hardware and software setup 
4.7.1  Hardware setup 
The components and the physical connection of the autopilot are shown in Fig. 4.36. The programs are installed on two computers: the host computer and the target computer. The host computer (Host PC) interacts with the user, processes user’s requests and sends commands to the target computer (xPC). The xPC receives the commands, processes them in the regulators and then sends control signals to the propulsion control unit to fulfill the user’s requests. 
 
 

Fig. 4.36 General diagram of the autopilot 
 The Host PC and the xPC are connected with an ethernet cable. The navigation aid equipment such as anemometer, gyro compass and DGPS receiver are connected to the xPC through RS-232 ports. The control signals are sent from the xPC to the propulsion control system (concentrator) of the model through a RS-232 port. The parameters of the connection and signals are shown in Table 4.7. 
Table 4.7 	The connection and signals parameters  
Connection  
Type Baud rate 
(bit/s) 	Parameters 	 Host PC to  xPC  
Ethernet  
10Mb  
See Table 4.8 and Table 4.10 xPC to 
Gyrocompass 
Anschutz 
Standard 20 
DGPS Leica System 500  
RS232  
4800  
 
	Heading (o) 	 
	Turning rate (o/min) 	xx.xx RS-
232 9600 UTC time of position 
UTC date  
Grid Easting (m) 
Grid Northing (m) 
GPS Quality hhmmss.ss 
mmddyy 
eeeeee.eee nnnnnn.nnn 
x Number of satellites xx Anemometer 
Gill Model 1390 
Concentrator 
(Propulsion 
Control Unit) Coordinate Quality x.x RS-
485 9600 	Direction (o) 	xxx 
	Speed (m/s) 	xx.xx 
	Temperature (oC) 	xx.x RS-
232 9600 Bow azimuth propeller angle of (o) [-120..+120] 
Power of the bow azimuth propeller  [0..+1] 
Power of the bow thruster 	[-1..+1] Power of the stern thruster 	[-1..+1] 
Power of the stern azimuth propeller[0..+1] 
Stern azimuth propeller angle of (o) [+60..+300] 
	r.p.m  	 	[-200..+480] 
	Rudder angle (o) 	[-35..+35]  The sampling rate of the system is set to one second. It is suitable for to the send/receive period of navigation aid equipment.  

Fig. 4.37 Arrangement of autopilot components  
 The arrangement of the components in the autopilot is shown in Fig. 4.37. The Interface block and the Processing block are installed on the Host PC and run under MS Windows operation system. The Positioning regulator and Trajectory segment regulator and other supporting blocks are installed in the xPC and run under a special real time operation system, which is designed for the xPC and provided as a Matlab toolbox.  
4.7.2  Control command parameters 
The Processing block breaks down the user’s request to commands and sends them to the regulators in the xPC. A command consists of 6 parameters. The parameters are transferred through input blocks: X1_pos, Y1_pos, X2_pos,  Y2_pos, Co_req and u_req  blocks in Fig. B.3. The meaning and value of these parameters are different for different controlling modes and described in Table 4.8. 
Table 4.8 	Parameters of a command 
Parameters Values Trajectory Maneuvering P1 xk - P2 yx - P3 xk+1 xR(*) P4 yk+1 yR(**) P5 Vk Vk P6 -1(***) yk  	(*) 	Coordinates of the reference point R in x axis of n-frame  
 	(**) 	Coordinates of the reference point R in y axis of n-frame  
 (***) Value of -1 means that the vessel is controlled by the Trajectory segment regulator. 
4.7.3  Cross dev. reducing block parameters 
The experiment performed to identify the parameters of formula (4.18) was carried out on the Blue Lady model and the results obtained are presented in Table 4.9. 
Table 4.9 Values of Dy vs. Dyc  
Dyc [o] 90 60 45 30 15 6 0 Dy [m] 40 29 20 13 8 3 0       Basing on the results of this experiment, the coefficients of formula (4.18) are identified as below: 
 	a1  = 	 2.548e-006  d1 =      0.09201    	b1  =   -0.0001209   e1  =      1.374    	c 1 =   -0.0009982 f1  =      0.2748  4.7.4  Braking up control parameters 
      The experiment whose aim was to identify the coefficients of formula (4.41) was carried out on the Blue Lady model and the results obtained are shown in Fig. 4.38. 

 
Fig. 4.38  The relation between the braking distance dbraking and vessel speed of the Blue Lady when the model brakes up by dead slow astern engine mode. 
      Basing on the result of this experiment, the coefficients of formula (4.41) are identified as below: 
 	a2 =  149.400 d2 =    54.000  	b2 = -363.600 e2 =     -1.609  	c2 =  286.800 f2 =    100.000  The parameter f2 is the time needed to change the engine mode from full ahead to dead slow astern. On the Blue Lady model, it depends on the type of the main engine, which is simulated in the experiment. For a steam turbine, it amounts to 100 s.   
4.7.5  Interface parameters and signals 
In the database file of the primary map, the type property consists of 21 digits in the form of xxcc1cc2cc3c11c22c33z. The meanings are as listed below:  
xx: type of object. 
00: shore line polygon, continuous line              
01: polygon, continuous line 
02: polygon, dashed line 
03: polygon, dotted line 
04: polygon, dot-dash line  
10: continuous line  
11: dashes line  12: dotted line  
13: dot-dash line  
20: line of many buoys connected together 
21: single small circle buoy 
22: single big circle buoy 
25: single big half circle buoy 
31: single triangle buoy 
41: single rectangle buoy 
      51: single star shaped buoy  cc1cc2cc3:  color of the object cc1: red [0..255] cc2: green [0..255] cc3: blue [0..255] 
c11c22c33:  color of the light on the object (if object has a light) c11: red [0..255] c22: green [0..255] c33: blue [0..255] 
z:  direction of the light drawn on the map (if object has a light) 
1: North East 2: South East 
3: North West 
4: South West 
      For example, an object with the type property = 312550000002550000001 will be a buoy which has the shape of a triangle on the map. This buoy is red and has one red light. Its red light is drawn on the map in the North East direction. An object with the type property = 222552552550000000001 will be a circle white buoy without a light (Fig. 4.39). 
			 
 	312550000002550000001 	222552552550000000001 
Fig. 4.39 The example of the meaning of the type property of the map objects 
      The signals, which are read from the xPC to be displayed on the Interface, are presented in Table 4.10. The readings are implemented in every sampling period through the special blocks. These blocks are named with the prefix “out_” in  the Fig. B.3.     
Table 4.10 Signals for the Interface 
Status signals Deviation signals Control signals Coordinate 
Coordinate 
Course 
Turning rate 
Speed 
Surge 
Sway x y y 
r V u v Cross deviation Dy Error course Dy 
Distance to reference  
	point R  	dx 
Distance to reference  
	point R  	dy 
 r.p.m 
Rudder angle 
Bow thruster 
Stern thruster 
 
 r.p.m d 
pb-th ps-th 4.7.6  Input signal scaling to apply the autopilot to different vessels  
The autopilot is designed to control different vessels. However, for each vessel size, the control parameters are within a different range. For example, the Blue Lady model is 2.38 m wide so the designed cross deviation range, which is set in the Trajectory regulator, is –50 m. But this value (–50 m) is too small for a tanker, which is 47.17 m wide (see section 5.4). Therefore, when applying the autopilot to the Tanker, the cross deviation had been scaled with a ratio of kcross dev.= 0.045 (Fig. B.10).  
      The situation is the same in the cases of the Container and Mariner, which are 23.17 m and 25.40 m wide respectively (see section 5.4), the ratios had been set at  kcross dev.= 0.1 (Fig. B.10). 
      Other parameters such as course error Dy and turning rate r did not need to be scaled because their value range are not so different between different vessels and they are within the range set for the Blue Lady model. 
      As the simulation models of the Tanker, Container and Mariner have no thrusters, the experiment in a maneuvering mode could not be performed. Therefore, the ratios for the scaling parameters of the maneuvering control were not defined. This kind of experiment may be conducted in further research. 

Chapter 5 Experiments and results evaluation  
5.1 Facility for the experiments  
Almost all experiments were carried out using a scaled model of Blue Lady on Silm Lake in I?awa, Poland, where the Ship Handling Research and Training Centre is located. The experiments were performed in two years (2005 and 2006). Therefore, numerous of data sets in different weather conditions were collected for the research (Fig. 5.2). 

 
Fig. 5.1 The outline of the Silm lake 
 The outline of the lake is shown in the Fig. 5.1. The longest straight running path of the lake is about 900 m long with the course of 320o (or 130o). This distance takes the scale model of Blue Lady about 11 minutes when running by using full ahead engine (speed 1.31 m/s). Compared to the length of the model (13.5 m), the running test is 70 times longer. It is enough for an experiment whose aim is to evaluate the quality of the autopilot along a straight line but too short for experiments whose task was to evaluate the integral function of the Reduce drift block. Therefore, these experiments were carried out in simulations only. 

Fig. 5.2 Tracks of the experiments on Silm lake Apart from that, a part of the lake is overshadowed by a forest while the other part is not (Fig. 5.1). In some cases, this causes the wind speed change with large value on the running path. This is the reason why one experiment result is sometimes split into parts characterized by different wind speed (see the next section for details). 
      The model is a scaled model of a tanker type Very Large Crude oil Carrier (VLCC) and its particulars are presented in Table 5.1 and its photograph - in Fig. 5.3. 
The propulsion system of the model consists of: 
- One main propeller. 
- Two thrusters at the bow and stern. 
- Two azimuth propellers at the bow and stern to simulate tugboats. 
(These azimuth propellers are not used in this research) 
      All of the propellers are driven by electric motors. They are controlled by the processors to simulate all characteristics of the propulsions of a real vessel such as the character of a diesel engine or a steam turbine, thrusters, etc. 
Table 5.1 Particular of real vessel and model scaled 1:24 
Item Vessel Model Overall length  330.65[m] 13.75[m] Beam 57.00[m] 2.38[m] Draft – full load 20.60[m] 0.86[m] Displacement – full load 315000[t] 22.83[t] Draft – ballast 12[m] 0.5[m] Displacement – ballast 176 000[t] 12.46[t] Speed 15.2[kn] 3.10[kn]  

 
Fig. 5.3 The Blue Lady scale model on Silm Lake 
      Blue Lady has all the characteristics of an unstable vessel that mimics. The result of a spiral test is shown in Fig. 5.4. In practice, steering Blue Lady along a straight path is not easy because of its unstability. The rudder effect at the deflecting angle d < 5o is abnormal and irregular. Therefore, the deflecting rudder angle should be greater than 5o to each side when steering the model.  
 

	a) Ballasting 	d [o] 	b)Full loadedd  [deg] 	d [o] 
 
Fig. 5.4 Spiral test with the half ahead engine mode 
      The navigation aid equipment installed on the model consists of a DGPS receiver with the accuracy of centimeters, a gyrocompass and a wind meter of high accuracy.  
 As it was already mentioned, many experiments with the autopilot were carried out for a long time in different whether conditions. However, no extraordinary conditions occurred during the experiment and/or some experiments could not be performed on the lake, but they were performed using a simulator. The next sections will present the details of the experiment results. 
5.2 Steering criteria  
The steering criteria of an autopilot depend on operational conditions. In general, they are evaluated on the basis of the percentage loss of speed and the accuracy of the vessel course and vessel position controlled.  
The percentage loss of speed is defined by formula [3], [10], [36]: 
t
 	 	(5.1) 
1
where  	Dy : course error  d : rudder angle  l : weight factor      The term Dy2 represents the elongation of the distance due to course errors. The term d2 stands not only for the rudder drag but for all losses caused by steering. Based on full-scale trials and model tests, Koyama suggests values of  l of about 10 [36]. In the discreet form, the components of the formula (5.1) may be: 
N
 	sCo =	2	(5.2) 
 	sd(5.3) 
      The accuracy and the stability of the vessel course and vessel position in control are evaluated using the statistical standard deviation and mean value of course error and cross deviation. Normal distribution (Gaussian distribution) is applied to statistic data obtained from the experiments. The graph displaying the distribution is of the shape of a bell (Fig. 5.5) so it is also named “bell curve”. 
 
Fig. 5.5 Normal distribution (Gaussian distribution) – Bell-shaped Curve The normal distribution function: 
 	j( )	 	(5.4) 
      is used to describe the probability distribution of a sample set. Two important coefficients of this function are m and s. They determine the graph’s shape and also indicate the character of the sample set. 
The coefficients of m and s are defined by the following formulae: 
 	m 	(5.5) 
 	 	(5.6)  	s 	(5.7) 
 	Sn =  	(5.8) 
      The value of m indicates the center, where the possible values are spread around. The value of standard deviation s indicates the dispersion of data set. If the data points are all close to the mean, then the standard deviation is close to zero. If many data points are far from the mean, then the standard deviation is far from zero. If all the data values are equal, then the standard deviation is zero. 
 The area under the curve in a defined range displays the probability of an event which occurs within this range. Some typical ranges, which are often used in statistics, are shown below with the respective probability: 
one standard deviation  (1s) 68.26894921371%  two standard deviations  (2s) 95.44997361036%  three standard deviations (3s) 99.73002039367%  four standard deviations (4s) 99.99366575163%  five standard deviations  (5s) 99.99994266969%        In fact, the range of three times standard deviation (3s) is often used as standard of assessment because within this range, the probability amounts to 99.73002039367%, which is a very high probability. This standard is called “standard 3s”. 
      The distribution graph and histogram can be drawn by functions normpdf and hist of Matlab. Fig. 5.6 shows the histograms and distribution graphs of a experiment. 

	-0.5	0	0.5	1	1.5	-4	-3	-2	-1	0	1	2	3	 
 	Cross error 	Course error  
Fig. 5.6 Histogram and distribution graph of an experiment  
5.3 Results of the experiments and their evaluations 
5.3.1 Experiments with straight path segments in trajectory mode 
      In trajectory mode, a vessel is controlled by the Trajectory segment regulator. In this subsection, nine samples of experiments are shown and analyzed. The wind data mentioned in this section are of the relative wind and already recalculated to the scale of the model. The model is scaled with 1:24 ratio with respect to a real vessel. Therefore, the scaled wind is calculated by using 
 	Vscaled = 24Vreal 	(5.9) 
      It means that the wind with the speed of 2 m/s to the model on the lake will be treated the same as the wind with the speed of 9.8 m/s to the real vessel at sea. 
      Within the conditions of the lake (mentioned in section 5.1), almost straight segment experiments were carried out with the course of 130o or 310o. The results of the experiment, in which the wind scale was lower than 7oB are shown from Fig. 5.7 to Fig. 
5.10. From Fig. 5.11 to Fig. 5.15, the result of the experiments in wind scale from 7oB and higher is shown. 
Each figure on the left side contains the record of actual data consisting of: 
course (y), course error (Dy), turning rate (r), rudder deflection (d) and wind speed. On the right side there is a graph of normal density functions (bell curves) of cross deviation (solid line) and course error (dashed line). The parameters of the bell curves (m and s) are shown in the figure’s title with other information of the data sample such as order (identification number), time and duration and wind direction of the experiment. The bar graph under the bell curves shows the ratio of rudder deflection at each set rudder angle of the Trajectory segment regulator.  
      The value of my indicates the average cross deviation of the experiment. In  Fig. 5.7 and Fig. 5.8, the values of my are very small. It means the mean track of the vessel is very close to the reference path segment. But the small value of my is not enough to say the vessel is controlled well along a reference path segment. The second important parameter to assess the stability of the vessel track is sy. If the value of sy is small, it means the vessel is close to the reference segment all the time. In that case, the graph showing the density function is very tall and narrow as in Fig. 5.7 and  Fig. 5.8. If my and sy are small, it means the autopilot is keeping the vessel on the path well. 
 The second curve (course error) indicates the quality of the vessel course control. The same as in the case of cross deviation, a tall and narrow curve (small sCo) shows the vessel course is stable. The stability of the course is influenced mostly by the wind. The superstructure of the Blue Lady model is located on the stern so the wind blows to the stern or to the sides of the model causes strong heading oscillation  (Fig. 5.10, Fig. 5.11, Fig. 5.12 and Fig. 5.13). The value of mCo indicates the mean course error. Under the effect of wind and current, the true movement direction of a vessel is not the same as the vessel heading and the difference between them is the value of mCo.     
      3s deviation characterized by the probability of 99.73% (section 5.2) can be used to assess the error of the autopilot. The value of 3s of each sample set is shown in the circle on the graph. The picture in the circle also describes briefly the conditions of the experiment such as vessel course, wind course and mean position of a vessel on a reference path segment.  
Notice that, the cross error is defined by the following formula: 
 
where 	yerr. = yreq. - y 	(5.10) yreq. : required y coordinate of the vessel in path segment frame. yerr. : actual y coordinate of the vessel in path segment frame.       The value of yreq. is always 0. Therefore, the value of yerr. in the graphs below is of the opposite sign to the value of cross deviation y, which is described by the distance from the small figure of a vessel to the reference path segment in the circle from  Fig. 5.7 to Fig. 5.15. 

 
Fig. 5.7 Experiment No. 34a from second 420th to  810th 
	Duration:   	390 s  
	Wind direction:  	-68o (flank wind) 
	Cross error:  	my  = 0.3675   	sy  = 0.2357 
	Course error: 	mCo  =-0.5283   	sCo  = 0.9553 
      When the wind is flank (Fig. 5.7), it affects the vessel course and drift substantially. In experiment No. 34a, the drift was small with three standard deviation 3sy » 0.7 m because the drift caused by wind and the drift caused by the asymmetry of the vessel propulsion and hull acted in opposite directions. In the case of a flank wind, the vessel had to change the heading frequently to adjust its track so that the value of three standard deviation 3sCo was approximately 3o (Fig. 5.7) compared to 2o in experiments No. 42 and No.44 (Fig. 5.8 and Fig. 5.9). 

 
Fig. 5.8 Experiment No. 42b from second 961th to 1205th 
	Duration:   	244 s  
	Wind direction:  	5o (head wind) 
Cross error:  my  = 0.0900,   sy  = 0.2921 Course error: mCo  = 0.3268,   sCo  = 0.6617       When the vessel is running in the wind (head wind), the wind stabilizes the vessel course. In this situation, the speed is decreasing but the course is better stabilized. In the experiment No. 42b (Fig. 5.8), the value of three standard deviation 3sy was approximately 1 m. This cross deviation was mostly caused by the asymmetry of vessel propulsion and hull. 

 
Fig. 5.9 Experiment No. 44a from second 380th to 900th 
	Duration: 	 	520 s  
	Wind direction: 	8o (head wind) 
Cross error:  my  =1.4343,   sy  =0.7631 Course error: mCo=-0.2344,   sCo=0.5509       The directions wind in experiment No. 42b and No. 44a were similar so their influence to the vessel course were the same. The values of three standard deviation 3sCo are approximately 2o in both situations. The wind speed in experiment No. 44a was stable and around 10 m/s and it caused drift to the port side. This drift had the same 

direction as the drift caused by the asymmetry of vessel hull and propulsion. As a result, the resultant drift increased quickly. See the graph in Fig. 5.9.  In this situation, the Reduce drift block was working but it did not have enough time to reduce this drift to 0 because the experiment had to be stopped as the model was too close to the shore. It is the disadvantage of the lake where the experiments took place (see  section 5.1). 

 
Fig. 5.10 Experiment No. 44b from second 1430th to 1770th 
	Duration:   	340 s  
	Wind direction:  	170o (stern wind) 
	Cross error:  	my  = 1.2071,   	sy  =1.0381 
	Course error: 	mCo=-0.3309,   	sCo=1.6351 
      In experiment No. 44b the wind was blowing to the stern of the vessel. Such wind conditions always cause unstability of the vessel course. In addition to that, the wind acted on the starboard side so it caused drift of the same direction as the drift direction caused by the asymmetry of the vessel hull and propulsion. At that moment the GPS signal was not delivered properly. It caused the significant position errors, see points A, B, C and D in Fig. 5.10. This situation was the worst one for the autopilot. As a result, the values of three standard deviation 3sCo and 3sy were approximately 5o and 3 m respectively. 

 
Fig. 5.11 Experiment No. 34b from second 975th to 1205th 
Duration:   230 s  Wind direction:  180o (stern wind) Cross error:  my  = 0.7873,   sy  = 0.6766 Course error: mCo=-0.5924,   sCo = 1.3942       In experiment No. 34b (Fig. 5.11) the relative wind direction was the same as the wind direction in experiment No.44b (Fig. 5.10) but there was no abnormal error of fixed positions from GPS. The deviations in this experiment were less than the deviation in experiment No. 44b even though the wind was stronger. 

 
Fig. 5.12 Experiment No. 32 from second 850th to 1050th 
Duration:   200 s  Wind direction:  80o (flank wind) Cross error:  my  =-0.2073,   sy  =1.2054 Course error: mCo  = 0.5645,   sCo =2.2702       Fig. 5.11, Fig. 5.13 to Fig. 5.15 shows the results and the analysis of an experiment in the wind scale higher than 7oB. In such conditions, the vessel is influenced very much by wind. The vessel had to change the course frequently to correct its position. The bell graph of course error in this case is short and wide. The graph of rudder recorded shows that the rudder was kept on one side for long time to counteract the effect of the wind (d =+5o for several dozen seconds many times in  Fig. 5.11, Fig. 5.12 and Fig. 5.13). On the Fig. 5.13, the rudder event was kept for more than 1 minute with d =+5o.  
      In these difficult conditions, the three standard deviations 3sy has maximum value at 3.6 m. Taking into consideration the model’s width (2.38 m), the control result of the autopilot is acceptable in such heavy weather condition.  

 
Fig. 5.13  Experiment No. 42a from second 440th to 850th 
Duration:   410 s  Wind direction:  28o (on starboard side) Cross error:  my  = 0.4427,   	sy  = 0.5206 Course error: mCo = 0.1358,   	sCo = 1.2884  

 
Fig. 5.14  Experiment No. 45 from second 1880th to 2410th 
	Duration:   	530 s  
	Wind direction:  	3o (head wind) 
Cross error:  my  = 1.6472,   sy  = 0.6027 Course error: mCo =-0.2013,   sCo  = 0.9656       Fig. 5.15 shows the hardest situation of the experiments: the quartering wind with speed higher than 25 m/s (10oB – Storm). The bell curves of cross error and course error are very short and wide. The errors with standard of 3s are 6 m and 9o respective to cross error and course error. Although the deviations were larger, the model movement was stable. The autopilot still kept the vessel in control. 

 
Fig. 5.15  Experiment No. 33 from second 120th to 580th 
	Duration:   	460 s  
	Wind direction: 	28o (on starboard side) 
Cross error:  my  = 2.3043,   sy  = 1.9786 Course error: mCo = 0.3470,   sCo = 3.0129 
      Table 5.2 shows the summary of nine sample sets analyzed on the basis of the experiments in different wind conditions. According to the summary presented in the table, in normal wind conditions (< 7oB) the cross error (according to standard 3s) is always less than the beam of the Blue Lady model (2.38 m). The course error is also always less than 5o (standard 3s). These values are acceptable in normal navigating conditions.  

      The experiments in wind conditions of the scale from 7oB to 9oB also provided good result. The maximum cross error is 3.6162 m (3sy) and course error is 6.8106o (3sCo). These results are quite acceptable in practical navigation. 
Table 5.2 Summary of results analysis on straight segment (Control by Trajectory segment regulator) 
Experiment  No. Time of collecting sample(s) Wind  Cross error (m) Course error (o) From To Duration Direc- tion(o)Scale 
 (oB) my sy 3sy mCo sCo 3sCo No.34a 420 810 390 -68 6 0.3675 0.2357 0.7071 -0.5283 0.9553 2.8659 No.42b 961 1205 244 5 5 0.9000 0.2921 0.8763 0.3268 0.6617 1.9851 No.44a 380 900 520 8 5 1.4343 0.7631 2.2893 -0.2344 0.5509 1.6527 No.44b 1430 1770 340 170 4 1.2071 1.0381 3.1143(*) -0.3309 1.6351 4.9053 No.34b 975 1206 230 180 7 0.7873 0.6766 2.0298 -0.5924 1.3942 4.1826 No.32 850 1050 200 80 7 -0.2073 1.2054 3.6162 0.5645 2.2702 6.8106 No.42a 440 850 410 28 9 0.4427 0.5206 1.5618 0.1358 1.2884 3.8652 No.45 1880 2410 530 3 8 1.6472 0.6027 1.8081 -0.2013 0.9656 2.8968 No.33 120 580 460 28 10 2.3043 1.9786 5.9358 0.3470 3.0129 9.0387 (*)
 The deviation includes uncertain error of GPS receiver (Fig. 5.10) 
      There is very few chance of carrying out experiments in very strong wind. Experimenting throughout different months, there was one instance when a strong wind of 10oB occurred. With one sample set, it is not enough to assess the autopilot performance in such conditions. In practical navigation, in the storm (wind scale higher than 10oB) it is very difficult to control the vessel but in this experiment, the autopilot controlled the vessel in a stable way with accepted deviations (Fig. 5.15).  
5.3.2 Changing the path segment in trajectory mode experiment 
The assessment the quality of the autopilot when changing path segments requires many experiments with different speeds and changing course angles. Due to a large number of experiments which would take a lot of time carried out on the lake, all of these experiments were carried out using computer simulation. Then the results obtained from the computer simulation were compared to selected fragments of complex path experiments (see 5.3.6) on the lake to be verified.  
Table 5.3 Set path information  
Waypoints X [m] Y [m] Course [o] Changing 
course angle [o] A 0 0   B 0 100 AfiB:  90  C 117 300 BfiC:  60 AfiBfiC:  30 D 260 250 BfiD:  30 AfiBfiD:  60 E 260 150 BfiE:   0 AfiBfiE:  90 F 140 -40 BfiF: 315 AfiBfiF: 135       In this subsection, the results of twelve experiments performed by computer simulation are shown from Fig. 5.16 to Fig. 5.21. The fragment of the experiment which carried out with the real model on the lake is shown in Fig. 5.22 and Fig. 5.23. 
       Table 5.3 shows information about set paths which were applied in these experiments. At the beginning, the model ran on the segment AB at the course of 90o then it changed to segment BC or BD or BE or BF with changing course angles of 30o or 60o or 90o or 135o. The model ran three times on each set path with speeds corresponding to three engine modes: full ahead, half ahead and dead slow ahead. 

o 
Fig. 5.16 Changing path segment: full ahead engine mode and course change of 30 , 
60o, 90o and 135o, experiment by computer simulation 


	c) course changing of 90o 	 	 	d) course changing of 135o 
 
Fig. 5.17 Recorded data when changing path segment with full ahead engine mode and course change of 30o, 60o, 90o and 135o, experiment by computer simulation 
 
		 
Fig. 5.18 Changing path segment: half ahead engine mode and course change of 30o, 60o, 90o and 135o, experiment by computer simulation 

	a) course changing of 30o 	 	 	b) course changing of 60o 

	c) course changing of 90o 	 	 	d) course changing of 135o 
 
Fig. 5.19 Recorded data when changing segment with half ahead engine mode and course change of 30o, 60o, 90o and 135o, experiment by computer simulation 

 
Fig. 5.20 Changing path segment: dead slow ahead engine mode and course change of 30o, 60o, 90o and 135o, experiment by computer simulation 


	c) course changing of 90o 	 	 	d) course changing of 135o 
 
Fig. 5.21 Recorded data when changing segment with dead slow ahead engine mode and course change of 30o, 60o, 90o and 135o, experiment by computer simulation 
 

East [m]
 
Fig. 5.22 Experiment No. 53 from second 440th to 768th. Positions marked every 60s.  

 
Fig. 5.23 Recorded data of experiment No. 53 from second 440th to 768th.   
      The Trajectory segment regulator controls the turning rate of a vessel on three levels: 0.1o/s, 0.3o/s and 1.8o/s respectively to the error course levels (subsection 4.3.2). The Fig. 5.17, Fig. 5.19 and Fig. 5.21 show that the turning rate was controlled well around the levels mentioned above: 0.1o/s when the vessel is running steadily along the path segment; 0.3o when the vessel’s course error is medium and 1.8o/s when the course error is big.  
      In Fig. 5.22, the fragment of experiment No. 53 with the real model on the lake is shown. The vessel was running with full ahead engine and changed the path segment with the course change of 86o. That situation was similar to the experiment on the simulator (Fig. 5.17c). Comparing Fig. 5.17c to Fig. 5.23 some different maneuvering characteristics between the simulator and the real model can be noticed. On the simulator, when the rudder deflects to the maximum value to one side, the turning rate reaches the value of 1.9o/s while this value amounts to 2.8o/s in the case of the real model on the lake. For this reason, the model changes the path segment on the lake faster than on the simulator. The duration, since the model started changing path segment to the moment when it became stable on the new path segment, was 190 s on the simulator (Fig. 5.17c), whereas it was 165s on the real model experiment  (Fig. 5.23). Such a difference is not substantial.   
      The experiments were carried out with the wide range of speeds (engine mode change from dead slow ahead to full ahead), but the results of the experiments are almost the same (see Fig. 5.16, Fig. 5.18 and Fig. 5.20). This is the advantage of the method applied for the regulators in the autopilot (subsection 4.1.1).  
5.3.3 Reducing drift block effect experiment 
The drift of a vessel is caused by two sources: 1) drift caused by the asymmetry of propulsion and hull; 2) drift caused by disturbance. All experiments in subsection 5.3.2, except the experiment No. 53, were carried out in no wind condition and the Reducing drift block switched off. Therefore, the drift in these results is caused solely by the asymmetry of propulsion and hull. It has a stable value of around -1m.   
Table 5.4 The set path for the Reducing drift block effect experiment  
 Waypoints X [m] Y [m] 1 A 0 0 2 B 0 1000 3 C 1000 1000 4 D 1000 0 5 A 0 0       To assess the effect of the Reducing drift block, the following experiment was carried out. In the experiment, the autopilot controlled the vessel to follow the set path ABCDA (see Fig. 5.24 and Table 5.4). The model ran with the engine mode full ahead under the wind 25m/s from North.  

 
Fig. 5.24 Experiment showing the effect of the Reducing drift block; Conditions: wind from North with speed of 25 m/s, engine full ahead, experiment by computer simulation. 
The experiments were carried out in two scripts:  
• For the first script, the Reducing drift block was off. In North wind, model was influenced most strongly in the segments AB and CD because of the beam wind. In segment AB, the drifts caused by the asymmetry and by wind had the same direction so the resultant drift was the largest.It was about -2m. Whereas, in segment CD these drifts were opposite so the resultant drift was the smallest. In segments BC and DA, the wind was blowing along the model so it just had an effect on the surge of the vessel and in these cases the drift was mostly caused by the asymmetry of vessel. The results are shown in Fig. 5.25a.  
• For the second script, the Reducing drift block was on. The drifts in all path segments were reduced to 0 (Fig. 5.25b). 

  a) Reducing drift block off                      b) Reducing drift block on 
 
Fig. 5.25 Recorded data of the experiment  
      Fig. 5.26 shows the courses of the vessel in each segment. To against the wind force, the leading course was set to 88o, 359o5, 271o and 179o5 instead of 90o, 0o, 270o and 180o in segments AB, BC, CD and DA. It was adjusted automatically to the weather conditions. 

           a) Reducing drift block off 	 	b) Reducing drift block on 	 Fig. 5.26  Recorded courses of the model in segment AB, BC, CD and DA 
      Fig. 5.27 shows the variation of components related to leading course on the segment AB. According to formula (4.22), the leading course is calculated as follows: 
	Dy yc + D	d - Dy
 	yleading =yk +	 	(5.11) 
2

	  a) Reducing drift block off  	           b) Reducing drift block on 
 
Fig. 5.27  The adaptation of leading course under disturbance effect 
      When the Reducing drift block was off (Dyd=0), the variation of the leading course depended only on Dyc. Under the disturbances, the vessel driftted -2 m from the path segment. The Cross dev. reducing block provided Dyc = -4.5o (formula (4.18)). The vessel was running steadily with Dy = -0.5o (see Fig. 5.27a). Let apply these values into formula (5.11), the value of the leading course is as follows: 
	Dy yc + D	d - Dy
yleading =yk + 
2
 	 	(5.12) 
= 88?
      In Fig. 5.27a, the vessel course was kept at 88o and the vessel was running steadily along the track, which was parallel to the set path. The autopilot already assigned the leading course, which can act against the effect of disturbances but the drift has to exist to maintain the value of Dyc. 
      When the Reducing drift block was on, both of Cross dev. reducing block and Drift reducing block were working. The Cross dev. reducing block responded to the leading course faster than the Reducing drift block (see 4.3). Therefore, at the beginning the leading course value depened mostly on the value of Dyc. Then with the time, the value of Dyc was replaced by Dyd gradually (see Fig. 5.27b from second 0th to 300th). Thereby, vessel ran steadily at the leading course yleading=88o (the proper course for that disturbance) without any drift (see Fig. 5.27b). 
      In this experiment, the model was tested in the windy conditions. The wind had the speed of 25m/s (10oB) and the direction: ahead, beam and astern. By using the Reducing drift block, the drift was reduced to less than 0.5m. 
5.3.4 Maneuvering paths experiments 
In the maneuvering mode, a vessel is controlled by the Positioning regulator. For the assessment the quality of the autopilot in maneuvering mode, two experiments were performed. In these experiment, the autopilot controlled the model with the specified movements: 1) oblique movement (longitudinal and transverse at the same time) and 2) longitudinal/transverse movements. 
      In this control mode, the criterion of speed loss is not taken into consideration. The most important criterion in the maneuvering mode is the position and heading accuracies. This criterion is assessed by two quantities: mean (m) and standard deviation (s) in statistics of the cross deviation and course error of the experiments results.  
      Experiment No. 20 was carried out to evaluate the oblique movement. In this experiment, the model was controlled to move in aft-port (AB), in fore-port (BC), in fore-starboard (CD) and in aft-starboard (DA) directions (Fig. 5.28). 

 
Fig. 5.28 Experiment No. 20 from second 760th to 2560th 
       There is a big difference between the characteristic of the main engine and thruster of the vessel. The main engine is powerful but it responds very slowly while changing its mode. The main engine simulated on Blue Lady is turbine type. It takes several dozen seconds (in model scaled) to change from the ahead engine mode to the astern engine mode. On the contrary, thrusters are very weak but respond very quickly. Therefore, it is not easy to combine main engine and thrusters actions in the oblique movement. 
A        B         C                          D         A 

Fig. 5.29 Experiment No. 20 from second 760th to 2560th 
Duration:   1800 s  Wind direction: -24o (quartering wind) Cross error:  my  = 0.2157,   	sy  = 0.4445 Course error: mCo = 0.4544,   	sCo = 2.0062       During the experiment, the wind force changed from “Moderate breeze” to “Strong gale” according the Beaufort scale (Appendix E.2). But the result of control is the mean of cross deviation my= 0.2157 and the standard deviation sy=0.4445; the heading of the model was kept steadily with mCo = 0.4544 and sCo = 2.0062, see  Fig. 5.29. Compared with the dimension of the model, these values are acceptable in practical navigation.  
      The second experiment was carried out to evaluate the control in a single transverse or longitudinal motion and the turning model at a waypoint. The model Blue Lady left from the quay (Point A), performed side movement in segment AB. Then, it moved forward in segment BC. At point C, it turned 90o and then ran astern in segment CD. In the last segment DE, the model moved transversely and contacted to the target quay (Fig. 5.30).  
      In this experiment, the model was moving in the port area under the shadow of many metal constructions so the positions fixed by GPS are sometimes not stable. One may see many positions jumping around point C. The vessel speed (surge and sway) is calculated by using the change in vessel position. As a result, if the fixed position had a big error, the calculated speed also got abnormal values (see Fig. 5.31 from second 900th to 1200th).  These errors had significant influence on the quality of control.  

71 120 71 125 71 130 71 135 71 140 71 145 71 150 71 155 71 160 71 165 71 170 71 175 71 180 71 185 71 190 East [m]
    
Fig. 5.30 The view of experiment No. 21 from second 50th to 2030th 
      The wind force during the experiment is 7-8oB. For maneuvering activities it is a strong wind. On path segments AB and BC, the wind was blowing along the model’s hull so its effect on the model was less than on path segments CD and DE, on which the wind was blowing straight on the model’s side. 
      At point C, the model performed a 90o turn. The turn was carried out in 270s (from second 700th to second 970th) with the heading error of about 2o and small oscillation (Fig. 5.31). 
      After the turn, the model was affected by a cross wind on the starboard side. A cross wind with the scale of 7-8oB is too strong for the thrusters of a vessel. The stern thruster was working with almost maximum power (Fig. 5.31) to against the cross wind but the cross deviation still remained along path segment CD (Fig. 5.30). The bow thruster could not work with maximum power because if it pushes with more power, the vessel course would change. The Signals saturation block is programmed in which the task of keeping the heading has a higher priority than keeping position  (section 4.4). In such a situation, the cross deviation was accepted to maintain the heading at set value.  
      The mean and standard deviation of cross deviation and heading error are shown in the Fig. 5.31. When the model was turning 90o at point C for 270s, statistical heading error deviation could not be taken into account in this duration. Therefore, the evaluation of this experiment is split into two parts: from second 50th to 700th and from second 970th to 1850th (See Fig. 5.31). 
	A B 	C 	D E 

  
Fig. 5.31 Experiment No. 21 from second 50th to 1850th 
Duration:   1800 s  Wind direction: -24o (quartering wind) Cross error:  my  =-0.4883,  sy  = 0.7842 (from second 50th to 700th)  	 	 my  =-1.0765,  sy  = 0.4943 (from second 970th to 1850th)  Course error: mCo = 0.0184,  sCo = 1.9078 (from second 50th to 700th)  	 	 mCo =-0.2346,  sCo = 1.0818 (from second 970th to 1850th)       According to the above experiment results, the autopilot’s quality in the maneuvering mode is acceptable in practical navigation.    
5.3.5  Braking up vessel experiment 
      The experiments on braking up a vessel were performed using computer simulation as well as the model in real environment. In computer simulation, a vessel was tested braking up from four different speeds with respect to four engine modes: full ahead, half ahead, slow ahead and dead slow ahead (Table 5.5).  
      In the experiment, the vessel was running from waypoint A(75768, 71540) to waypoint B(75314, 71540) on the course of 180o (Table 5.5). The autopilot’s task was to stop the vessel at waypoint B. While stopping vessel, the heading had to be kept at 180o and the vessel track had to be kept close to the path segment AB. 
      While the vessel was running steadily along path segment AB, the Processing block calculated braking distance dbraking basing on the actual vessel speed using formula (4.41). Depending on the instant speed, this distance dbraking was 192 m, 152 m,  100 m and 49 m with respect to the speed of 1.25 m/s, 1.00 m/s, 0.74 m/s and  0.47 m/s (Fig. 5.32).  
 
Table 5.5 Set path of braking up experiments 
Experiment No. Waypoint A Waypoint B Speed[m/s]/engine mode X[m] Y[m] X[m] Y[m] No. 70 75768 71540 75314 71540 1.31/full ahead No. 71 75768 71540 75314 71540 1.00/half ahead No. 72 75768 71540 75314 71540 0.70/slow ahead No. 73 75768 71540 75314 71540 0.50/d.slow ahead       When the distance from the vessel to waypoint B was less than dbraking, the autopilot changed the control mode from the trajectory mode to the transitional mode. From this moment t1 in Fig. 5.32, the main engine was controlled by the Processing block to adjust braking force; two thrusters were controlled by the Positioning regulator to maintain vessel course; the rudder was controlled by the Trajectory segment regulator until the vessel speed was less than 0.1 m/s.  

	a) Experiment No.70 	b) Experiment No.71 	c) Experiment No.72 	d) Experiment No.73 
 
Fig. 5.32 Track of the vessel in the braking up experiment using computer simulation. Position marked every 60 s; u – surge of vessel at the start of the transitional mode. 
      When the vessel speed reached the maneuvering speed range or the vessel was in maneuvering area around waypoint B (mentioned in Fig. 4.29c), the autopilot changed the control mode to the maneuvering mode (t2). In experiments No. 70, No. 71 and No.72 the vessel speed reached maneuvering speed at about 10m before the target waypoint B (position of t2 in Fig. 5.32). From this moment t2, the vessel was controlled using the maneuvering mode and it took about five minutes to move to the waypoint B. In the experiment No. 73, the vessel approached the maneuvering area of waypoint 
B but the speed was higher than the maneuvering speed. In this situation, the autopilot changed also the control mode to the maneuvering mode. After that, the Positioning regulator immediately set the main engine to full astern mode to stop the vessel quickly (see Fig. 5.33d).  
      The Fig. 5.33 shows the recorded parameters of the four experiments. The vessel was stopped at the waypoint B with position deviation less than 0.5 m and the heading drift in these slowdown maneuvers was less than 2o. 


 
Fig. 5.33 Recorded data of the braking up experiment using computer simulation.  dto WP – the distance from the vessel to the target waypoint. 
      The next experiment was performed with the Blue Lady model on the lake. In this experiment, the vessel was running from waypoint A(75273, 71480) to waypoint B(74952, 71754) with the engine mode slow ahead (r.p.m = 240 ~ V = 0.6 m/s). The task of the autopilot was to reduce the vessel speed to the maneuvering speed at waypoint B. At waypoint B, the vessel was turned to the heading of 150o and then moved to waypoint C(74978,  71780). 
       At the speed of 0.6 m/s, the braking distance was 72 m. When the distance from the vessel to waypoint B was less than 72 m, the autopilot changed the control mode to the transitional mode. The Processing block controlled the braking force by the main engine r.p.m., while the Positioning regulator and Trajectory segment regulator controlled the heading by the two thrusters and the rudder.   
Table 5.6 Set path of experiment No. 52 
Waypoints X [m] Y [m] Set speed [m/s] Set heading 
[o] Control mode A 75273 71480    B 74952 71754 AfiB: 0.6 A fi B : 130  at  B  : 150 Trajectory& 
Transitional C 74978 71780 BfiC: not set B fi C : 150 Maneuvering       At the moment t2, when the model was within the maneuvering range of the waypoint B, the autopilot changed the control mode to the maneuvering mode. From t3 to t4 the vessel turned to the heading of 150o as required in the set path. 
      From t4 to the end of the experiment, the vessel moved translationally to waypoint C with the heading of 150o. 

 
Fig. 5.34 Experiment No. 52 from second 1000th to 1825th. The positions are marked every 60 s.  
      The recorded data is shown in Fig. 5.35. Compared to the results obtained using computer simulation, the thrusters were working harder. The reason of this is that the simulator did not simulate well the effect of a chaotic water flow. In the experiment on the lake, the chaotic water flow had a very strong effect on the model. In many experiments, the thrusters were not powerful enough to manage the model while braking up it by full astern or half astern engine. That is why the autopilot brakes up a vessel only by dead slow astern engine. 
 

 
Fig. 5.35 Recorded data of experiment No. 52 from second 1000th to 1825th.  
      Summing up, the control results of the autopilot in all experiments satisfied the criteria of braking up task mentioned in Chapter 4. In simulation experiments, the model was stopped completely with the position deviation less than 0.5 m around the set waypoint. In the experiment on the lake in windy conditions, the final position deviation was about 2 m. Compared to the length of the model (13.75 m), the deviations are acceptable in practical maneuvering. The heading deviations of the model in this maneuver were less than 5o in all experiments.   
5.3.6 Complex set paths experiments 
Two experiments are going to be presented in this section: The experiment No. 60 which has a long set path covering all the water area of the lake and the experiment No. 39 which has a short set path in the confined water area of I?awa port. The purpose of these experiments was to test autopilot performance in full-mission trials. The set paths were defined in the assumption that the system should be tested on the open as well as on the restricted areas using all control modes in comparable environmental disturbances in one voyage. Additionally, because the restricted areas set path (No. 39) was chosen close to the I?awa harbor, this experiment was documented also by the video recording. 
      The trajectory of experiment No. 60 is shown in Table 5.7. The wind ranged from 5oB to 7oB in SE direction. In this experiment, the vessel speed on the trajectory was controlled by the Speed controller of the autopilot (Fig. 4.5). To reduce the influence of the speed change on course control, the waypoints at which a change in speed would occur were set on a straight path segment (see waypoints H, K, M and P in Fig. 5.36).    
Table 5.7 Set path of experiment No. 60 
Waypoints X [m] Y [m] Set speed 
[m/s] Set heading 
[o] Controlling mode A 75432 71163    B 75433 71161 AfiB: not set A fi B : 220    at  B : 220 Maneuvering C 75395 71128 B fi C : 0.70 B fi C : 220 Trajectory D 75329 71139 C fi D : 0.70 C fi D : 170 Trajectory E 75290 71172 D fi E : 0.70 D fi E : 140 Trajectory F 75152 71291 E fi F : 1.00 E fi F : 140 Trajectory G 75273 71399 F fi G : 1.00 F fi G : 042 Trajectory H 75211 71472 G fi H : 1.00 G fi H : 130 Trajectory I 74747 72016 H fi I : 1.31 H fi I :  130 Trajectory J 74681 71943 I fi J : 1.31 I fi J :  228 Trajectory K 74806 71853 J fi K : 1.31 J fi K :  324 Trajectory L 75238 71550 K fi L : 1.00 K fi L :  324 Trajectory M 75366 71531 L fi M : 1.00 L fi M :  351 Trajectory N 75690 71485 M fi N : 0.70 M fi N :  351 Trajectory O 75590 71679 N fi O : 0.70 N fi O :  117 Trajectory P 75243 71384 O fi P : 0.70 O fi P :  220 Trajectory Q 75137 71288 P fi Q : 0.50 P fi Q :  222 Trajectory R 75244 71199 Q fi R : 0.50 Q fi R :  320 Trajectory S 75390 71178 R fi S : 0.50 R fi S :  351  at S : 310 Trajectory& Transitional T 75401 71178 SfiT: not set S fi T : 310 Maneuvering       The vessel track in this experiment is shown in Fig. 5.36. The vessel left the port (point A) using the maneuvering mode. At waypoint B, the autopilot changed from the maneuvering mode to the trajectory mode. At this moment, the vessel had no speed and the thrusters were not working (in the trajectory mode) but the wind was blowing straight to the port side of vessel. As a result, the drift was of 2 m in segment BC. Compared to the width of the model it is a large value. 
      The segments BC, CD, DE and EF were short (compared to the model length) and the course changes were large so the autopilot had no time to control the vessel’s position. For this reason, cross deviation y in these path segments was bigger than cross deviation in other path segments. In these path segments, the cross deviation was about 2 m, while in others this value was less than 1 m (Fig. 5.37).  
 
 

 
Fig. 5.36 Experiment No. 60. Positions marked every 60s.  
      The losing speed occurrence while changing the path segment at a waypoint is shown in Fig. 5.37. At waypoint I, J, N the course was changed at large values so the vessel speed at these places decreased very quickly then it increased when the change of the course was completed. The increasing the r.p.m. when the vessel was changing path segment was not carried out because it may cause the influence on the course control of the autopilot. In fact, the vessel speed was restored in about 2 minutes after the course change was completed. 
 A B   C D E   F G  H             I J   K            L   M          N        O                  P    Q         R            S         T 

 
Fig. 5.37 Recorded data of experiment No. 60 
      The experiment No. 39 was carried out in the restricted water area of I?awa port (see section E.1). In the area, there are a lot of signal buoys and many obstacles so controlling a model requires very high accuracy. 
Table 5.8 Set path of experiment No. 39 
Waypoints X [m] Y [m] Engine  mode Set heading 
[o] Controlling mode A 75401 71182    B 75396 71177 AfiB: not set A fi B : 130    at  B : 170 Maneuvering C 75306 71185 BfiC: slow ah. B fi C : 170 Trajectory D 75308 71143 CfiD: slow ah. C fi D : 264 Trajectory E 75394 71126 DfiE: slow ah. D fi E : 349 Trajectory F 75424 71152 EfiF: slow ah. E fi F :  49    at  F : 223 Trajectory& Transitional  G 75433 71165 FfiG: not set F fi G : 223 Maneuvering       The set path of experiment No. 39 is shown in Table 5.8. From beginning to t1 , the model was controlled side movement in segment AB with set heading of 130o   (leaving the port). At the waypoint B from t1 to t2 the model turned its heading to 170o and then started running in segment BC (running at sea). At t3, the model was controlled along the segment CD and very soon afterwards along the segments DE, EF at t4 and t5. In the segments BC, CD, DE, the model was controlled only in the trajectory mode, but in the segment EF it was controlled using all of three modes. Firstly, from t5 to t6 the model was controlled in the trajectory mode. Then, from t6 to t7 the model was controlled in the transitional mode to reduce the speed from the trajectory speed to the maneuvering speed. Segment EF was too short so the autopilot had to start braking up even though its course and track were not stable. The braking force in this situation was also stronger than in a normal case mentioned in section 4.5.3. The engine mode was set full astern instead of dead slow astern. From t7 to t8 the model was controlled in the maneuvering mode to approach the waypoint F. At the waypoint F, the model turned its heading from 49o to 223o. The heading was changed at a large angle so both thrusters were working at full power to create the maximum moment. When heading was stabilized at 223o (t9), the model was controlled in the maneuvering mode in segment FG and finished at t10 when the model was located properly at waypoint G (ready for mooring). 

Fig. 5.38 Experiment No. 39. Positions marked every 60s. 
      This was a complex path so the level of accuracy in each segment was different. In the maneuvering segments AB and FG, the position deviation was less than –2 m, and heading deviation was less than –3o. In the trajectory segment BC, the model started after being stabilized at waypoint C. Therefore, the model was running very close to the trajectory segment. In this segment, the cross deviation was about 0.5 m and course error was less than –1o. The changes of course at the waypoints C and D were large (approximately 90o), while the length of these path segments was very short (comparing to the model’s length). Hence, on these path segments the autopilot had no time to stabilize the course and position. Trajectory segment EF was 40 m long. It was shorter than braking distance dbraking=72 m for the speed of 0.6 m/s. Therefore, the autopilot started the braking up mode at t6 as the model was changing its path segment from DE to EF. These was abnormal conditions for the transitional mode. The model changed its course braking up the speed so the resistance was stronger than the value that was taken into account while designing the autopilot. As a result, the model was stopped before waypoint F at the distance of 20 m. At the moment t7, the model completed changing segment with the deviation course of 5o. In the maneuvering mode from t7 to t10, the deviation course and position were always less than -1.5o and –1 m respectively. 

	t0                        t1       t2       t3 t4      t5   t6     t7                  time [s] 	t8                       t9       t10    
Fig. 5.39 Recorded data of experiment No. 39 
     To sum up, all control modes of the autopilot were tested in the above mentioned experiments. The result of the experiments is evident that the autopilot can control the model during a complete “quay-to-quay” voyage. While controlling in different conditions, the deviations, in comparison to the dimensions of the model, are always within the accepted range for practical navigation. 
5.4 Applying the autopilot to other models 
To assess its ability to control different vessels, the autopilot was tested on three vessel models using computer simulation. These vessel models are of different types and sizes. They are described on in the website of the Marine Systems Simulator (MSS) of the Norwegian University of Science and Technology; the editor in charge is Professor Thor I. Fossen. The information concerning the vessels is presented in the next paragraphs. 
      Mariner: It was performed both using planar motion mechanism (PMM) test and full-scale steering and maneuvering predictions for a Marine Class Vessel by the hydro and aerodynamics laboratory in Lyngby, Denmark. The main data and dimensions of the Mariner Class Vessel are [14]:  - Mariner class vessel 
- 	Length:  	Loa  =  171.80 m  - 	Maximum beam:  	B 	= 23.17 m - 	Design draft:  	T 	= 8.23 m - 	Design displacement:  	 	= 18541 m3 - Speed  	u 	= 
- Type: nonlinear maneuvering model 15 knots       Container: It is a mathematical model for a single-screw high-speed container vessel in surge, sway, roll and yaw, which was presented by Son and Nomoto [65], [66]. 
The container ship is described by the following set of data: 
- Container ship 
- 	Length  L  =  175.00 m - 	Breadth B =  25.40 m - 	Fore draft  dF =  8.00 m       Aft dA =  9.00 m       Mean d = 8.50 m - 	Displacement  = 21222 m3 - 	Speed  u = 23 knots - Type: nonlinear maneuvering model 
      Tanker: It is a mathematical model describing the maneuverability of large tankers in deep and confined waters founded by Van Berlekom and Goddard [73]. The parameters of the ESSO 190000 dwt tanker model are listed below: - 	Large tanker 
- 	Length  	Lpp  =  304.80 m - 	Beam 	B 	= 47.17 m - 	Draft 	d 	= 18.46 m - 	Displacement 	 	= 220000 m3 - Speed  	u 	= 
- Type: nonlinear maneuvering model 16 knots       In the experiments, all parameters of the autopilot were kept the same as the parameters for Blue Lady model except the cross deviation y – one of the input signals of the Trajectory segment regulator. The ratio of this input scaling is presented in section 4.7.6.  
      In the experiments, the vessels were controlled in a trajectory mode with a set path the same as the set path for the Blue Lady model in similar experiments (see subsection 5.3.2). In these experiments, the autopilot abilities in track keeping, course keeping and changing path segment can be evaluated. 
       The results of the experiments are shown in the Fig. 5.40 to Fig. 5.45. In all experiments, the vessels were 1) stabilized course with error course Dy < 1o; 2) kept the track steadily with cross deviation y < 2m (less than 10% of the vessel breadth);  and 3) completed the change of the path segments with little oscillation in different changing courses.  


	East [m]	 
Fig. 5.40 Experiments on the Mariner model: full ahead engine, course change of 30o, 60o, 90o and 135o;  computer simulation experiment 

0	200	400	600	800	1000	1200	0	200	400	600	800	1000	1200 time [s]	time [m]
 
	a) course change of 30o  	 	 	b) course change of 60o 

0	200	400	600	800	1000	1200	0	200	400	600	800	1000	1200 time [s]	time [s]
 
	c) course change of 90o 	 	 	d) course change of 135o 
Fig. 5.41 Recording data of the experiment on the Mariner model: full ahead engine, course change of 30o, 60o, 90o and 135o; computer simulation experiment 

 
Fig. 5.42 Experiments on the Container model: full ahead engine, course change of 30o, 
60o, 90o and 135o; experiment on computer simulation 

 
	a) course change of 30o  	 	 	b) course change of 60o 

 
	c) course change of 90o 	 	 	d) course change of 135o 
 
Fig. 5.43 Recording data of the experiment on the Container model: full ahead engine, course change of 30o, 60o, 90o and 135o; computer simulation experiment 
	East [m]	 
Fig. 5.44 Experiments on the Tanker model: full ahead engine, course change of 30o, 60o, 90o and 135o; computer simulation experiment 

	0	200	400	600	800	1000	1200	1400	1600	1800	2000	0	200	400	600	800	1000	1200	1400	1600	1800	2000
time [s]time [s]
 a) course change of 30o    b) course change of 60o 
0	200	400	600	800	1000	1200	1400	1600	1800	2000	0	200	400	600	800	1000	1200	1400	1600	1800	2000 time [s]	time [s]
 
	c) course change of 90o 	 	 	d) course change of 135o 
 
Fig. 5.45 Recording data of the experiment on the Tanker model: full ahead engine, course change of 30o, 60o, 90o and 135o; computer simulation experiment 

Conclusions 
6.1 Assessment 
The work has shown that it is possible to build the autopilot for marine vessel base on the fuzzy logic techniques which is able to control a vessel during the complete  “quay-to-quay” voyage. 
 The effects of the computer simulations as well as the real world experiment with the scale model of a tanker demonstrated that the proposed system controlled the vessel motions with the quality sufficient for modern marine applications. The detailed assessment of the autopilot properties are given below.  
      The autopilot was tested in different conditions and the assessment of the experiments’ results is as follows: • The autopilot can control a vessel on a complete voyage “quay-to-quay set path”: Experiments were performed using a scale model of Blue Lady on the Silm Lake and by computer simulations under different conditions of speed (from 0 to maximum speed) and environmental disturbance (wind scale from 3 to 10oB). All the results of the experiments on the scale model on the lake and computer simulations showed that the autopilot’s control quality is better than a human. See section 5.3 for the assessment of basic and complex movement control. 
   • The autopilot can be applied to the different kinds of vessel: the autopilot was tested on 4 different kinds of vessels: a VLCC tanker (Lpp = 305 m), a container  (Lpp = 175 m), a general cargo vessel (Lpp = 160 m) and a scaled model 1:24 of a VLCC-Blue Lady (Lpp = 13.78 m). None of the parameters of the autopilot were changed (see Fig. B.9), except one parameter (kcross dev. in Fig. B.10) that sets the ratio of cross deviation to the size of a vessel. The results of the experiments show that the autopilot controlled these vessels well (see section 5.4). 
   • The autopilot can control a vessel in different speeds in trajectory mode (control by only rudder): the autopilot can control the Blue Lady at the speed range from  0.6 m/s (dead slow ahead engine mode) to 1.31 m/s (full ahead engine mode). The results are presented in section 5.3.2.  
   • The autopilot can be operated under heavy disturbances: the autopilot was tested in very heavy conditions with the wind force up to 10oB in real environment and by computer simulation. The results obtained on the lake were worse than the results of the computer simulation but all results are acceptable in practical navigation.   • The graphical interface is convenient for users: The autopilot has a graphical interface with many useful functions. The user can create and edit the set path on the screen with a computer mouse. A vessel may be controlled with a complete set path or controlled manually/directly by click or dragging mouse on the interface (section 4.6 and Appendix A). 
The interface displays the vessel together with its track on the electronic map. 
The parameters of the vessel and the control signals are displayed in digits on the panel and as figures in separate windows. This is not only useful for mariners but also for researchers operating the autopilot (section 4.6 and Appendix A). 
      The interface supports not only its own data map file but also supports the maps in all kinds of standard image files so it can operate by using the map file from many sources.  
      The user can correct the primary map by using the editing map functions included in the interface. To help users compare and correct the maps, the interface has a function which allows displaying dual maps on the screen. 
     The open structure of the autopilot allows easy development of the functionality with minimal changes: The autopilot’s structure is organized clearly with separate blocks so that upgrading it is not difficult.   
6.2 Further research 
The proposed autopilot has satisfied the thesis’s goals. However, there are some problems which should be solved to improve the quality and application range of the autopilot. These problems are: 
   • Braking up a vessel: While experimenting on the lake, the highest engine mode for braking up a vessel was dead slow astern. If a stronger engine is used, chaotic water flow acts too fiercely on the vessel’s hull, so the thrusters are not powerful enough to stabilize the vessel course and track. Hence, the stopping distance of a vessel is long and the autopilot may not be able to control the vessel in case of an emergency stop. • Vessel speed in the maneuvering mode: There are big differences in powers of the main propeller and thrusters, resistance forces in longitudinal and transverse axis. Hence, there are big differences in vessel surge and sway values. The maximum surge of the Blue Lady model is 1.31 m/s, while its maximum sway is about 0.08 m/s. At present, the main engine power is limited to balancing the power of thrusters. This causes the vessel speed to be the same in every direction with the maximum speed of 0.08m/s. It would be better if the limit of the main engine’s power was changed by the direction of the movement. Therefore, the vessel would achieve higher speed in oblique and longitudinal directions in maneuvering mode. 
   • Practical application: To control a vessel in the maneuvering mode the autopilot uses the bow and the stern thruster. In practice, very few vessels have both thrusters: at the bow and the stern. Therefore, this autopilot may not be applicable in the case of such vessels. Hence, other maneuvering methods should be applied to improve the functions of the autopilot, for example using the effect of the rudder and the propeller while accelerating the vessel or maneuvering with one thruster at the bow. 
 
 
 
Appendix A The Interface 
A.1 Introduction 
The Interface is a program working in the Host PC (see Fig. 4.36). Through the Interface, the user can control the autopilot, observe the parameters of the vessel and control process. There are three working windows: the main window, the Display motion window and the Wind indicator window (Fig. A.1). Their details are shown below. 

 
Fig. A.1 Working windows of the Interface 
      The main window contains a map, parameters’ panel and a menu. The map may be zoomed in/out or moved within the main window. The actual vessel track and set path are drawn on the map. The coordinates of the cursor mouse are always displayed on the map.  
      The parameters panel is on the right side of the main window. It displays the coordinates, speed, rpm, thrusters’ status and rudder angle of the vessel together with the course error, cross deviation, deviations rate, distance to the next waypoint, etc. The values of the parameters are updated every second. 
      The menu contains commands (functions) of the Interface which are presented in detail in the next subsections. 
      The Display motion window displays an area of 20·20 m with the vessel figure in the center (Fig. A.2). In the window, the user can see the actions of the rudder, the main propeller, the bow and stern thrusters. The user can also see the vessel’s position in relation to the set path to assess the situation visually. In the maneuvering mode and transitional mode, the reference point is shown by “*” mark in this window. 
	 	
 
Fig. A.2 The Display motion window 
      The Wind indicator window shows the vectors of the relative and true direction of the wind. The wind speed during the last 100 seconds is shown on the graph. The Beaufort scale is also displayed in the window (Fig. A.2) 
A.2 Functions related to set paths 
These functions are located in menu Trajectory. They are: New route, Read route, Save route and Close route. As their names indicate, they perform the regular actions to the route (set path) file.  
To create a new set path: one can select command Trajectory/New route. The Interface changes to the create route mode, the mouse cursor has form of a very thin plus “+”. Move the cursor to the position of the first waypoint, left click mouse. A dialog box appears (Fig. A.3). Input the properties of the waypoint into the dialog box.  
 
Fig. A.3 Waypoint properties input dialog box 
      The X and Y fields contain the coordinates of the waypoint. By default, they are set to the coordinates of the point where mouse was clicked last time.  
      The Radius field sets the curve track radius when the vessel is changing the path segment. In practice, the autopilot always changes the path segment when the vessel is closest to the waypoint to keep it as close as possible to the set path. That’s why the default value of the Radius field is 30 m (the smallest radius curve of the Blue Lady model). The Radius field is used only when the user wants to set the curve path with a very large radius, e.g. the vessel is running around an island or in the bend of a river. In that case, set one waypoint with large radius; the autopilot will set the  sub-waypoints automatically along the curve. The Radius field may be omitted at the first and last waypoint of a route.  
      The Speed field sets the required speed on the segment starting from this waypoint. 
      The Course field sets the required heading on the segment if the segment  is of the maneuvering type or set to -1 if the segment is a trajectory segment  (subsection 4.1.2). 
      After entering the values into the dialog box, select OK button to finish input data for this waypoint. Click mouse in other place to set next waypoints on the map.  
2. Hold down the 
Shift key 
& 
left click 
mouse w waypoint is ded. Move it 
1. Lthe required tition 
a) Inserting a waypoint 

b) Deleting a waypoint 
 
Fig. A.4 Inserting/Deleting waypoint 
To save a route to the disk: select command Trajectory/Save route. A save dialog box appears. Input the file name and location of the route file into this dialog box then select Save button. 
To load a route from the disk: select command Trajectory/Read route. An opening dialog box appears. Select the route file and then select the Open button. The opened route is drawn in the main window and the parameters of its waypoints are loaded into the memory of the autopilot. 
To close a route: select command Trajectory/Close route. The current route is cleared on the main window and in the memory of the autopilot. 
To adjust the waypoint position of a route: locate mouse cursor on the waypoint, drag the cursor to move waypoint to the desired position. 
To insert a waypoint into a route: locate cursor mouse on the path segment where the new waypoint will be located, hold down the Shift key and left-click mouse. The segment is divided into two segments by the added waypoint (Fig. A.4a). 
To delete a waypoint from a route: locate the cursor on the waypoint, hold down the Shift key and left-click mouse. This waypoint disappears and two segments are combined into one (Fig. A.4b). 
A.3 Functions related to vessel control  
These functions are located in the menu Run. They are with Set path, temp Trajectory, temp Position, with Recorded data and Stop function. 
with Set path: This function controls the vessel with a set path – a complete “quay-toquay” voyage or a part of voyage. Before selecting this function, the user has to open a route. If there is no route opened, the Interface will display the Route open dialog box and require the user to open a route. 
      After selecting this command, the autopilot starts controlling the vessel along the set path (route). 

 
Fig. A.5 Control with a set path. The screen snapshot with the main window and 
Display motion window 
temp Trajectory: Using this function, the autopilot controls the vessel in the trajectory mode to follow the instant path segment. The instant path segment is assigned each times when a user clicks the mouse on the map. It connects the current vessel position with the position of the mouse click. This function is useful when the user wants to steer the vessel but does not yet decide the set path or cannot decide the set path due to outside unexpected circumstances. 
temp Positioning: Using this function, the autopilot controls the vessel in the maneuvering mode. The control vessel is carried out with a “handle” in the main window (Fig. A.7) which can be moved by dragging the cursor on the small rectangle mark at the center or turned by dragging the cursor in the small rectangle mark at the bow of the handle. The instant path segment connects the current vessel position to the handle position and it is assigned each time when the handle is moved to a new position or turned. This function is useful when leaving the quay for departure or shifting quay in confined area. 

Display motion window 
Vessel track 
 A Instant path segment B 
1 Fig. A.6 Steering a vessel by using the temp Trajectory function. When the vessel is in position A, click mouse at position B, the vessel is controlled along the 

instant path segment AB. 
 

	The 	handle 	appears 	when 	selected 	temp 
Positioning function. The vessel position is kept at the reference point 

The vessel heading can be set by dragging the cursor mouse turning the handle  

Drag mouse to move handle to a new position. The instant path segment is created; one end is the initial vessel position and other end is the handle position. 

When the maneuvering action is completed, the instant path segment is deleted and vessel position is kept at the reference point.  
 

Fig. A.7 Controlling the vessel with the “handle” using temp Positioning function Stop: This function stops the communication between the Processing block and the xPC. After stopping, the last command remains in the xPC and the vessel is continuously controlled by this command. In the complete voyage, the last command often has the task of keeping the vessel at the last waypoint. 
Using function combinations: In practice, when a vessel is leaving the quay, the room around it often is very narrow. Moreover, in this case maneuvering should be carried out very carefully. Because of this, the set path for full automatic control should start at a safe distance from the berthing quay. The vessel should be controlled by temp Positioning and/or temp Trajectory function to the first waypoint of the set path under the careful observation by a helmsman. Then it is changed to the with Set path function for full automatic control.  

Fig. A.8 Using function combinations for departure 
      Fig. A.8 shows an example of the departure. The vessel leaves the quay for the set path DEF. From the berthing quay (point A), the vessel is shifted to the point B and turned forward to the waypoint D by using the temp Positioning function. When the vessel heading already points to the waypoint D, select the temp Trajectory function and click mouse at point C. The instant segment BC is assigned and the vessel starts running along it. When the vessel is approaching the starting waypoint D at the proper distance (point b), select the with Set path function. The vessel will be fully automatically controlled along the set path DEF to its final destination. 
A.4 Functions related to map correcting  
The functions related to map correcting are: 1) Showing on/off the secondary map; 2) Adjusting coordinates of the secondary map; 3) Adding/Deleting/Editing buoys and 4) Other functions. 
A.4.1  Show on/off the secondary map 
Besides the primary map with its own structure, the Interface can display the secondary map. The secondary map may be any type of Microsoft Windows standard graphic file. The showing on/off secondary map may be useful in the following cases: 
      - The vessel is running in the area where there is no primary map. In that case, the map scanned from a paper or drawn with using another graphic program may be used in the Interface. 
      - To compare the primary map with another one for correcting. To do this, display both maps (Fig. A.9b) in the main window and correct the primary map. 

 
Fig. A.9 Displaying map on the main window 	 
      To show the secondary map, just select the Secondary map on command in the Map menu. To hide the secondary map, select the Secondary map off command in the Map menu. 
A.4.2  Adjusting coordinates of the secondary map 
The secondary map may be deformed due to the scanning device used or exchanging format file. It can be corrected by the Adjust secondary map command of the Map menu. A small panel appears in the window with four input boxes: Left, Up, Right and Down. They are the positions of two map corners: left-up and right-down. By changing their positions, the coordinates of the map and the scale on each axis is adjusted.  
      The values of these input boxes are stored in a file in the folder of the Interface program. 
A.4.3  Adding/Deleting/Editing buoys 
This function allows adding a new buoy on the map, deleting a buoy from the map and changing properties of a buoy. This function may be turned on by selecting the Open edit map command of the Map menu. To turn off the correcting map function, select the Close edit map command in the Map menu. When this function is on, other functions, which related to vessel control and route editing, are disabled. 
To add a new buoy on the map: Move cursor to the position, where the new buoy will be located. Right click mouse to activate the context menu; select the Add buoy command in the menu. A dialog box appears (Fig. A.10) 
      Input the Name, Comment of the buoy into respective fields. The input boxes X and Y contain the coordinates of the buoy. Their default values are the coordinates of the mouse click position. The user can input new values to these boxes if he wants to locate the buoy at other position. The shape and color of the buoy can be selected in the dialog box. If the buoy has a light, check the check box Light and select the color and the direction of the light on the map.  
Select the Save button to store the new buoy to the map file. 
To edit the properties of a buoy: Click the mouse on the buoy that needs correction. The buoy properties dialog box appears as in Fig. A.11. Correct the data in the dialog box then select button Save to store the new value in the map file.   
 
Fig. A.10 Adding a new buoy dialog box 
To delete a buoy: Click the mouse on the buoy that will be deleted. The buoy properties dialog box appears as in Fig. A.11. Select button Delete to delete the buoy from the map file. 
 
Fig. A.11 Editing/Deleting buoy dialog box 
A.4.4  Other functions 
Zoom in/out: The map may be zoomed in/out by a right click mouse in the main window then select the Zoom in command or the Zoom out command in the instance popup menu. 
Moving the map: The map can be moved within the main window. To activate this function, right click mouse then select the Pan command in the context menu. The cursor changes to the mark . Drag the cursor within the window to move the map. 
      To deactivate the function, right click mouse and select the Pan command again. 
Creating a backup map: Before correcting a map, a backup map should be created. To do this, select the Create backup function in the Map menu. Input a file name and the location of the backup map file using the dialog box.  
      The backup map can be loaded by selecting the Read map command in the Map menu. 
Connecting to/Disconnecting from a xPC: The connection between a Host PC and an xPC can be controlled by the xPC connect command in the System  menu. When the Interface is working in the offline mode (no connection to the xPC), the vessel managing functions of the autopilot are disabled. The users can only work with the functions related to the map and the route.  
 
Appendix B Autopilot diagram 
The system is constructed based on the model of a host-target configuration. The host and the target computers are connected by an Ethernet link. The target computer is connected to the equipment of Blue Lady through four RS-232/485 interfaces: One to the D-GPS receiver; one to the gyro compass; one to the anemometer and one to the propulsion control unit.  

Fig. B.1 System diagram 
      The autopilot program is divided into two parts. The first part is loaded into the host computer. It consists of the Processing block and Interface block. They are coded in m-file format of Matlab. Their algorithms have already been presented in subsection 4.5 and 4.6. The second part is loaded into the target computer. It consists of two regulators: the Trajectory segment regulator and the Positioning regulator. They have been built with Silmulink-Matlab tool. The main schemas and the blocks inside are shown from Fig. B.2 to Fig. B.10.  
 
 


 Fig. B.2 Main autopilot diagram  
 

Fig. B.3 Block Sterowania 

 
Fig. B.4 Block Trajectory1 
 


 
Fig. B.5 Block Positionning 


Fig. B.6 Block To target point 

 
Fig. B.7 Block Switch1 
 	112 


  Diagram of the autopilot used for computer simulation 



 
  The ratios of cross deviation to vessel’s dimension (kcross dev.) for models Tanker, Container and Mariner 

Appendix C 
Mathematical model of Blue Lady [24] 
The experiments were mainly carried out using the Blue Lady model (Chapter 5). The experiments on the real model on the lake are very valuable but expensive and take a lot of time. In addition, many conditions do not or rarely exist on the lake. Therefore, developing a simulation model of Blue Lady on a computer is necessary. This appendix presents the mathematic model of Blue Lady, which was used in many experiments of the research. 
C.1 The mathematical model 
The motion equation  
The model of Blue Lady is simulated with motion in three degrees of freedom  (3-DOF.): surge, sway and yaw. Its equation of motion is: 
m u( ??- rv) = X
 	m v(??+ ru) = Y 	(C.1) 
I rz ??= N
where m is the mass of ship, Iz are the inertias along the x0 and z0 axes. 
The forces and moment in (C.1) as following: 
X = Xhyd + (1 - tt) · Xpropl + Xrud + Xb a propl- .	+ Xs a propl- .	+ Xext
Y = Yhyd + Ypropl + Yrud + Yb thruster-	+ Ys thruster-	+ Yb a propl- .	+ Ys a propl- .	+ Yext	 (C.2) 
	N = Nhyd + Npropl + Nrud + Nb thruster-	+ Ns thruster-	+ Nb a propl- .	+ Ns a pr- .	opl + Next
where Xhyd,Yhyd,Nhyd  	 : hydrodynamic forces and moment Xpropl,Ypropl,Npropl  	 : forces and moment caused by main propeller Xrud,Yrud,Nrud  	 : forces and moment caused by rudder Yb thruster-	,Nb thruster-	 	 : forces and moment caused by bow thruster Ys thruster-	,Ns thruster-	 	 : forces and moment caused by stern thruster Xb a propl- .	,Yb a propl- .	,Nb a propl- .	 : forces and moment caused by bow azimuth propeller Xs a propl- .	,Ys a propl- .	,Ns a propl- .	 : forces and moment caused by stern azimuth propeller Xext,Yext,Next : forces and moment caused by environmental disturbances, e.g., wind, currents and waves. 
 
Fig. C.1 Propulsion system diagram of the Blue Lady model 
      All the detail of the above forces and moment components shall be described in the following subsection and the environment disturbances in the next section. 
Hydrodynamic forces and moments: the hydrodynamics forces and moments of the Blue Lady model are defined by: 
	Xhyd =-m ux??+ 0.5rwLT X u u( uu	+X vr X vvr + vv 2 +LX r2 rr 2)
 	Yhyd =-m v m ury??- x + 0.5rwL Y v u2 ( vu	+Y v vvv	+LY r uru	+LY r r2 rr +LY v rvr +LY r vrv	) (C.3) 
     Nhyd =- +i rzz?	0.5rwL N v u3 ( vu	+N v vvv	+LN r uru	+LN r r2 rr +LN v rvr +LN r vrv	) where  
	-0.0334	if u ‡ 0
Xuu =	 -0.2800 if u < 0 m = rwLBT 
Iz = 1.4 0.055( Cb + 0.029)M L( )2 mx = 0.5rwC B Tb ( )2 
2
	my = 0.5rpw L T( )2 1 + 0.16Cb B - 5.1 B	 
	?	T	? T ? ?
 
 
	L	B	B 2
	CD = 1.1 + 0.045	 - 0.27	 + 0.016	 
	T	T	? T ?
	(	b	)	y	1
Xvr = 1.11C - 0.07 m / rwLT 
	? 2	?
           B 2 Xvv = 0.4T - 0.006 ? L ?
Xrr = -0.0003 
 
 
 
 
rw : water density; rw = 1000 kg/m3 
L  : length of the model; L = 13.75 m 
B  : beam of the model; B = 2.38 m 
T  : draft of the model; T = 0.86 m 
Cb : volume coefficient; Cb = 0.83 
Propulsion system and resistance: The Blue Lady model is driven by one main propeller, two thrusters (bow and stern) and two azimuth propellers (bow and stern). 
The forces and moments generated by them are simulated by following formulas: 
• The forces and moments are generated by the main propeller: 
 	 	(C.4) 
where  up 	: speed of following water; up = u(1 - wef ) 
	wef 	: coefficient; wef=0.3 if u ‡ 0 and wef=0 if u < 0  
	CT 	: coefficient of pressure, depending on the propeller pitch. 
b  
	g	prop
• The forces and moments are generated by thrusters: 
Thruster at the bow when u ?[0..1] 
	Yb thruster-	= 44.145nb thruster-	(b u2	2 - b u1	+ b0 )
  
  Nb thruster- = 0.240LYb thruster- (a u2 2 - a u1 + a0 ) u ? -[ 1..0]
	when 	 (C.5)  	Yb thruster-	= 44.145nb thruster-	(a u2	2 - a u1	+ a0 )
                                      Nb thruster-	= 0.240LYb thruster-	(b u2	2 - b u1	+ b0 )
when u ? -[ 1..1] (C.6)  	Yb thruster-	= 0
	Nb thruster-	= 0 
Thruster at the stern when u ?[0..1] (C.7)  	Ys thruster-	= 44.145ns thruster-	(b u2	2 - b u1	+ b0 )
 
	Ns thruster-	= 0.176LYs thruster-	(a u2	2 - a u1	+ a0 )
when u ? -[ 1..0] (C.8)  	Ys thruster-	= 44.145ns thruster-	(a u2	2 - a u1	+ a0 )
                                      Ns thruster-	= 0.176LYs thruster-	(b u2	2 - b u1	+ b0 )
when u ? -[ 1..1] (C.9)  	Ys thruster-	= 0
	Ns thruster-	= 0 
where (C.10)  	 	a2 = 0.05262  	a1 = 0.1463 	 	a0 = 1  	 	b2 = 0.06155  	b1 = 0.2281 	 	b0 = 1 • The forces and moments are generated by azimuth propellers: 
The azimuth propeller at the bow  Xb a propl- .	= 35.316n(1 + 0.3(ucos(a - p +)	vsin(a - p)))cos a Yb a propl- .	= 35.316n(1 + 0.3(ucos(a - p +)	vsin(a - p)))sin a (C.11) 	Nb a propl- .	= 0.393LYb a propl- .
where  
 	n 	: the power of thruster [-1..+1]  	a 	: direction of thrust [-120o..+120o]  The azimuth propeller at the stern 
	Xs a propl- .	= 36.297n(1 + 0.3(ucos(a - p +)	vsin(a - p)))cosa
 	Ys a propl- .	= 36.297n(1 + 0.3(ucos(a - p +)	vsin(a - p)))sin a 	(C.12) 
	Ns a propl- .	= 0.371LYs a propl- .
where  
 	n 	: the power of the thruster [-1..+1]  	a 	: direction of thrust [+60o..+300o]  
Rudder forces and moments: the forces and moments caused by the rudder are defined 
Xrud = -krudxFrud sin(def )
 	Yrud = krudy (1 + aH )Frud cos(def ) 	(C.13) 

where aH   = 0.176 
  	 urud = 0.77(up + 0.7ual )2 + 0.23up2  	 	(n D	)2
ula = 8Ct"	g	prop	 
p 	 	 
 	 	def = d+gbp	rud 
 	 	b	 
rud
 	 	g 
 	 	krud =1.5ctg(d- 6.5) - 1.7 -40.55d + 30.43
1.5ctg(d- 6.5) - 1.2d> +10 d ? +10 d< -10     The model simulation of the Blue Lady was coded in language C. The maneuvering characteristics of the simulation model were almost the same as the real model. It is used in many researches at Gdynia Akademia Morska in Poland.  
C.2 Comparing the Blue Lady simulator to the real model 
To evaluate the similarity of the Blue Lady model in computer simulation and the real model in real environment many maneuvering experiments were carried out. The results of the experiments are shown from Fig. C.2 to Fig. C.9 [24]. 

 Fig. C.2 Turning circle test, full ahead engine, d = +10o (left)/d = -10o (right);  
solid line - real model, dotted line - simulation model 

       Fig. C.3 Turning circle test, full ahead engine, d = +35o (left)/d = -35o (right);  solid line - real model, dotted line - simulation model 

 Fig. C.4 Turning circle test, half ahead engine, d = +10o (left)/d = -10o (right);   
solid line - real model, dotted line - simulation model 
	 Fig. C.5 Turning circle test, half ahead engine, d = +35o (left)/d = -35o (right);  solid line - real model, dotted line - simulation model 

Fig. C.6 Position and course with bow thruster running at maximum power;  solid line - real model, dotted line - simulation model 

Fig. C.7 Position and course with stern thruster running at maximum power;  
solid line - real model, dotted line - simulation model 

 
Fig. C.8 Position and course with bow azimuth propeller running with a = 90o and maximum power; solid line - real model, dotted line - simulation model 

	 -15            -10            -5               0              5   	  0                   100                  200                 300                400                  500                 600                 700 
	y[m] 	t[s] 	 
Fig. C.9 Position and course with stern azimuth propeller running with a = 90o and maximum power; solid line - real model, dotted line - simulation model 

 
Fig. C.10  Speeding up the vessel from immobile state, from stop to full ahead 
(left)/half ahead(right); solid line - real model, dotted line - simulation model 

 
Fig. C.11 Speed up vessel from immobile state, from stop to slow ahead (left)/dead slow ahead(right); solid line - real model, dotted line - simulation model 
 
 
Appendix D Fuzzy logic theory 
D.1 Background  
Fuzzy set theory was developed by Lotfi A. Zadeh [78], professor of computer science at the University of California in Berkeley, to provide a mathematical tool for dealing with the concepts used in natural language. According to this theory objects are classified by unsharp boundaries set in which membership is a matter of degree [33] 
      The basic concept underlying fuzzy logic is that of a linguistic variable, that is, a variable whose values are words rather than numbers. Although words are inherently less precise than numbers, their use is closer to human intuition. Furthermore, computing with words exploits the tolerance for imprecision and thereby lowers the cost of solution. 
      The past few years have witnessed a rapid growth in the number and variety of applications of fuzzy logic. The applications range from consumer products such as cameras, camcorders, washing machines, and microwave ovens to industrial process control, medical instrumentation, decision-support systems, and portfolio selection 
[19], [32], [34]. 
Here is a list of general observations about fuzzy logic [38], [39], [40], [53]: 
 Fuzzy logic is conceptually easy to understand. 
 Fuzzy logic is flexible. 
 Fuzzy logic is tolerant of imprecise data. 
 Fuzzy logic can model nonlinear functions of arbitrary complexity. 
 Fuzzy logic can be built on top of the experience of experts. 
 Fuzzy logic can be blended with conventional control techniques. 
 Fuzzy logic is based on natural language. 
      The basic concepts and common fuzzy logic systems are presented in the next section.  
D.2 Fuzzy logic theory 
D.2.1 Linguistic variable 
The basic concept underlying fuzzy logic is a linguistic variable. The linguistic variable is a variable whose values are words rather than numbers. It is characterized by a quintuple (V, T, X, G, M), where  
- V is the name of the variable, e.g., temperature, error. 
- T is the set of linguistic values that V can take, e.g., {cold, medium, hot}. 
- X is the range of values that V can take, e.g., an interval [-5, +5], the universe of discourse. 
- G is a syntactic rule which defines the elements (names of values) of V . 
- M is a semantic rule which gives the interpretation of linguistic value in terms of quantitative elements. 
name of the variable 
terms 
membership functions universe of discourse 
 
Fig. D.1 Fuzzy variable “temperature” 
     Fig. D.1 describes the linguistic variable graphically. The fuzzy variable may take words in natural language as its values. These words are the labels of fuzzy sets. 
D.2.2 Fuzzy set and membership function 
     In classical set theory, an element either belongs to the set or not. But, in fuzzy set theory, an element can belong to the set partially to a certain degree and the set does not have crisp boundaries. Hence, a fuzzy set is a set without a crisp, clearly defined boundary. It can contain elements with only a partial degree of membership. A membership function is a curve that defines how each point in the input space is mapped onto a membership value (or degree of membership) between 0 and 1 [78]. 
     The shapes of the membership function curve are very different. They may be the shape of a triangle, bell curve, gausses curve or other. Some of them are described below. 
      Triangular-shaped membership function (trimf): It has the shape of a triangular curve that is defined by a function of a vector, x, and depends on three scalar parameters a, b, and c, as given by: 
 	 	(D.1) Trapezoidal-shaped membership function (trapmf): It has the shape of a trapezoidal curve that is defined by a function of a vector, x, and depends on three scalar parameters a, b, c and d, as given by: 
 	f x a b c d( , , , , )	max min	,1,	,0 	(D.2) 

 
Fig. D.2 Triangular-shaped and trapezoidal-shaped membership function  
     Gaussian curve membership function (gaussmf): It is the symmetric Gaussian function which depends on two parameters s and c as given by: 
-(x c- )2

 	f x( , ,sc) = e 2s2 	(D.3) 
     Gaussian combination membership function (gauss2mf): It is a combination of two Gaussian curves. The first one, specified by s1 and c1, determines the shape of the leftmost curve. The second one specified by s2 and c2 determines the shape of the rightmost curve. Whenever c1<c2, the gauss2mf function reaches a maximum value of 1. Otherwise, the maximum value is less than one. 
     Bell-shaped membership function (gbellmf): It depends on three parameters a, b, and c as given by 
 	f x a b c( , , , ) =	1	 	(D.4) 

where the parameter b is usually positive. The parameter c locates the center of the curve.  

 
Fig. D.3 Gaussian curves and bell-shaped membership function  
     Sigmoidally shaped membership function (sigmf): It depends on two parameters a and b as given by 
 	 	(D.5) Combination of two sigmoidal membership functions: There are two types of such combinations, named dsigmf and psigmf . The dsigmf is the difference between two sigmoidal functions 
 	 	(D.6) 
 	and the psigmf is the product of two of sigmoidal curves: 
 	 	(D.7) 

 
Fig. D.4 Sigmoidally shaped membership functions  
D.2.3  Logical operations 
In the fuzzy set theory, an element can belong to the set partially to a degree (between 0 and 1). It is different from the classical set theory, in which an element either belongs to the set or not (1 or 0). Therefore, the standard Boolean logic cannot be applied to the fuzzy set. It needs a special definition of logical operations. 
      In the fuzzy set theory, the statement A AND B, where A and B are limited to range (0, 1) is resolved by function min(A, B). The OR operation is replaced with the max function, so that A OR B becomes equivalent to max(A, B). The operation NOT A becomes equivalent to the operation 1-A.  See Fig. D.5 for the logical operation of the fuzzy sets. 

AND « min(A, B) 

		NOT « (1-A) 
 
Fig. D.5 Logical operations 
      The fuzzy intersection or conjunction (AND) of two fuzzy sets A and B is specified in general by a binary mapping T, which aggregates two membership functions as follows: 
 	mA?B (x) = T (m mA (x ,)	B (x)) 	(D.8) These fuzzy intersection operators, which are usually referred to as T-norm (Triangular norm) operators, meet the following basic requirements: 
boundary:  	 T (0,0) = 0,T a( ,1) = T (1,a) = a monotonicity:   T a b( , ) ? T c d( , ) if a ? c and b ? d commutativity:  T a b( , ) = T b a( , ) associativity:   T a T b c( ,	( , )) = T T a b(	( , ),c)       Like the fuzzy intersection, the fuzzy union operator (OR) is specified, in general, by a binary mapping S: 
 	mA?B (x) = S (m mA (x ,)	B (x)) 	(D.9) 
      These fuzzy union operators, which are often referred to as T-conorm (or  S-norm) operators, must satisfy the following basic requirements: 
boundary:  	 S (1,1) = 1,T a( ,0) = T (0,a) = a monotonicity:   S a b( , ) ? S c d( , ) if a ? c and b ? d commutativity:  S a b( , ) = S b a( , ) 	 associativity:   S a S b c( , ( , )) = S S a b( ( , ),c)  D.2.4 If-Then rules 
Fuzzy rules define the connection between input and output fuzzy linguistic variables and they can be seen to act as associative memories. Resembling inputs are converted to resembling outputs. Rules have a structure of the form: 
 	IF(antecedent)THEN(consequent) 	(D.10) 
In more detail, the structure is 
 IF(x1 isA1i AND AND... xd isAdi )THEN(yisBi ) (D.11) where  and Bi are fuzzy sets defined by fuzzy sets on the ranges (universes of discourse) Ui and Vi, respectively. Linguistic variable x is a vector of dimension d in U1 ·... ·Ud and linguistic variable y ? V . Vector x is an input of the fuzzy system and y is an output of the fuzzy system.  
In control systems the production rules are of the form 
 	IF< process state > THEN < control action > 	(D.12) 
where the <process state> part contains a description of the process output at the kth sampling instant. Usually this description contains values of error and change-of-error, e.g. error course Dy and turning rate r of a vessel. The <control action> part describes the control output (change-in-control) which should be produced given the particular <process state>, for example the deflecting angle of the rudder d. 
D.2.5  Fuzzy inference 
Fuzzy inference is the process of formulating the mapping from a given input to an output using fuzzy logic. The mapping then provides a basis on which decisions can be made, or patterns discerned. The steps of fuzzy inference processing are as below: 
Step 1: Fuzzify inputs 
      At this step, the degree to which the inputs belong to each of the appropriate fuzzy sets via membership functions is determined.  
Step 2: Apply fuzzy operator 
      After the inputs have been fuzzified, the degree to which each part of the antecedent has been satisfied for each rule. If there are more than one part of the antecedent, the fuzzy operator is applied to obtain one number that represents the result of the antecedent for that rule. 
Step 3: Apply implication method 
      The input for the implication process is a single number given by the antecedent, and the output is a fuzzy set. Implication is implemented for each rule. The two most common operation rules of fuzzy implications are 
• Mini-operation rule (Mamdani implication): 
 mAfiB (x,y) = min{m mA (x), B (y)} (D.13) • Product-operation rule (Larsen implication):  
where mAfiB (x,y) = m mA (x) B (y) (D.14)  	m	 	(D.15) 
or 
 	m	 	(D.16) 
where  and Bi are fuzzy sets defined by fuzzy sets on the ranges (universes of discourse) Ui and Vi, respectively. Linguistic variable x is a vector of dimension d in U1 ·... ·Ud and linguistic variable y ? V . Vector x is an input to the fuzzy system and y is an output of the fuzzy system. 

Step 4: Aggregate all outputs 
      Aggregation is the process by which the fuzzy sets that represent the outputs of each rule are combined into a single fuzzy set. The input of the aggregation process is the list of truncated output functions returned by the implication process for each rule. The output of the aggregation process is one fuzzy set for each output variable  
(see Fig. D.6). The aggregation methods may be max (maximum), probor (probabilistic OR), or sum (simply the sum of each rule's output set) 
Step 5: Defuzzify 
      The input for the defuzzification process is a fuzzy set (the aggregate output fuzzy set) and the output is a single number. The input fuzzy set must be defuzzified in order to resolve a single output value from the set. There are several methods of defuzzification, such as centroid, bisector, height, middle of maximum (the average of the maximum value of the output set), largest of maximum and smallest of maximum. Details concerning each method are described below: 
      Centroid of area (CoA): It is calculated by using dividing the area of combination of output membership functions by two and then taking from the left so much that the moment of this area equals the one on the right (Fig. D.7a). 
mB ( )y y dy. .
 yCoA = R (D.17) mB ( )y dy.
R
      Center of sums (CoS): The CoS method is similar to the CoA method but the intersection is calculated twice. In (Fig. D.7b) defuzzified value obtained by CoS is slightly smaller than the one obtained by the CoA method. 
      Height method (HM): Can be treated as a special case of CoG whose output membership functions are singletons. If symmetric output sets are used in CoG, they have the same centroid no matter how wide the set is and CoG reduces to HM. HM calculates a normalized weighted sum of the clipped or scaled singletons. HM is sometimes called Center average defuzzifier or fuzzy-mean defuzzifier (Fig. D.7c). 
	CoA 	CoS 	BoA 	HM 
mmax 
Fig. D.7 Several common defuzzification methods 
Bisector of area (BoA): The value of y satisfies the following (Fig. D.7d) 
	yBoA	+?
 	mB ( )y dy = mB ( )y dy 	(D.18) 
	-?	yBoA
      Mean of maximum (MoM): Calculates the center of maximum in clipped membership function. The rest of the distribution is considered unimportant  
(Fig. D.7e).  
y dy.
 	yMoM = Y '	 	(D.19) dy
Y '
where Y' = {y mB (y) = mmax}; mmax is the maximum value of mB(y). 
 	By (D.19),  	if mB(y) has a single maximum at y=ymax, the yMoM = ymax  
 	 	 	if , the  
      Smallest of maximum (SoM): As MoM, but takes the leftmost value instead of center value (Fig. D.7f). 
      Largest of maximum (LoM): As MoM, but takes the rightmost value instead of center value (Fig. D.7g). 
D.3 Common fuzzy systems 
D.3.1 Mamdani fuzzy system 
Mamdani's method was among the first control systems built using fuzzy set theory. It was proposed in 1975 by Ebrahim Mamdani [46] as an attempt to control a steam engine and boiler combination by synthesizing a set of linguistic control rules obtained from experienced human operators.  
      The Mamdani fuzzy system uses Mamdani rules (D.11) and its fuzzifier and defuzzifier was presented in D.2.5. 
D.3.2 Takagi-Sugeno’s fuzzy system [26] 
Introduced in 1985 [71], it is similar to the Mamdani method in many respects. The first two parts of the fuzzy inference process, fuzzifying the inputs and applying the fuzzy operator, are exactly the same. The main difference between Mamdani and Sugeno is that the Sugeno output membership functions are either linear or  constant [68].  
A typical rule in a Sugeno fuzzy model has the form of 
 	IF	AND	AND	THEN	 	(D.20) where the consequences of the fuzzy rules are functions of the input vectors x. Index i means the ith rule and A are fuzzy sets. Sugeno used linear combinations of input values as output functions y 
 	 	(D.21) where  are real-valued parameters and specific for each rule. Function can also be nonlinear with respect to inputs. A weighted sum is used as defuzzification method: 
 	 	(D.22) 
since it provides a smooth interpolation of the local models. This type of fuzzy systems has been successfully used in control problems, for example in the control of a model car. The output of the system is a weighted sum of functions. Thus (D.22) interpolates between different linear functions. 
D.3.3  Mendel-Wang’s fuzzy system [26] 
Mendel-Wang’s fuzzy logic system[75], [76] is presented as 
 	 	(D.23) 
	k	d mAil ( )xi
	l=1 ? i=1	?
where wl is a place of output singleton. The membership function  corresponds to the input xi of rule l. In short, the and connective in the premise is carried out by a product and defuzzification by the Height Method (a special case of Center of Gravity method). The rules are of the Mamdani type. The fuzzy basis function is of the form 
 	 	(D.24) 
	k	d mFij ( )xi
	l=1 ? i=1	?
where the denominator normalizes the product of membership functions so that the sum of basis functions yields one at each point. Functions (D.24) are called basis functions even though they are not always orthogonal. The output of (D.23) equals a discrete expectation of the k then-part set centroids wi. Basis functions could also be of the form 
	min{m ( )x	x ? X i, = 1,...,d}
 	bj ( )x =	k	Fij	i	i	i	 	(D.25) min{mF j ( )xi xi ? X ii, = 1,...,d}
	l=1	i
if mini-inference rules were used. However, modern fuzzy systems dispense with min and max. They consist only of multiplications, additions, and divisions [35].  
      System (D.23) can be expressed as a nonlinear mapping which is formed by a weighted sum 
k
 	y( )x =	w bi i ( )x 	(D.26) 
i=1
      Although (D.26) does not look like a fuzzy system, it can be interpreted as such, because it is formed by using membership functions, T-norms and T-conorms. 
 

E.2 Beaufort scale 
Scale Wind speed   Scale to model m/s  
Description kt km/h mph m/s 0 0 0 0 0.0-0.2 0.00-0.04 Calm 1 1-3 1-6 1-3 0.3-1.5 0.06-0.31 Light air 2 4-6 7-11 4-7 1.6-3.3 0.33-0.67 Light breeze 3 7-10 12-19 8-12 3.4-5.4 0.69-1.10 Gentle breeze 4 11-16 20-29 13-18 5.5-7.9 1.12-1.61 Moderate breeze5 17-21 30-39 19-24 8.0-10.7 1.63-2.18 Fresh breeze 6 22-27 40-50 25-31 10.8-13.8 2.21-2.82 Strong breeze 7 28-33 51-62 32-38 13.9-17.1 2.84-3.49 Near gale 8 34-40 63-75 39-46 17.2-20.7 3.51-4.23 Gale 9 41-47 76-87 47-54 20.8-24.4 4.25-4.98 Strong gale 10 48-55 88-102 55-63 24.5-28.4 5.00-5.80 Storm 11 56-63 103-117 64-72 28.5-32.6 5.82-6.65 Violent storm 12 >63 >117 >72 >32.7 >6.67 Hurrican  
 
 
 
E.3 Wind force and moment parameters 
The wind force coefficients CX, CY and wind moment coefficient CN in the formulas (2.39), (2.40) and (2.41) can be calculated by using formulae (2.42), (2.43) and (2.44) with coefficients Ai, Bi and Ci as given in Table E.1, Table E.2 and Table E.3. They are also pre-calculated for common vessel kinds.  See examples from Fig. E.1 to Fig. E.5. 
 
Table E.1 Surge induced wind force parameters [28] 
gR(deg) A0 A1 A2 A3 A4 A5 A6 S.E.  	0 2.152 -5.00 0.243 -0.164 - - - 0.086  	10 1.714 -3.33 0.145 -0.121 - - - 0.104  	20 1.818 -3.97 0.211 -0.143 - - 0.033 0.096  	30 1.965 -4.81 0.243 -0.154 - - 0.041 0.117  	40 2.333 -5.99 0.247 -0.190 - - 0.042 0.115  	50 1.726 -6.54 0.189 -0.173 0.348 - 0.048 0.109  	60 0.913 -4.68 - -0.104 0.482 - 0.052 0.082  	70 0.457 -2.88 - -0.063 0.346 - 0.043 0.077  	80 0.341 -0.91 - -0.031 - - 0.032 0.090  	90 0.355 - - - -0.247 - 0.018 0.094  100 0.601 - - - -0.372 - -0.020 0.096  110 0.651 1.29 - - -0.582 - -0.031 0.090  120 0.564 2.54 - - -0.748 - -0.024 0.100  130 -0.142 3.58 - 0.047 -0.700 - -0.028 0.105  140 -0.677 3.64 - 0.069 -0.529 - -0.032 0.123  150 -0.723 3.14 - 0.064 -0.475 - -0.032 0.128  160 -2.148 2.56 - 0.081 - 1.27 -0.027 0.123  170 -2.707 3.97 -0.175 0.126 - 1-81 - 0.115  180 -2.529 3.76 -0.174 0.128 - 1.55 - 0.112  	       Mean S.E. 0.103  
 
 
 
Table E.2 Sway induced wind force parameters [28] 
gR(deg) B0 B1 B2 B3 B4 	B5 	B6 S.E.  	10 0.096 0.22 - - 	- 	- 	- 0.015  	20 0.176 0.71 - - 	- 	- 	- 0.023  	30 0.225 1.38 - 0.023 	- 	-0.29 	- 0.030  	40 0.329 1.82 - 0.043 	- 	-0.59 	- 0.054  	50 1.164 1.26 0.121 - -0.242 -0.95 	- 0.055  	60 1.163 0.96 0.101 - -0.177 -0.88 	- 0.049  	70 0.916 0.53 0.069 - 	- 	-0.65 	- 0.047  	80 0.844 0.55 0.082 - 	- 	-0.54 	- 0.046  	90 0.889 - 0.138 - 	- 	-0.66 	- 0.051  100 0.799 - 0.155 - 	- 	-0.55 	- 0.050  110 0.797 - 0.151 - 	- 	-0.55 	- 0.049  120 0.996 - 0.184 - -0.212 -0.66 	0.34 0.047  130 1.014 - 0.191 - -0.280 -0.69 	0.44 0.051  140 0.784 - 0.166 - -0.209 -0.53 	0.38 0.060  150 0.536 - 0.176 -0.029 -0.163 	- 	0.27 0.055  160 0.251 	- 0.106 -0.022 	- - 	- 0.036  170 0.125 	- 0.046 -0.012 	- - 	- 0.022  	  	     Mean S.E. 0.044  
Table E.3 Yaw induced wind force parameters [28] gR(deg) C0 C1 C2 C3 C4 C5 S.E.  	10 0.0596 0.061 - - - -0.074 0.0048  	20 0.1106 0.204 - - - -0.170 0.0074  	30 0.2253 0.245 - - - -0.380 0.0105  	40 0.2017 0.457 - 0.0067 - -0.472 0.0137  	50 0.1759 0.573 - 0.0118 - -0.523 0.0149  	60 0.1925 0.480 - 0.0115 - -0.546 0.0133  	70 0.2133 0.315 - 0.0081 - -0.526 0.0125  	80 0.1827 0.254 - 0.0053 - -0.443 0.0123  	90 0.2627 - - - - -0.508 0.0141  100 0.2102 - -0.0195 - 0.0335 -0.492 0.0146  110 0.1567 - -0.0258 - 0.0497 -0.457 0.0163  120 0.0801 - -0.0311 - 0.0740 -0.396 0.0179  130 -0.0189 - -0.0488 0.0101 0.1128 -0.420 0.0166  140 0.0256 - -0.0422 0.0100 0.0889 -0.463 0.0162  150 0.0552- - -0.0381 0.0109 0.0689 -0.476 0.0141  160 0.0881 - -0.0306 0.0091 0.0366 -0.415 0.0105  170 0.0851 - -0.0122 0.0025 - -0.220 0.0057  	   	  	 	 Mean S.E. 0.0127  
Fig. E.1 Cargo/Container vessel; Lpp = 187.30 m; Loa = 198.25 m; B = 32.20 m;  AL = 3689.73 m2; AF = 826.32 m2; SL rel. to main section = -4.92 m; SH rel. to above water-line = 11.07 m  
 
 
Fig. E.2 Tanker, balast; Lpp = 336.00 m; Loa = 351.40 m; B = 55.40  m;  T1 = 8.25 m; T2 = 13.00 m; AL = 7839.63 m2; AF = 1803.93 m2; SL rel. to main section = 8.32 m; SH rel. to above water-line = 12.34 m 
 
 
Fig. E.3 Tanker, loaded; Lpp = 336.00 m; Loa = 351.40 m; B = 55.40 m;  T = 23.50 m; AL = 3401.47 m2; AF = 1131.79 m2; SL rel. to main  section = -24.45 m; SH rel. to above water-line = 6.83 m 
 
 
Fig. E.4 Cargo vessel; Lpp = 127.50 m; Loa = 141.10 m; B = 18.50 m; T1 = 2.55 m; T2 = 6.30 m; AL = 1539.79 m2; AF = 359.53 m2; SL rel. to main  section = 0.60 m; SH rel. to above water-line = 6.30 m 
 
Fig. E.5 Cargo vessel; Lpp = 127.50 m; Loa = 141.10 m; B = 18.50 m; T = 7.32 m; AL = 1192.46 m2; AF = 316.00 m2; SL rel. to main section = -3.15 m; SH rel. to above water-line = 5.73 m 
 
 
References 
[1] 10th ISSC. Volume 1. Proceedings of the 10th International ship and offshore structure congress, Lyngby, Denmark, August 1988. 
[2] Amerongen J. Van, Udink Ten Cate A.J., Model reference adaptive autopilots for ships, Automatica, vol. 11, pp. 441-449, 1975. 
[3] Amerongen J. Van, Van Nauta Lemke H.R., Criteria for optimum steering of ships. Proceedings of the International Symposium on Ship Steering Automatic Control, Genoa, Italy, pp-456-462, 1980. 
[4] Amerongen J. Van, Adaptive steering of ships - A model reference approach to improved maneuvering and economical course keeping. Ph.D Thesis, 
Huisdrukkerij, Delft University of Technology, Delft, The Netherlands, 1982. 
[5] Anderson B., Moore J., Filtracja optymalna, WNT, Warszawa, 1984. 
[6] Astrom K.J., Anton J.J., Arzen K.-E., Expert control. Automatica, vol. 22, no 3, pp.277-286, 1986. 
[7] Athans, M. and Falb, P. L., Eds. Optimal Control. McGraw-Hill Book Company. New York.  1996. 
[8] Barr, A. Feigenbaum, E. A. The handbook of Artificial Intelligent. Vol. 2. William Kaufmann. Los Altos, California. 1982. 
[9] Bech M., Some aspects of the stability of automatic course control of ships. Journal of Mechanical Engineering Science, vol. 14, No. 7, pp. 123-131, 1972. 
[10] Blanke M., Ship Propulsion Losses related to Automatic Steering and Prime Mover Control. Ph.D. Thesis, Technical University of Denmark, 1981. 
[11] Bossley, K.M.; Brown, M.; Harris, C.J. Parsimonious Neurofuzzy Modelling. Technical report, University of Southampton, Department of Electronics and Computer Science, 1995. 
[12] Brown, M. and Harris C. Neuron fuzzy adaptive modeling and control. Prentice Hall, New York, 1994. 
[13] Burns R.S., The use of artificial neural networks for the intelligent optimal control of surface ships. IEEE Journal of Oceanic Engineering, vol. 20, pp.65-72, 1995. 
[14] Chislett, M. S. and Str?m-Tejsen, J., Planar motion mechanism tests and fullscale steering and maneuvering predictions for mariner class vessel. Technical report Hy-6, Hydro-and Aerodynamics Laboratory, Lyngby, Denmark, 1965. 
[15] Clarke D.W., Gawthrop P.J., Self-tuning controller. Proceedings IEE, Part-D, vol. 122, no. 9, pp. 929-934, 1975. 
[16] David, R. Expert systems. AI Magazine. Spring, 3-22, 1982. 
[17] Daley, S. and Gill, K.F., Comparison of a fuzzy logic controller with a P+D control law. ASME Trans: Journal of Dynamic Systems, Measurement and 
Control, vol. III, No.2 pp. 128-137, 1989. 
[18] Demidovich B.P., Maron I.A., Computational Mathematics. Mir Publishers – Moscow. 
[19] Driankov, D.; Hellendoorn, H.; Reinfrank, M. An introduction to fuzzy control. Springer, Berlin. 1993 
[20] Encarnacao, P. and A. Pascaol. Combined Trajectory Tracking and Path Following: An Application to the Coordinated Control of Autonomous Marine Craft. In Oroc. Of the IEEE Conference on Control and Automation. Dubbrovnik, Croatia. 2001b 
[21] Fossen T.I., Guidance and control of ocean vehicles. John Wiley & Sons Ltd, 1994. 
[22] Fossen T.I., Marine Control Systems: Guidance, Navigation and Control of Ships, Rigs, and Underwater Vehicles. 2002. 
[23] Fuzzy Logic Toolbox User's Guide. The MathWorks Inc., Natick, USA, 2006. 
[24] Gierusz W., Synteza wielowymiarowych uk?ad?w sterowania precyzyjnego ruchem statku z wykorzystaniem wybranych metod projektowania uk?ad?w odpornych. Prace naukowe Akademii Morskiej w Gdyni, Gdynia 2005. 
[25] Goodman, A. and M. Gertler. Planar motion mechanism system. US patent 3052120. 1962 
[26] Grimble M.J., Zhang Y., Katebi M.R., H - based ship autopilot design, Ship 
Control Symposium, Ottawa, Canada, pp.678-683, (1993), 
[27] Heikki K. Soft computing in dynamical systems. AS-74.115 
[28] Isherwood, R. M., Wind resistance of merchant ships. RINA Trans. Vol. 115, pp. 327-338, 1972. 
[29] Jensen, Andreas G., Fluid dynamic derivatives: marine and wind engineering approach. Journal of Wind Eng. and Industrial Aerodynamics 69(71), 777-793. 1997 
[30] Kallstrom C.G., Identification and adaptive control applied to ship steering, Ph.D Thesis, Lund Institute of Technology, Sweden, 1979. 
[31] Katebi M.R., Byrne J., LQG adaptive ship autopilot, Transactions of the Institute of Measeruments and Control, vol. 10, no. 4, pp. 187-197. 1988. 
[32] Kickert W.J.M., Van Nauta Lemke H.R., Application of a fuzzy controller in a warm water plant, Automatica, vol. 12, pp. 301-308, 1976. 
[33] Kickert W.J.M., Mamdani E.H., Analysis of a fuzzy logic controller, Fuzzy Sets and Systems, vol.1, pp. 29-44, 1978. 
[34] King P.J., Mamdani E.H., The Application of Fuzzy Control Systems to Industrial Processes. Automatica, vol. 13, pp. 235-242, 1977. 
[35] Kosko, B. Fuzzy Engineering. Prentice-Hall, Upper Saddle River, New Jersey, 1997. 
[36] Koyama T., On the Optimum automatic steering system of ship at sea. J.S.N.A., Vol 122, Dec., 1967. 
[37] Kwiesielewicz M., Morawski L., Tomera M., A comparison of an fuzzy model reference learning control with model reference adaptive control in marine application. Materia?y XVI Og?lnopolskiej Konferencji "Polioptymalizacja i Komputerowe Wspomaganie Projektowania", 15-19 czerwca 1998, Mielno, ss. 206213, 1998. 
[38] Layne J.R., Passino K.M., Fuzzy model reference learning control. Proc. IEEE Confr. Control Applications, Dayton, pp. 686-691, 1992. 
[39] Layne J.R., Passino K.M., Fuzzy learning control for antiskid breaking system. IEEE Transaction Control Systems Technol, vol. 1, no. 2, pp.122-129, 1993. 
[40] Lee C.C., Fuzzy logic in control systems: Fuzzy logic controller-Part2. IEEE Transaction Systems Man, and Cybernetics, vol. 20, no. 2, pp. 419-435, 1990. 
[41] Levis, E.V., Principle of Naval Architecture vol. II: Resistance, Propulsion and Vibration. Third ed. Society of Naval Architecture and Marine Engineers, New Work. 1988 
[42] Levis, E.V., Principle of Naval Architecture vol. III: Motion in Waves and Controllability. Third ed. Society of Naval Architecture and Marine Engineers, New Work. 1988 
[43] Lim C. C., Forsythe, W. Autopilot for ship control. Proceedings IEE, 130 Part D, 1983. 
[44] Lisowski J., Statek jako obiekt sterowania automatycznego. Wydawnictwo Morskie, Gda?sk 1981. 
[45] Luke R., West F., An integrated steering system. New England Sections, SNAME,1960. 
[46] Mamdani E.H., Assilian S., An experiment in linguistic synthesis with a fuzzy logic controller. International Journal of Man-Machine Studies, vol. 7, no. 1, pp. 1-13, 1975. 
[47] Mandic, N. J., Scharf, E.M. and Mamdani, E.H., Practical application of a heuristic fuzzy rule based controller to the dynamic control of a robot area. Pro. IEE. 132 part 258, 1985. 
[48] Merlo P., Tiano A., Experiments about computer controlled ship steering. Semana International sobre la Automatica en la Marina, Barcelona, Spain, 1975. 
[49] Morawski L., Metody syntezy uk?ad?w sterowania ruchem statku. Rozprawa habilitacyjna, Gdynia, 1994. 
[50] Morawski L., Model symulacyjny ruchu statku identyfikacja modeli dynamiki statku, KBN Projekt Nr. 9 T12C 009 13 pt. I?awa 1998. 
[51] Morawski L., Tomera M., Samoucz?cy autopilot rozmyty, Prace X Sympozjum SPD-10, Zakopane-Ko?cielisko, 15-19 czerwca, ss. 275-281, 1998. 
[52] Morawski L., Tomera M., Samoucz?cy regulator rozmyty z modelem odniesienia. XIII Krajowa Konferencja Automatyki, Opole, 21-24 wrze?nia, vol. 2, ss. 243-246, 1999. 
[53] Moudgal V.G., Kwong W.A., Passino K.M., Yurkovich S., Fuzzy learning control for a flexible-link robot, IEEE Transactions on Fuzzy Systems, vol. 3, no. 2, pp. 199-210, 1995. 
[54] Ohtsu K., Horigome M., Kitagawa G., A new ship’s autopilot design through a stochastic model. Automatical, vol. 15, no. 3, pp.255-268, 1979. 
[55] Oldenburg J., Experiment with a new adaptive autopilot intended for controlled turns as for straight course keeping. Proceedings of the 4th Ship Control Systems Symposium, The Hague, The Netherlands, 1975. 
[56] Passino K., Yurkovich S., Fuzzy control, Addison Wesley, 1998. 
[57] Pomirski J., Synteza uk?adu sterowania ruchem statku z wykorzystaniem regulatora typu Robust. Rozprawa doktorska, Warszawa 1999. 
[58] Price, W.C. and R.E.D. Bishop Probabilistic theory of ship dynamics. Chapman and Hall, London 1974. 
[59] Procyk T., Mamdani E., A linguistic self-organizing process controller. Automatica, vol. 15, no. 1, pp. 15-30, 1979. 
[60] Reid, R. E., Tugcu, A. K. and Mears, B. C. The use of wave filter design in Kalman filter state estimation of the automatic steering problem of a tanker in a seaway. IEEE transaction on automatic control AC-29(7), pp. 577-584, 1984. 
[61] Rydill L.J., A linear theory for the steering motion of ship in waves. Transactions of the Royal Institute of Naval Architects, vol. 101, No. 1, pp. 81112, 1959. 
[62] Schiff L., Gimprich M., Automatic control of ship by proportional control. Transactions of the Society of Naval Architects and Marine Engineers, vol. 57, pp. 94-124, 1949. 
[63] Shoa, S., Fuzzy self-organization controller and its application for dynamic processes. Fuzzy sets and Systems, 26, pp. 151-164, 1988. 
[64] SNAME. Nomenclature for treating the motion of a submerged body through a fluid. Technical Report Bulletin 1-5. Society of Naval Architects and Marine Engineers, New York, USA 1950. 
[65] Son, K. H. and Nomoto, K., On the coupled motion of steering and rolling of a high speed container ship, J.S.N.A., Japan, Vol. 150, pp.232-244, 1981. 
[66] Son, K. H. and Nomoto, K., On the coupled motion of steering and rolling of a high speed container ship, Naval Architect of Ocean Engineering 20: 73-83. From J.S.N.A., Japan, Vol. 150, 1981. 1982. 
[67] Sperry E., Automatic steering. Proceedings of 30th General Meeting of the Society of Naval Architects and Marine Engineers, New York, 1922. 
[68] Sugeno M., Kang G.T., Structure identification of fuzzy model. Fuzzy Sets and Systems, vol. 28, pp. 15-33, 1988. 
[69] Sugimoto A., Kojima T., A new autopilot system with condition adaptively. Proceedings of the 5th Ship Control Systems Symposium, Annopolis, Maryland, 1978. 
[70] Suton R., Jess I.M. A design study of a self-organizing fuzzy autopilot for ship control. Proc Instn Mech Engrs. 205, pt I, pp. 35-47, 1991.  
[71] Takagi T., Sugeno M., Fuzzy identification of systems and its applications to modeling and control. IEEE Trans. on Systems, Man, and Cybernetics, vol. 15, No. 1, pp. 116-132, 1985. 
[72] Tanscheit, R. and Scharf, E. M., Experiments with the use of a rule-based selforganizing controller for robotic applications. Fuzzy Sets and Systems 26, pp. 195-214. 1988 
[73] Van Berlekom, W. B. and Goddard, T. A., Maneuvering of large tankers, Transactions of SNAME, 80: pp. 264-298. 
[74] Van Berlekom, W. B. Effects of propeller loading on rudder efficiency.  Proceedings 4th Ship Control Systems Symposium, Haag. Netherlands, pp. 5.835.89, 1975. 
[75] Wang L.X., Mendel J.M., Generating fuzzy rules by learning from examples. IEEE Transaction on Systems, Man, and Cybernetics, vol. 22, no. 6, pp. 14141427, 1992. 
[76] Wang, L.-X. Adaptive Fuzzy systems and control Design and stability analysis. Prentice Hall, New Jersey, 1994. 
[77] WITT N. A. J., SUTTON R., MILLER K. M., Recent technological advances in the control and guidance of ships. Journal of Navigation  (J. Navig.)  ISSN 0373-4633   CODEN JONVAL, vol. 47, no2, pp. 236-258, 1994. 
[78] Zadeh L.A., Fuzzy sets. Information and Control, vol. 8, pp. 338-353, 1965. 
 
 




 	2 

 	2 









 	2 

 	2 



 	2 





 	2 

 	2 



 	2 





 	2 

 	2 



 	2 





 	2 

 	2 



 	2 





























Fig. B.8
 

Fig. B.8
 



Fig. B.8
 





 	116 

 	116 



 	116 

